<!DOCTYPE html>
<!-- saved from url=(0192)file:///E:/Disc/%E3%80%901%E3%80%91~~%E5%B8%B8%E7%94%A8~~/%E3%80%90D-%E5%99%A8%E3%80%91%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E3%80%81%E5%B7%A5%E5%85%B7/10%20Verilog+SV+UVM+EDA+Makefile/UVM.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width initial-scale=1">
<title>UVM</title><link href="./UVM_files/css" rel="stylesheet" type="text/css"><style type="text/css">html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; --title-bar-height:20px; }
.mac-os-11 { --title-bar-height:28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none 0s ease 0s; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
mark .md-meta { color: rgb(0, 0, 0); opacity: 0.3 !important; }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-require-zoom-fix foreignobject { font-size: var(--mermaid-font-zoom); }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/* open-sans-regular - latin-ext_latin */
  /* open-sans-italic - latin-ext_latin */
    /* open-sans-700 - latin-ext_latin */
    /* open-sans-700italic - latin-ext_latin */
  html {
    font-size: 16px;
}

body {
    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

/*@media print {
    .typora-export h1,
    .typora-export h2 {
        border-bottom: none;
        padding-bottom: initial;
    }

    .typora-export h1::after,
    .typora-export h2::after {
        content: "";
        display: block;
        height: 100px;
        margin-top: -96px;
        border-top: 1px solid #eee;
    }
}*/

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border-top: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table th:first-child,
table td:first-child {
    margin-top: 0;
}
table th:last-child,
table td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

.html-for-mac .context-menu {
    --item-hover-bg-color: #E6F0FE;
}

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}

 :root {--mermaid-font-zoom:1.25em ;} 
</style>
</head>
<body class="typora-export os-windows">
<div id="write" class=""><h2><a name="三uvm" class="md-header-anchor"></a><span>三、UVM</span></h2><h3><a name="1-基础" class="md-header-anchor"></a><span>1. 基础</span></h3><p><a href="file:///E:/Disc/%E3%80%901%E3%80%91~~%E5%B8%B8%E7%94%A8~~/%E3%80%90D-%E5%99%A8%E3%80%91%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E3%80%81%E5%B7%A5%E5%85%B7/10%20Verilog+SV+UVM+EDA+Makefile/UVM.html#Ctrl%E8%B7%B3%E8%BD%AC8"><span>参见 《uvm实战》速查 </span></a></p><p>&nbsp;</p><h3><a name="2-框架" class="md-header-anchor"></a><span>2. 框架</span></h3><p><span>分层的 验证环境结构</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""UVM 框架结构"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> <span class="cm-bracket">[</span>数据<span class="cm-bracket">]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">Object</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tr</span> &nbsp;<span class="cm-meta">--</span> <span class="cm-variable">uvm_sequence_item</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 子弹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">seq</span> <span class="cm-meta">--</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">seq_item</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; <span class="cm-comment">// 弹夹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> <span class="cm-bracket">[</span>组件<span class="cm-bracket">]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">Component</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">seqr</span> <span class="cm-meta">--</span> <span class="cm-variable">uvm_sequencer</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">seq_item</span><span class="cm-bracket">)</span> &nbsp; &nbsp; <span class="cm-comment">// 手枪</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">driver</span> <span class="cm-meta">--</span> <span class="cm-variable">uvm_driver</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">seq_item</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">if</span> <span class="cm-meta">--</span> <span class="cm-keyword">interface</span>...<span class="cm-keyword">endinterface</span> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">monitor</span> <span class="cm-meta">--</span> <span class="cm-variable">uvm_monitor</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">fifo</span> <span class="cm-meta">--</span> <span class="cm-keyword">module</span>...<span class="cm-keyword">endmodule</span> &nbsp; &nbsp; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">reference</span> <span class="cm-variable">model</span> <span class="cm-meta">--</span> <span class="cm-variable">uvm_component</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// component最大类</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">scoreboard</span> <span class="cm-meta">--</span> <span class="cm-variable">uvm_scoreboard</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">agent</span> <span class="cm-meta">--</span> <span class="cm-variable">uvm_agent</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">env</span> <span class="cm-meta">--</span> <span class="cm-variable">uvm_env</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">tc</span> <span class="cm-meta">--</span> <span class="cm-variable">uvm_test</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">tp</span> <span class="cm-meta">--</span> <span class="cm-keyword">module</span>...<span class="cm-keyword">endmodule</span> &nbsp; &nbsp; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">adapter</span> <span class="cm-meta">--</span> <span class="cm-variable">uvm_reg_adapter</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 寄存器 &nbsp; </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> <span class="cm-bracket">[</span>连接<span class="cm-bracket">]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">uvm_</span><span class="cm-meta">*</span><span class="cm-variable">_port</span><span class="cm-tab" role="presentation" cm-text="	">   </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">uvm_</span><span class="cm-meta">*</span><span class="cm-variable">_socket</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// uvm 2.0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> <span class="cm-bracket">[</span>如何 <span class="cm-variable">run</span>起来<span class="cm-variable">UVM</span>、如何结束？<span class="cm-bracket">]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1</span>、编译： <span class="cm-meta">-</span><span class="cm-variable">ntb_opts</span> <span class="cm-variable">uvm</span><span class="cm-meta">-</span><span class="cm-number">1.1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2</span>、仿真：<span class="cm-meta">+</span><span class="cm-variable">UVM_TESTNAME</span><span class="cm-meta">=</span><span class="cm-variable">tc_name</span> &nbsp; &nbsp; <span class="cm-comment">// class中factory注册的名称</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">3</span>、《<span class="cm-variable">top</span>.<span class="cm-variable">sv</span>》： &nbsp;<span class="cm-keyword">initial</span> <span class="cm-keyword">begin</span> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">run_test</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> <span class="cm-bracket">[]</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 672px;"></div><div class="CodeMirror-gutters" style="display: none; height: 672px;"></div></div></div></pre><p><img src="./UVM_files/SV&amp;UVM基础_UVM框架.jpg" referrerpolicy="no-referrer" alt="image"></p><p><img src="./UVM_files/SV&amp;UVM基础_UVM文件框架.jpg" referrerpolicy="no-referrer" alt="image"></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h2><a name="a-namectrl跳转8四uvm实战速查a" class="md-header-anchor"></a><a name="Ctrl跳转8"><span>四、《uvm实战》速查</span></a></h2><h3><a name="ch-2框架" class="md-header-anchor"></a><span>Ch. 2_框架</span></h3><p><font color="red"><strong><span>要点总结</span></strong><span>：</span></font></p><h4><a name="◻-interface" class="md-header-anchor"></a><span>◻ interface </span></h4><ul><li><p><span>主要作用：存放变量（输入/输出)</span></p></li><li><p><span>注意事项：</span><code>interface</code><span>内部不能还有</span><code>module</code><span>，但是可以有 </span><code>interface</code><span>、</span><font color="red"><code>modport</code><span> </span></font><span>(捆绑信号&amp;定义信号方向)</span></p></li><li><p><span>优点缺点：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="apl" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="apl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""接口的优缺点"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">【优点】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">### 核心：接口带来的好处是所有的[声明集中]在一个地方，减少了出错的几率。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1</span><span class="cm-keyword">、便于设计重用：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">-</span> <span class="cm-number">2</span><span class="cm-keyword">个模块之间超过2个以上的信号，并使用特定的协议通信，应用接口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">-</span> <span class="cm-keyword">如果信号组一次又一次地重复出现（例如网络交换机），应用</span> <span class="cm-keyword">虚拟接口（virtual</span> <span class="cm-keyword">interface）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2</span><span class="cm-keyword">、可以用来替代原来需要在模块</span><span class="cm-operator cm-apl-reduce">/</span><span class="cm-keyword">程序中</span> [<span class="cm-keyword">反复声明</span>] <span class="cm-keyword">并且</span> <span class="cm-keyword">位于代码内部的一系列信号，</span>[<span class="cm-keyword">减少</span>]<span class="cm-keyword">了连接</span>[<span class="cm-keyword">错误</span>]<span class="cm-keyword">的可能性。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">3</span><span class="cm-keyword">、要增加新的信号时，在接口中</span>[<span class="cm-keyword">只需要声明一次</span>]<span class="cm-keyword">，不需要在更高层的模块层声明，这进一步减少了错误</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">4</span><span class="cm-keyword">、modport</span> <span class="cm-keyword">允许一个模块很方便地将接口中的</span>[<span class="cm-keyword">一系列信号捆绑到一起</span>]<span class="cm-keyword">，也可以</span>[<span class="cm-keyword">为信号指定方向</span>]<span class="cm-keyword">以方便工具自动检查。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">【缺点】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1</span><span class="cm-keyword">、对于点对点的连接，使用modport的接口描述跟使用信号列表的端口一样的冗长。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2</span><span class="cm-keyword">、必须同时使用</span> [<span class="cm-keyword">信号名</span>] <span class="cm-keyword">和</span> [<span class="cm-keyword">接口名</span>]<span class="cm-keyword">，可能会使模块变得更加</span>[<span class="cm-keyword">冗长</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">3</span><span class="cm-keyword">、如果要连接的2个模块使用的是一个不会被重用的专用协议，那么使用接口需要做比端口连线更多的工作</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">4</span><span class="cm-keyword">、连接2个不同的接口很困难：一个新的接口（bus_if）可能包含了现有接口（arb_if）的所有信号并新增了信号（地址、数据等等）。你需要拆分出独立的信号并正确的驱动它们。</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 358px;"></div><div class="CodeMirror-gutters" style="display: none; height: 358px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>示例代码：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""interface示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-keyword">interface</span>代码》定义</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">interface</span> <span class="cm-variable">my_if</span><span class="cm-bracket">(</span><span class="cm-keyword">input</span> <span class="cm-keyword">bit</span> <span class="cm-variable">clk</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">logic</span> <span class="cm-bracket">[</span><span class="cm-number">1</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">grant</span>,<span class="cm-variable">request</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">logic</span> <span class="cm-variable">rst</span>; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endinterface</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">RTL</span>代码》使用<span class="cm-keyword">interface</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 未使用接口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">module</span> <span class="cm-variable">arb</span><span class="cm-bracket">(</span><span class="cm-keyword">output</span> <span class="cm-keyword">logic</span> <span class="cm-bracket">[</span><span class="cm-number">1</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">grant</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">input</span> <span class="cm-keyword">logic</span> <span class="cm-bracket">[</span><span class="cm-number">1</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">request</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">input</span> <span class="cm-keyword">logic</span> <span class="cm-variable">rst</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">input</span> <span class="cm-keyword">logic</span> <span class="cm-variable">clk</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">always</span> @<span class="cm-bracket">(</span><span class="cm-keyword">posedge</span> <span class="cm-variable">clk</span> <span class="cm-keyword">or</span> <span class="cm-keyword">posedge</span> <span class="cm-variable">rst</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-bracket">(</span><span class="cm-variable">rst</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">grant</span> &lt;<span class="cm-meta">=</span> <span class="cm-number">2'b00</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endmodule</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 使用接口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">module</span> <span class="cm-variable">arb</span><span class="cm-bracket">(</span><span class="cm-variable">my_if</span> &nbsp;<span class="cm-variable">myif</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">always</span> @<span class="cm-bracket">(</span><span class="cm-keyword">posedge</span> <span class="cm-variable">myif</span>.<span class="cm-variable">clk</span> <span class="cm-keyword">or</span> <span class="cm-keyword">posedge</span> <span class="cm-variable">myif</span>.<span class="cm-variable">rst</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-bracket">(</span><span class="cm-variable">myif</span>.<span class="cm-variable">rst</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">myif</span>.<span class="cm-variable">grant</span> &lt;<span class="cm-meta">=</span> <span class="cm-number">2'b00</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">myif</span>.<span class="cm-variable">grant</span> &lt;<span class="cm-meta">=</span> <span class="cm-variable">next_grant</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endmodule</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">test_bench</span>代码》使用<span class="cm-keyword">interface</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">module</span> <span class="cm-variable">top</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">bit</span> <span class="cm-variable">clk</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">always</span> <span class="cm-def">#5</span> <span class="cm-variable">clk</span> <span class="cm-meta">=</span> <span class="cm-meta">~</span><span class="cm-variable">clk</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">my_if</span> &nbsp;<span class="cm-variable">myif</span><span class="cm-bracket">(</span><span class="cm-variable">clk</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 设计代码例化：此处为接口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">arb_port</span> &nbsp;<span class="cm-variable">a1</span><span class="cm-bracket">(</span>.<span class="cm-variable">grant</span> &nbsp; &nbsp; <span class="cm-bracket">(</span><span class="cm-variable">myif</span>.<span class="cm-variable">grant</span><span class="cm-bracket">)</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .<span class="cm-variable">request</span> &nbsp; <span class="cm-bracket">(</span><span class="cm-variable">myif</span>.<span class="cm-variable">request</span><span class="cm-bracket">)</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .<span class="cm-variable">rst</span> &nbsp; &nbsp; &nbsp; <span class="cm-bracket">(</span><span class="cm-variable">myif</span>.<span class="cm-variable">rst</span><span class="cm-bracket">)</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .<span class="cm-variable">clk</span> &nbsp; &nbsp; &nbsp; <span class="cm-bracket">(</span><span class="cm-variable">myif</span>.<span class="cm-variable">clk</span><span class="cm-bracket">))</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">// test case 例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">test</span> &nbsp;<span class="cm-variable">t1</span><span class="cm-bracket">(</span><span class="cm-variable">myif</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endmodule</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1210px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1210px;"></div></div></div></pre><p>&nbsp;</p></li></ul><p>&nbsp;</p><h5><a name="▨--clocking--时钟块" class="md-header-anchor"></a><span>▨  clocking  时钟块</span></h5><ul><li><p><span>功能： 定义时间的 </span><font color="blue"><span>触发条件 @</span></font></p></li><li><p><span>示例</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""clocking 时钟块 是 interface 的子模块"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-keyword">interface</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">interface</span> <span class="cm-variable">my_if</span><span class="cm-bracket">(</span><span class="cm-keyword">input</span> <span class="cm-keyword">bit</span> <span class="cm-variable">clk</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">logic</span> <span class="cm-bracket">[</span><span class="cm-number">1</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">grant</span>,<span class="cm-variable">request</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">logic</span> <span class="cm-variable">rst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 定义时钟块</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">clocking</span> <span class="cm-variable">cb</span> @<span class="cm-bracket">(</span><span class="cm-keyword">posedge</span> <span class="cm-variable">clk</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 声明cb</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">output</span> <span class="cm-variable">request</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">input</span> <span class="cm-variable">grant</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endclocking</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 时钟块被引用</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">modport</span> <span class="cm-variable">TEST</span><span class="cm-bracket">(</span><span class="cm-keyword">clocking</span> <span class="cm-variable">cb</span>, &nbsp; &nbsp;<span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">output</span> <span class="cm-variable">rst</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">modport</span> <span class="cm-variable">DUT</span><span class="cm-bracket">(</span><span class="cm-keyword">input</span> <span class="cm-variable">request</span>,<span class="cm-variable">rst</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">output</span> <span class="cm-variable">grant</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endinterface</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">test_bench</span>代码》使用时钟块</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">module</span> <span class="cm-variable">test</span><span class="cm-bracket">(</span><span class="cm-variable">my_if</span>.<span class="cm-variable">TEST</span> <span class="cm-variable">myif</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">initial</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">myif</span>.<span class="cm-variable">cb</span>.<span class="cm-variable">request</span> &lt;<span class="cm-meta">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  @<span class="cm-variable">myif</span>.<span class="cm-variable">cb</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 参照上面，本质是 @(posedge clk)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"@%0t:Grant=%b"</span>,<span class="cm-meta">$time</span>,<span class="cm-variable">myif</span>.<span class="cm-variable">cb</span>.<span class="cm-variable">grant</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endmodule</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 650px;"></div><div class="CodeMirror-gutters" style="display: none; height: 650px;"></div></div></div></pre><p>&nbsp;</p></li></ul><p>&nbsp;</p><p>&nbsp;</p><h5><a name="▨-virtual-interface" class="md-header-anchor"></a><span>▨ virtual interface</span></h5><ul><li><p><span>应用场景</span></p><p><span>如果信号组一次又一次地重复出现（例如网络交换机），应该用 虚拟接口（virtual interface）</span></p></li><li><p><span>示例：</span></p><p><span>在 </span><strong><font color="blue"><span>driver</span></font></strong><span>、</span><strong><font color="blue"><span>monitor</span></font></strong><span> 里面 用的都是 </span><code>virtual interface</code></p><p><span>原因是：</span>
<span>①  可以保持 </span><code>testbench</code><span> 和 </span><code>rtl</code><span>是 </span><font color="blue"><span>动态分割开的 2个环境</span></font>
<span>②  只有 </span><font color="blue"><span>在使用时</span></font><span>，使用 </span><code>virtual interface</code><span>去连接2个真实的环境，并不是真正的实际的连接，所以是虚拟的</span><code>virtual</code></p></li></ul><p>&nbsp;</p><p>&nbsp;</p><h5><a name="▨-modport" class="md-header-anchor"></a><span>▨ modport</span></h5><ul><li><p><span>功能 </span></p><p><span>允许一个模块很方便地将接口中的一系列 </span><font color="blue"><span>信号捆绑</span></font><span> 到一起，也可以为</span><font color="blue"><span>信号指定方向（input / output）</span></font><span>以方便工具自动检查。</span></p></li><li><p><span>示例</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""modport 是 interface 的子模块"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-keyword">interface</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">interface</span> <span class="cm-variable">my_if</span><span class="cm-bracket">(</span><span class="cm-keyword">input</span> <span class="cm-keyword">bit</span> <span class="cm-variable">clk</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">logic</span> <span class="cm-bracket">[</span><span class="cm-number">1</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">grant</span>,<span class="cm-variable">request</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">logic</span> <span class="cm-variable">rst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">modport</span> <span class="cm-variable">TEST</span><span class="cm-bracket">(</span><span class="cm-keyword">output</span> <span class="cm-variable">request</span>,<span class="cm-variable">rst</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">input</span> <span class="cm-variable">grant</span>,<span class="cm-variable">clk</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">modport</span> <span class="cm-variable">DUT</span><span class="cm-bracket">(</span><span class="cm-keyword">input</span> <span class="cm-variable">request</span>,<span class="cm-variable">rst</span>,<span class="cm-variable">clk</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">output</span> <span class="cm-variable">grant</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">modport</span> <span class="cm-variable">MONITOR</span><span class="cm-bracket">(</span><span class="cm-keyword">input</span> <span class="cm-variable">request</span>,<span class="cm-variable">grant</span>,<span class="cm-variable">rst</span>,<span class="cm-variable">clk</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endinterface</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">test_bech</span>代码》使用<span class="cm-keyword">modport</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">module</span> <span class="cm-variable">arb</span><span class="cm-bracket">(</span><span class="cm-variable">my_if</span>.<span class="cm-variable">DUT</span> <span class="cm-variable">myif</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endmodule</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 470px;"></div><div class="CodeMirror-gutters" style="display: none; height: 470px;"></div></div></div></pre></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p><span>补充：</span></p><ul><li><span>interface  高阶： </span><a href="file:///E:/Disc/%E3%80%901%E3%80%91~~%E5%B8%B8%E7%94%A8~~/%E3%80%90D-%E5%99%A8%E3%80%91%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E3%80%81%E5%B7%A5%E5%85%B7/10%20Verilog+SV+UVM+EDA+Makefile/UVM.html#Ctrl%E8%B7%B3%E8%BD%AC3"><span>参见【10.1.1 interface】 </span></a></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h3><a name="ch-3uvm基础" class="md-header-anchor"></a><span>Ch. 3_uvm基础</span></h3><p><font color="red"><strong><span>要点总结</span></strong><span>：</span></font><font color="red"><span>field_automation机制</span></font><span>、</span><font color="red"><span>report机制</span></font><span>、</span><font color="red"><span>config_db机制</span></font></p><h4><a name="3132-树形结构" class="md-header-anchor"></a><span>3.1~3.2 树形结构</span></h4><ul><li><p><span>派生类</span></p><ul><li><p><code>uvm_objec</code></p><ul><li><p><code>config</code></p><p><span>直接派生自 </span><code>uvm_object</code></p><p>&nbsp;</p></li><li><p><code>uvm_phase</code></p><p><span>派生自 </span><code>uvm_object</code><span>， 其主要作用为控制</span><code>uvm_component</code><span> 的行为方式</span></p></li></ul><p>&nbsp;</p><ul><li><p><font color="blue"><span>寄存器（register model）相关类</span></font></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_reg_item</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_reg_map</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_mem</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 比较特殊</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_reg_field</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_reg</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_reg_file</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_reg_block</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 157px;"></div><div class="CodeMirror-gutters" style="display: none; height: 157px;"></div></div></div></pre></li></ul><p>&nbsp;</p></li><li><p><code>uvm_component</code></p><ul><li><p><code>uvm_monitor</code></p><p><code>monitor</code><span>则是 </span><font color="blue"><span>从DUT的</span><code>pin</code><span>上</span></font><span> 接收数据，并且把接收到的数据转换成</span><code>transaction</code><span>级别的</span><code>sequence_item</code><span>，再把转换后的数据发送给</span><code>scoreboard</code></p><p>&nbsp;</p></li><li><p><code>reference model</code></p><p><span>模仿DUT，完成与DUT相同的功能</span>
<span>具备SV高级语言的特性，同时还可以通过DPI等接口  </span><font color="blue"><span>调用其他语言</span></font><span>	</span></p><p>&nbsp;</p></li><li><p><code>uvm_agent</code></p><p><span>从 </span><font color="blue"><span>代码可重用性</span></font><span> 角度考量</span>
<span>与</span><code>uvm_component</code><span> 相比，</span><code>uvm_agent</code><span> 的最大改动在于引入了一个</span><font color="blue"><span>（结构性枚举变量）变量 </span><code>is_active</code></font><span>：</span></p></li></ul><p>&nbsp;</p><ul><li><p><code>uvm_test</code></p><p><span>任何一个派生出的测试用例中，都要实例化</span><code>env</code><span>， 只有这样，当测试用例在运行的时候，才能把数据正常地发给DUT，并正常地接收DUT的数据。</span></p></li></ul><p>&nbsp;</p></li></ul></li><li><p><span>相关的宏</span><span>	</span></p><p><span>—— </span><code>component</code><span>  与之 一一对应</span></p><figure><table><thead><tr><th><span>object 相关宏</span></th><th><span>注释</span></th><th><span>备注</span></th></tr></thead><tbody><tr><td><span>`uvm_object_utils</span></td><td><span>object类 注册到factory</span></td><td>&nbsp;</td></tr><tr><td><span>`uvm_object_param_utils</span></td><td><span>object </span><font color="red"><span>参数化类</span></font><span> 注册到factory</span></td><td><span>参数化的类，示例：</span><br><span>class A#(int WIDTH=32) extends uvm_object;</span></td></tr><tr><td><code>uvm_object_utils_begin (my_object) | object类 注册到factory，且某些成员变量需要使用field_automation机制&lt;br /&gt;&lt;font color=blue&gt;搭配：</code><span>uvm_object_utils_end</span></td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><code>uvm_object_param_utils_begin       | object &lt;font color=red&gt;参数化类&lt;/font&gt; 注册到factory，且某些成员变量需要使用field_automation机制&lt;br /&gt;&lt;font color=blue&gt;搭配：</code><span>uvm_object_utils_end</span></td><td>&nbsp;</td><td>&nbsp;</td></tr></tbody></table></figure><p>&nbsp;</p></li><li><p><code>uvm_component</code><span>  vs  </span><code>uvm_object</code></p><ul><li><p><span>派生自</span><code>uvm_object</code><span>,  但</span><code>uvm_component</code><span>有两大特性是</span><code>uvm_object</code><span>所没有的：</span></p><p><span>	</span><span>①  一是通过在</span><code>new</code><span>的时候指定</span><code>parent</code><span>参数来形成一种 </span><font color="blue"><span>树形的组织结构</span></font>
<span>​</span><span>	</span><span>②  二是有</span><code>phase</code><span>的自动执行特点</span></p></li><li><p><code>uvm_object</code><span>可以使用 </span><code>clone函数</code><span>，</span><code>uvm_component</code><span> 不行（但是可以使用 </span><code>copy函数</code><span>）</span></p><p><font color="blue"><span>  </span><code>clone</code><span> =  </span><code>new</code><span>   + </span><code>copy</code><span>  </span></font></p><p><code>copy</code><span>  的前提是，必须已经例化，分配了内存空间</span></p><p><code>clone</code><span> 不用，它可以指向一个 </span><font color="red"><span>空指针</span></font></p><p>&nbsp;</p></li><li><p><code>uvm_component</code><span> 的另外一个限制是：</span></p><p><span>位于同一个父结点下的不同的</span><code>component</code><span>，在  </span><font color="blue"><span>实例化时不能使用相同的名字</span></font><span> </span></p><p>&nbsp;</p></li><li><p><code>uvm_component</code><span> 在整个 </span><font color="blue"><span>仿真中 </span></font><span>是一直存在的</span></p></li></ul><p>&nbsp;</p></li><li><p><span>树结构</span></p><ul><li><p><code>uvm_component</code><span> 中的 </span><font color="red"><code>parent参数</code></font><span>  ==》  实现 </span><font color="blue"><span> 树结构 </span></font></p><p><span>在例化指定</span><code>parent</code><span>的同时，会在 </span><code>component</code><span>类中 维护一个数组</span><font color="red"><span> </span><code>m_children</code><span> </span></font></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""通过 parent参数，实现树结构"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ A 是 b_inst 的 parent</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">B</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  … </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">A</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">B</span> <span class="cm-variable">b_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">b_inst</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"b_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp;<span class="cm-comment">//@@ 此处的this，代表的就是A类。  即  A类是 b_inst 的 parent</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 当b_inst实例化的时候，指定一个parent的变量，同时在每一个component的内部维护一个数组m_children</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 291px;"></div><div class="CodeMirror-gutters" style="display: none; height: 291px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>树根</span></p><p><span>①  树根不是 </span><code>uvm_test</code><span>，而是 </span><font color="blue"><span>全局变量</span></font><span> </span><font color="red"><code>uvm_top</code></font><span>（</span><font color="red"><code>uvm_root</code></font><span> 的唯一实例，</span><code>uvm_root</code><span> 派生自 </span><code>uvm_component</code><span>）</span></p><p><span>②  </span><code>uvm_test_top</code><span> 的 </span><code>parent</code><span> 是 </span><code>uvm_top</code></p><p><span>③  </span><code>uvm_top</code><span> 的 </span><code>parent</code><span> 则是</span><font color="red"><span> </span><code>null</code></font><span>（若指定</span><code>parent</code><span>是 </span><code>null</code><span>，那都会到 </span><code>uvm_top</code><span>下面，，确保了整个平台只有一棵树）</span></p><p><span>④  </span><code>uvm_top</code><span> 是一个 全局变量，可以直接使用。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""uvm_root采用的是单例模式/单态模式"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_root</span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">top</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">top</span><span class="cm-meta">=</span><span class="cm-variable">uvm_root</span>::<span class="cm-variable">get</span><span class="cm-bracket">()</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 67px;"></div><div class="CodeMirror-gutters" style="display: none; height: 67px;"></div></div></div></pre><p><span> </span></p><p><img src="./UVM_files/SV&amp;UVM基础_uvm_树结构.jpg" referrerpolicy="no-referrer"></p></li></ul><ul><li><p><span>相关函数</span></p><p><span>——访问UVM树中的结点</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>get_parent ();</span></td><td><span>得到子组件 的 （父组件类）</span><code>parent</code><span>类</span></td></tr><tr><td><span>get_child (</span><string childname=""><span>)</span></string></td><td><span>得到父组件 的    子组件</span><code>childname</code><span>的 指针</span><br><code>name</code><span> 是该 </span><font color="blue"><span>子组件</span></font><span> 例化时指定的名字</span></td></tr><tr><td><span>get_children（&lt;ref    uvm_component      children[$]&gt;）</span></td><td><span>得到父组件 的     所有</span><code>child</code><span> 的 指针，放入名为</span><code>children</code><span>的数组</span><br><font color="blue"><code>children[$]</code><span> 是作为 </span><code>ref</code><span> 类型传递</span></font></td></tr><tr><td><span>get_first_child (</span><ref string="" childname=""><span>)</span></ref></td><td><span>得到父组件  的  第一个子组件  的指针，放入 </span><code>childname</code><span> </span><br><font color="blue"><code>name</code><span> 是作为 </span><code>ref</code><span> 类型传递</span></font></td></tr><tr><td><span>get_next_child (</span><ref string="" childname=""><span>)</span></ref></td><td><span>得到父组件  的  下一个子组件  的指针，放入 </span><code>childname</code><br><font color="blue"><code>name</code><span> 是作为 </span><code>ref</code><span> 类型传递</span></font></td></tr><tr><td><span>get_num_children ();</span></td><td><span>得到类 的所有</span><code>child</code><span> 的数量</span></td></tr><tr><td><span>has_child</span></td><td><span>返回1，有子组件； </span><br><span>返回0，无子组件</span></td></tr><tr><td><span>get_depth</span></td><td><span>返回该</span><code>component</code><span>深度（从</span><code>uvm_test_top</code><span>开始算）</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""函数应用示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">get_children</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_component</span> &nbsp; &nbsp; <span class="cm-variable">array</span><span class="cm-bracket">[</span>$<span class="cm-bracket">]</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">my_comp</span>.<span class="cm-variable">get_children</span><span class="cm-bracket">(</span><span class="cm-variable">array</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">foreach</span><span class="cm-bracket">(</span><span class="cm-variable">array</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">])</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">do_something</span><span class="cm-bracket">(</span><span class="cm-variable">array</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">])</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">get_first_child</span> 、<span class="cm-variable">get_next_child</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">string</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp;<span class="cm-variable">name</span>; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_component</span><span class="cm-tab" role="presentation" cm-text="	">   </span> <span class="cm-variable">child</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> <span class="cm-bracket">(</span><span class="cm-variable">comp</span>.<span class="cm-variable">get_first_child</span><span class="cm-bracket">(</span><span class="cm-variable">name</span><span class="cm-bracket">))</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ &nbsp; 得到父组件  的  第一个子组件  的指针，放入 `name`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">do</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">child</span> <span class="cm-meta">=</span> <span class="cm-variable">comp</span>.<span class="cm-variable">get_child</span><span class="cm-bracket">(</span><span class="cm-variable">name</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">child</span>.<span class="cm-variable">print</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">end</span> <span class="cm-keyword">while</span> <span class="cm-bracket">(</span><span class="cm-variable">comp</span>.<span class="cm-variable">get_next_child</span><span class="cm-bracket">(</span><span class="cm-variable">name</span><span class="cm-bracket">))</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 381px;"></div><div class="CodeMirror-gutters" style="display: none; height: 381px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li></ul><p>&nbsp;</p><p>&nbsp;</p><h4><a name="33-fieldautomation机制" class="md-header-anchor"></a><span>3.3 field_automation机制</span></h4><ul><li><p><span>作用：</span>
<span>①  对</span><code>tr</code><span> 进行</span><code>factory</code><span>注册，可以直接调用 </span><font color="blue"><code>copy</code><span>、</span><code>compare</code><span>、</span><code>print</code><span>、</span><code>record</code><span>、</span><code>pack</code><span>&nbsp;</span></font><span> 函数</span></p><p><span>②  能 </span><font color="blue"><span>简化</span></font><span> </span><code>driver</code><span>和 </span><code>monitor</code><span> </span><font color="blue"><span>代码</span></font></p><p><span>③  </span><code>field automation</code><span> 机制还提供  </span><font color="blue"><span>自动得到</span></font><span>  使用</span><code>config_db：：set</code><span>设置的参数的功能，</span>
<span>      </span><a name="Ctrl跳转4"><span>此时</span></a><span>可以 </span><font color="red"><span>省略&nbsp;</span><code>config_db::get</code><span>，但是有3个前提条件：</span></font>
<span>				</span><span>a.    组件进行过 </span><font color="blue"><code>factory</code><span>  </span></font><span>登记注册           （例如：uvm_component_utils（my_driver)）</span>
<span>        </span><span>		</span><span>b.    变量进行过</span><font color="blue"><span> </span><code>field_automation</code><span> </span></font><span>注册 （例如： uvm_field_int(pre_num)）</span>
<span>                c.     </span><strong><span>set</span></strong><span> 函数中的 </span><font color="blue"><span>第三个参数</span></font><span>必须与 </span><strong><span>get</span></strong><span> 函数中的 名称相同（变量名称相同）</span></p><p><span>	</span><span>  那么，当在 </span><code>build_phase</code><span>  函数 中调用</span><span>	</span><font color="red"><span>  </span><code>super.build_phase(phase)</code><span> </span></font><span>时， 自动&nbsp;&nbsp;</span><code>get</code><span>了变量值，不再需要以下代码：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""被省略掉的config_db::get代码"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span><span class="cm-bracket">)</span>::<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,<span class="cm-string">""</span>, <span class="cm-string">"pre_num"</span>, <span class="cm-variable">pre_num</span><span class="cm-bracket">)</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><code>field_automation</code><strong><span>宏</span></strong></p><p><font color="red"><strong><span>注册factory</span></strong></font></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><font color="blue"><strong><span>常规</span></strong></font></td><td>&nbsp;</td></tr><tr><td><span>`</span><span>uvm_field_int     (ARG,   FLAG)</span></td><td><span>注册   整数型  变量：</span><code>ARG</code><span> ，标志位：</span><code>FLAG</code></td></tr><tr><td><span>`uvm_field_real   (ARG,   FLAG)</span></td><td><font color="violet"><strong><span>......................实数型/浮点数.......</span></strong></font></td></tr><tr><td><span>`uvm_field_enum   (T,    ARG,   FLAG)</span></td><td><span>......................枚举型.....................，  </span><font color="blue"><span>有3个参数，分别是：类、变量、权限操作</span></font></td></tr><tr><td><span>`uvm_field_object   (ARG,   FLAG)</span></td><td><span>......................object.....................</span></td></tr><tr><td><span>`uvm_field_event    (ARG,   FLAG)</span></td><td><font color="violet"><strong><span>......................事件........................</span></strong></font></td></tr><tr><td><span>`uvm_field_string    (ARG,   FLAG)</span></td><td><span>......................字符串....................</span></td></tr><tr><td><font color="blue"><strong><span>动态数组</span></strong></font></td><td>&nbsp;</td></tr><tr><td><span>`uvm_field</span><span>_</span><font color="violet"><strong><span>array</span></strong></font><span>_</span><span>int  (ARG,    FLAG)</span></td><td><span>......................动态数组-整数型...............</span></td></tr><tr><td><span>`uvm_field_array_enum   (ARG,    FLAG)</span></td><td><span>......................动态数组-枚举型...............，  </span><font color="blue"><span>2个参数</span></font></td></tr><tr><td><span>`uvm_field_array_object   (ARG,    FLAG)</span></td><td><span>......................动态数组-object................</span></td></tr><tr><td><span>`uvm_field_array_string   (ARG,   FLAG)</span></td><td><span>......................动态数组-字符串................</span></td></tr><tr><td><font color="blue"><strong><span>静态数组</span></strong></font></td><td>&nbsp;</td></tr><tr><td><span>`uvm_field</span><span>_</span><font color="violet"><strong><span>sarray</span></strong></font><span>_</span><span>int  (ARG,    FLAG)</span></td><td><span>......................静态数组-整数型...............</span></td></tr><tr><td><span>`uvm_field_sarray_enum   (ARG,FLAG)</span></td><td><span>......................静态数组-枚举型...............，  </span><font color="blue"><span>2个参数</span></font></td></tr><tr><td><span>`uvm_field_sarray_object  (ARG,FLAG)</span></td><td><span>......................静态数组-object................</span></td></tr><tr><td><span>`uvm_field_sarray_string  (ARG,FLAG)</span></td><td><span>......................静态数组-字符串................</span></td></tr><tr><td><font color="blue"><strong><span>队列</span></strong></font></td><td>&nbsp;</td></tr><tr><td><span>`uvm_field</span><span>_</span><font color="violet"><strong><span>queue</span></strong></font><span>_</span><span>int  (ARG,    FLAG)</span></td><td><span>......................队列-整数型...............</span></td></tr><tr><td><span>`uvm_field_queue_enum   (ARG,FLAG)</span></td><td><span>......................队列-枚举型...............，  </span><font color="blue"><span>2个参数</span></font></td></tr><tr><td><span>`uvm_field_queue_object  (ARG,FLAG)</span></td><td><span>......................队列-object................</span></td></tr><tr><td><span>`uvm_field_queue_string  (ARG,FLAG)</span></td><td><span>......................队列-字符串................</span></td></tr><tr><td><font color="blue"><strong><span>联合数组（共15种）</span></strong></font></td><td><font color="red"><strong><span>索引</span></strong><span>：大类只能是 </span><strong><span>数值/字符串</span></strong><br><strong><span>值</span></strong><span>：可以是 </span><strong><span>int</span></strong><span>、</span><strong><span>string</span></strong><span>、</span><strong><span>object</span></strong></font><br><span>第1个是  </span><strong><font color="red"><span>存储数据</span></font></strong><span>类型，第2个是 </span><strong><font color="red"><span>索引</span></font></strong><span>的类型</span></td></tr><tr><td><font color="gree"><span> </span><strong><span>值：int&nbsp;</span><br><span>索引：xx</span></strong><span> </span></font></td><td>&nbsp;</td></tr><tr><td><span>`uvm_field</span><span>_</span><font color="violet"><strong><span>aa</span></strong></font><span>_</span><span>int</span><span>_</span><font color="violet"><strong><span>int</span></strong></font><span>  (ARG, FLAG)</span></td><td><span>..........联合数组-存储数据：int，索引：int</span><font color="greay"><span>（双态，32位）</span></font><span> .....</span></td></tr><tr><td><span>`uvm_field_aa_int_int_unsigned  (ARG, FLAG)</span></td><td><span>..........联合数组-</span><font color="blue"><span>存储数据：int，索引：无符号int&nbsp;</span></font><span>       ..............</span></td></tr><tr><td><span>`uvm_field_aa_int</span><span>_</span><font color="violet"><strong><span>byte</span></strong></font><span>  (ARG, FLAG)</span></td><td><span>..........联合数组-存储数据：int，索引：byte</span><font color="greay"><span>（双态，8位）</span></font><span>......</span></td></tr><tr><td><span>`uvm_field_aa_int_byte_unsigned  (ARG, FLAG)</span></td><td><span>..........联合数组-存储数据：int，索引：无符号byte       ..............</span></td></tr><tr><td><span>`uvm_field_aa_int</span><span>_</span><font color="violet"><strong><span>integer</span></strong></font><span>  (ARG, FLAG)</span></td><td><span>..........联合数组-存储数据：int，索引：integer</span><font color="greay"><span>（四态，32位）</span></font><span>..</span></td></tr><tr><td><span>`uvm_field_aa_int_integer_unsigned(ARG, FLAG)</span></td><td><span>..........联合数组-存储数据：int，索引：无符号integer       ..........</span></td></tr><tr><td><span>`uvm_field_aa_int</span><span>_</span><font color="violet"><strong><span>shortint</span></strong></font><span>  (ARG, FLAG)</span></td><td><span>..........联合数组-存储数据：int，索引：shortint</span><font color="greay"><span>（双态，16位）</span></font><span>..</span></td></tr><tr><td><span>`uvm_field_aa_int_shortint_unsigned(ARG, FLAG)</span></td><td><span>..........联合数组-存储数据：int，索引：无符号shortint    ..............</span></td></tr><tr><td><span>`uvm_field_aa_int</span><span>_</span><font color="violet"><strong><span>longint</span></strong></font><span>  (ARG, FLAG)</span></td><td><span>..........联合数组-存储数据：int，索引：longint</span><font color="greay"><span>（双态，64位）</span></font><span>..</span></td></tr><tr><td><span>`uvm_field_aa_int_longint_unsigned(ARG, FLAG)</span></td><td><span>..........联合数组-存储数据：int，索引：无符号longint    ..............</span></td></tr><tr><td><span>`uvm_field_aa_int</span><span>_</span><font color="violet"><strong><span>string</span></strong></font><span>  (ARG, FLAG)</span></td><td><span>..........联合数组-存储数据：int，索引：string                  ..............</span></td></tr><tr><td><font color="gree"><strong><span>值：string</span></strong><br><strong><span>索引： xx</span></strong><span>&nbsp;</span></font></td><td>&nbsp;</td></tr><tr><td><span>`uvm_field_aa_string_</span><font color="violet"><strong><span>int</span></strong></font><span>  (ARG, FLAG)</span></td><td><span>...........联合数组-存储数据：string，索引：int              .............</span></td></tr><tr><td><span>`uvm_field_aa_string_</span><font color="violet"><strong><span>string</span></strong></font><span>  (ARG, FLAG)</span></td><td><span>...........联合数组-存储数据：string，索引：string        .............</span></td></tr><tr><td><font color="gree"><strong><span>值：object</span></strong><br><strong><span>索引： xx</span></strong><span> </span></font></td><td>&nbsp;</td></tr><tr><td><span>`uvm_field_aa_object_</span><font color="violet"><strong><span>int</span></strong></font><span>  (ARG, FLAG)</span></td><td><span>...........联合数组-存储数据：object，索引：int          ..............</span></td></tr><tr><td><span>`uvm_field_aa_object_</span><font color="violet"><strong><span>string</span></strong></font><span>  (ARG, FLAG)</span></td><td><span>...........联合数组-存储数据：object，索引：string    ..............</span></td></tr></tbody></table></figure><p><span>枚举类型-示例</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""field_automation:枚举类型-示例 """</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《常规的》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">typedef</span> <span class="cm-keyword">enum</span> <span class="cm-bracket">{</span><span class="cm-variable">TB_TRUE</span>, <span class="cm-variable">TB_FALSE</span><span class="cm-bracket">}</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-variable">tb_bool_e</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">tb_bool_e</span> <span class="cm-variable">tb_flag</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_field_enum</span><span class="cm-bracket">(</span><span class="cm-variable">tb_bool_e</span>,<span class="cm-tab" role="presentation" cm-text="	">  </span> <span class="cm-variable">tb_flag</span>,<span class="cm-tab" role="presentation" cm-text="	">   </span> <span class="cm-variable">UVM_ALL_ON</span><span class="cm-bracket">)</span> &nbsp; <span class="cm-comment">//@@ 类，变量，Flag</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 157px;"></div><div class="CodeMirror-gutters" style="display: none; height: 157px;"></div></div></div></pre></li></ul><p>&nbsp;</p><p>&nbsp;</p><ul><li><p><code>field_automation</code><strong><span>标志位  </span><code>FLAG</code></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""标志位 `FLAG`"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_ALL_ON</span> &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 打开`copy`、`compare`、`print`、`record`、`pack`功能 &nbsp; &nbsp; &nbsp; </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_COPY</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 复制（copy） &nbsp; &nbsp; </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_NOCOPY</span> &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_COMPARE</span> &nbsp; &nbsp; <span class="cm-comment">//@@ 比较（compare） &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_NOCOMPARE</span> &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_PRINT</span> &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 打印（print）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_NOPRINT</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_RECORD</span> &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 记录（record）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_NORECORD</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_PACK</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 打包（pack）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_NOPACK</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 381px;"></div><div class="CodeMirror-gutters" style="display: none; height: 381px;"></div></div></div></pre><p>&nbsp;</p><p>&nbsp;</p></li><li><p><code>field_automation</code><strong><span>函数</span></strong></p><figure><table><thead><tr><th><span>函数</span></th><th><span>公式</span></th><th><span>注释</span></th><th><span>示例</span></th></tr></thead><tbody><tr><td><span>copy</span></td><td><span>copy (uvm_object     rhs)</span></td><td><span>实例复制，使用前必须例化（new）过</span></td><td><span>B.copy（A）    把A实例复制到B实例中</span></td></tr><tr><td><span>compare</span></td><td><span>compare (uvm_object     rhs,     uvm_comparer comparer=null)</span></td><td><span>比较两个实例是否一样，一样返回1，否则0</span></td><td><span>A.compare（B）</span></td></tr><tr><td><span>print</span></td><td>&nbsp;</td><td><span>打印所有的字段</span></td><td>&nbsp;</td></tr><tr><td><span>clone</span></td><td><span>clone ()</span></td><td><span>clone = new +copy</span></td><td><span>A.clone()</span></td></tr><tr><td><span>pack</span></td><td><span>pack (ref bit bitstream[],     </span><br><span>input uvm_packer packer=null)</span></td><td><span>将所有的字段打包成 </span><font color="blue"><span>bit流</span></font></td><td>&nbsp;</td></tr><tr><td><span>unpack</span></td><td><span>unpack (ref bit bitstream[],  </span><br><span>                input uvm_packer packer=null)</span></td><td><span>将一个 bit流  逐一恢复到某个类的实例中</span></td><td>&nbsp;</td></tr><tr><td><span>pack_</span><font color="violet"><strong><span>bytes</span></strong></font></td><td><span>pack_bytes (</span><br><span>ref byte unsigned bytestream[],</span><br><span>input uvm_packer packer=null  )</span></td><td><span>将所有的字段打包成 </span><font color="blue"><span>byte流</span></font></td><td>&nbsp;</td></tr><tr><td><span>unpack_bytes</span></td><td><span>unpack_bytes (</span><br><span>ref byte unsigned bytestream[],</span><br><span>input uvm_packer packer=null)</span></td><td><span>将一个 byte流  逐一恢复到某个类的实例中</span></td><td>&nbsp;</td></tr><tr><td><span>pack_</span><font color="violet"><strong><span>ints</span></strong></font></td><td><span>pack_ints (</span><br><span>ref int unsigned intstream[],</span><br><span>input uvm_packer packer=null)</span></td><td><span>将所有的字段打包成  </span><font color="blue"><span>int</span></font><span>（4个byte，或者dword）流</span></td><td>&nbsp;</td></tr><tr><td><span>unpack_ints</span></td><td><span>unpack_ints (</span><br><span>ref int unsigned intstream[],</span><br><span>input uvm_packer packer=null)</span></td><td><span>用于将一个int流逐一恢复到某个类的实例中</span></td><td>&nbsp;</td></tr></tbody></table></figure></li></ul><p>&nbsp;</p><p>&nbsp;</p><ul><li><p><code>field_automation</code><span> + </span><code>if</code></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-string">"""field_automation  + if  示例"""</span><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">my_transaction</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_transaction</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence_item</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span><span class="cm-bracket">[</span><span class="cm-number">47</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-variable">dmac</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span><span class="cm-bracket">[</span><span class="cm-number">47</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span><span class="cm-tab" role="presentation" cm-text="	">  </span> <span class="cm-variable">smac</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span><span class="cm-bracket">[</span><span class="cm-number">15</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-variable">vlan_info1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span><span class="cm-bracket">[</span><span class="cm-number">2</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">vlan_info2</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">vlan_info3</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span><span class="cm-bracket">[</span><span class="cm-number">11</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-variable">vlan_info4</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span><span class="cm-bracket">[</span><span class="cm-number">15</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-variable">ether_type</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">byte</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">pload</span><span class="cm-bracket">[]</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span><span class="cm-bracket">[</span><span class="cm-number">31</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-variable">crc</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">is_vlan</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 标志位</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_object_utils_begin</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_field_int</span><span class="cm-bracket">(</span><span class="cm-variable">dmac</span>, <span class="cm-variable">UVM_ALL_ON</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_field_int</span><span class="cm-bracket">(</span><span class="cm-variable">smac</span>, <span class="cm-variable">UVM_ALL_ON</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">is_vlan</span><span class="cm-bracket">)</span><span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_field_int</span><span class="cm-bracket">(</span><span class="cm-variable">vlan_info1</span>, <span class="cm-variable">UVM_ALL_ON</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_field_int</span><span class="cm-bracket">(</span><span class="cm-variable">vlan_info2</span>, <span class="cm-variable">UVM_ALL_ON</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_field_int</span><span class="cm-bracket">(</span><span class="cm-variable">vlan_info3</span>, <span class="cm-variable">UVM_ALL_ON</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_field_int</span><span class="cm-bracket">(</span><span class="cm-variable">vlan_info4</span>, <span class="cm-variable">UVM_ALL_ON</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_field_int</span><span class="cm-bracket">(</span><span class="cm-variable">ether_type</span>, <span class="cm-variable">UVM_ALL_ON</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_field_array_int</span><span class="cm-bracket">(</span><span class="cm-variable">pload</span>, <span class="cm-variable">UVM_ALL_ON</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_field_int</span><span class="cm-bracket">(</span><span class="cm-variable">crc</span>, <span class="cm-variable">UVM_ALL_ON</span> <span class="cm-variable">UVM_NOPACK</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_field_int</span><span class="cm-bracket">(</span><span class="cm-variable">is_vlan</span>, <span class="cm-variable">UVM_ALL_ON</span> <span class="cm-variable">UVM_NOPACK</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_object_utils_end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">seq</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_transaction</span><span class="cm-tab" role="presentation" cm-text="	">  </span> <span class="cm-variable">tr</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">tr</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">()</span> <span class="cm-keyword">with</span> <span class="cm-bracket">{</span><span class="cm-variable">vlan</span>.<span class="cm-variable">size</span><span class="cm-bracket">()</span> <span class="cm-meta">==</span> <span class="cm-number">1</span>;<span class="cm-bracket">})</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ 根据这个标志位  去注册登记不同的变量</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 784px;"></div><div class="CodeMirror-gutters" style="display: none; height: 784px;"></div></div></div></pre><p>&nbsp;</p></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h4><a name="34-report机制" class="md-header-anchor"></a><span>3.4 report机制</span></h4><p><img src="./UVM_files/SV&amp;UVM基础_UVMreport机制.jpg" referrerpolicy="no-referrer" alt="image"></p><h5><a name="◻-冗余度阈值" class="md-header-anchor"></a><span>◻ 冗余度阈值</span></h5><p><span>——打印等级</span></p><ul><li><p><span>3.4.1 设置打印信息的冗余度阈值</span></p><p><font color="red"><span>低于&nbsp;</span></font><span>/ </span><font color="red"><span>等于</span></font><span> 冗余度阈值的信息都会被打印出来</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""冗余度阈值/打印等级"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_NONE</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_LOW</span> <span class="cm-meta">=</span> <span class="cm-number">100</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_MEDIUM</span> <span class="cm-meta">=</span> <span class="cm-number">200</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 一般 默认项</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_HIGH</span> <span class="cm-meta">=</span> <span class="cm-number">300</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_FULL</span> <span class="cm-meta">=</span> <span class="cm-number">400</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_DEBUG</span> <span class="cm-meta">=</span> <span class="cm-number">500</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 157px;"></div><div class="CodeMirror-gutters" style="display: none; height: 157px;"></div></div></div></pre><p><font color="red"><span> </span><code>(get/set)_report_(verbosity_level/id_verbosity)</code><span> </span></font></p><figure><table><thead><tr><th><span>函数</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>get_report_</span><font color="violet"><strong><span>verbosity</span><span>_</span><span>level</span></strong></font></td><td><font color="blue"><span>得到</span></font><span> 某个</span><code>component</code><span>的冗余度阈值</span><br><span>例如：</span><code>drv.get_report_verbosity_level()</code></td></tr><tr><td><span>set_report_verbosity_level</span></td><td><font color="blue"><span>设置</span></font><span> 某个特定</span><code>component</code><span>的默认冗余度阈值</span><br><span>若涉及 </span><strong><span>层次引用</span></strong><span>，需要</span><font color="red"><span>在</span><code>connect_phase</code><span>及以后&nbsp;</span></font><span>的</span><code>phase</code><span>才能调用这个函数</span><br><span>若不涉及（如设置当前</span><code>component</code><span>的）也可以在</span><code>connect_phase</code><span>之前</span><br><span>例如：</span><code>agt.set_report_verbosity_level(UVM_HIGH)</code></td></tr><tr><td><span>set_report_verbosity_level_hier</span></td><td><span>递归设置 ....其及以下子</span><code>component</code><br><span>例如：</span><code>agt.set_report_verbosity_level_hier(UVM_HIGH)</code></td></tr><tr><td><font color="gree"><span>根据：信息ID</span></font></td><td>&nbsp;</td></tr><tr><td><span>set_report</span><span>_</span><font color="violet"><strong><span>id</span></strong></font><span>_verbosity</span></td><td><font color="blue"><span>设置</span></font><span> 某个特定</span><code>component</code><span>的 某个特定的  </span><font color="blue"><span>信息ID</span></font><span> 的默认冗余度阈值</span><br><span>例如：</span><code>agt.set_report_id_verbosity ("ID1",  UVM_HIGH)</code></td></tr><tr><td><span>set_report_id_verbosity_hier</span></td><td><span>递归设置 ....</span><br><span>例如：</span><code>agt.set_report_id_verbosity_hier("ID1", UVM_HIGH)</code></td></tr><tr><td><font color="blue"><strong><span>编译命名</span></strong></font></td><td><sim command=""><span> +UVM_VERBOSITY=UVM_HIGH    设置整个验证平台的冗余度阈值</span><br><sim command=""><span> +UVM_VERBOSITY=HIGH</span></sim></sim></td></tr></tbody></table></figure><p>&nbsp;</p></li></ul><h5><a name="◻-严重性" class="md-header-anchor"></a><span>◻ 严重性</span></h5><ul><li><p><span>3.4.2 重载打印信息的严重性</span></p><figure><table><thead><tr><th><span>（严重性）宏</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>UVM_INFO</span></td><td><span>打印 信息</span><br><span>基本格式：</span><font color="blue"><span>信息id  + 打印信息 + 打印等级</span></font></td></tr><tr><td><span>UVM_WARNING</span></td><td><span>打印  警告</span></td></tr><tr><td><span>UVM_ERROR</span></td><td><span>打印  错误</span></td></tr><tr><td><span>UVM_FATAL</span></td><td><span>打印   致命错误</span></td></tr></tbody></table></figure><p><span>严重性 </span><font color="red"><span>重载</span></font>
<font color="red"><span> </span><code>set_report_*_override</code><span> </span></font></p><figure><table><thead><tr><th><span>（重载-严重性）函数</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>set_report</span><span>_</span><font color="violet"><strong><span>severity</span></strong></font><span>_override</span></td><td><span>根据  </span><font color="blue"><span>严重性</span></font><span>  进行打印重载</span><br><span>例如：</span><code>drv.set_report_severity_override(UVM_WARNING, UVM_ERROR)</code><br><span>            把 </span><code>driver</code><span> 中所有的 </span><code>UVM_WARNING</code><span> 显示为 </span><code>UVM_ERROR</code></td></tr><tr><td><span>set_report</span><span>_</span><font color="violet"><strong><span>severity_id</span></strong></font><span>_override</span></td><td><span>根据  </span><font color="blue"><span>严重性&nbsp;</span></font><span>和 </span><font color="blue"><span>信息ID</span></font><span>  进行打印重载</span><br><span>例如：</span><code>drv.set_report_severity_id_override(UVM_WARNING, "my_driver", UVM_ERROR)</code><br><span>            把 </span><code>driver</code><span> 中所有的信息ID为 </span><code>my_driver</code><span>的  </span><code>UVM_WARNING</code><span> 显示为 </span><code>UVM_ERROR</code></td></tr><tr><td><font color="blue"><strong><span>补充说明</span></strong></font></td><td><span>与设置冗余度不同，UVM  </span><font color="red"><span>不提供递归的</span></font><span> 严重性重载函数。严重性重载用的较少，一般的只会对某个</span><code>component</code><span>内使用，不会递归的使用。</span></td></tr><tr><td><font color="blue"><strong><span>编译命名</span></strong></font></td><td><sim command=""><span> +uvm_set_</span><font color="blue"><span>severity</span></font><span>=</span><comp><span>,</span><id><span>,</span><current severity=""><span>,</span><new severity=""><br><span>说明：所有的ID，可以用  </span><font color="red"><strong><span>_</span><span>ALL</span><span>_</span></strong></font><br><span>例如：</span><sim command=""><span> +uvm_set_severity="uvm_test_top.env.i_agt.drv,</span><span>_</span><span>ALL</span><span>_</span><span>,UVM_WARNING,UVM_ERROR"</span></sim></new></current></id></comp></sim></td></tr></tbody></table></figure><p>&nbsp;</p></li></ul><h5><a name="◻-控制行为" class="md-header-anchor"></a><span>◻ 控制行为</span></h5><ul><li><p><span>3.4.4~3.4.7  计数、断点、导出文件</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""控制行为"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_NO_ACTION</span> <span class="cm-meta">=</span> <span class="cm-number">'b000000</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 不做任何操作 &nbsp; </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_DISPLAY</span> <span class="cm-meta">=</span> <span class="cm-number">'b000001</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 输出（到标准输出[控制台]上）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_LOG</span> <span class="cm-meta">=</span> <span class="cm-number">'b000010</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 输出到日志文件，[它能工作的前提是设置好了日志文件]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_COUNT</span> <span class="cm-meta">=</span> <span class="cm-number">'b000100</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 作为计数目标</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_EXIT</span> <span class="cm-meta">=</span> <span class="cm-number">'b001000</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 停止仿真</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_CALL_HOOK</span> <span class="cm-meta">=</span> <span class="cm-number">'b010000</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 调用一个回调函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UVM_STOP</span> <span class="cm-meta">=</span> <span class="cm-number">'b100000</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 停止仿真，进入命令行交互模式</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""默认情况下的系统设置[源代码]"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">set_severity_action</span><span class="cm-bracket">(</span><span class="cm-variable">UVM_INFO</span>, &nbsp; &nbsp; &nbsp;<span class="cm-variable">UVM_DISPLAY</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">set_severity_action</span><span class="cm-bracket">(</span><span class="cm-variable">UVM_WARNING</span>, &nbsp; <span class="cm-variable">UVM_DISPLAY</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">set_severity_action</span><span class="cm-bracket">(</span><span class="cm-variable">UVM_ERROR</span>, &nbsp; &nbsp; <span class="cm-variable">UVM_DISPLAY</span> <span class="cm-meta">|</span> <span class="cm-variable">UVM_COUNT</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">set_severity_action</span><span class="cm-bracket">(</span><span class="cm-variable">UVM_FATAL</span>, &nbsp; &nbsp; <span class="cm-variable">UVM_DISPLAY</span> <span class="cm-meta">|</span> <span class="cm-variable">UVM_EXIT</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@  当然也可以手动设置更改：drv.set_report_severity_action(UVM_INFO, UVM_NO_ACTION); &nbsp; //什么信息都不输出</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 336px;"></div><div class="CodeMirror-gutters" style="display: none; height: 336px;"></div></div></div></pre><p>&nbsp;</p></li></ul><h5><a name="◻-计数uvmcount）" class="md-header-anchor"></a><span>◻ 计数（UVM_COUNT）</span></h5><p><span>——控制行为-计数</span></p><ul><li><p><span>3.4.3~3.4.4  UVM_ERROR到达一定数量结束仿真、UVM_* 也可加入</span></p><ul><li><p><span>UVM_ERROR</span></p><p><span>①  系统默认：</span><code>build_phase</code><span> 及之前 , 出现1次即结束仿真</span>
<span>②  可以更改，用以下函数</span></p><figure><table><thead><tr><th><span>uvm函数</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>set</span><span>_</span><font color="violet"><strong><span>report</span></strong></font><span>_max_quit_count</span></td><td><font color="blue"><span>设置</span></font><span> 某个</span><font color="red"><code>case</code></font><span> 中，UVM_ERROR 结束仿真的出现指标</span><br><span>例如：在</span><code>base_test::build_phase</code><span>中  </span><code>set_report_max_quit_count(5)</code><span>    //当出现5个UVM_ERROR时，会自动退出</span><br><font color="blue"><span>特别注意</span></font><span>：如果测试用例与</span><code>base_test</code><span>中同时设置了，则  </span><font color="red"><span>以测试用例中的设置为准</span></font></td></tr><tr><td><span>get_max_quit_count</span></td><td><font color="blue"><span>获得</span></font><span> 当前</span><code>case</code><span>中 UVM_ERROR 结束仿真的出现指标</span></td></tr><tr><td><font color="blue"><strong><span>编译命名</span></strong></font></td><td><sim command=""><span> +UVM_MAX_QUIT_COUNT=6,NO  </span><br><span>第2个参数：NO表示此值是不可以被后面的设置语句重载，YES：表示可以</span></sim></td></tr></tbody></table></figure><p>&nbsp;</p></li><li><p><span>加入计数目标</span></p><p><font color="red"><span> </span><code>set_*_action</code><span> :  UVM_COUNT</span></font></p><figure><table><thead><tr><th><span>uvm函数</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><font color="gree"><span>根据：严重性</span></font></td><td>&nbsp;</td></tr><tr><td><span>set_report</span><span>_</span><font color="violet"><strong><span>severity</span></strong></font><span>_action</span></td><td><span>将 某个</span><code>component</code><span>中的 某种 </span><font color="blue"><span>严重性</span></font><span> 加入到计数目标中 / </span><font color="red"><span>移除</span></font><br><br><span>第1个参数：可以是</span><font color="blue"><span> UVM_WARNING、UVM_INFO、UVM_ERROR</span></font><br><span>例如：</span><code>drv.set_report_severity_action(UVM_WARNING, UVM_DISPLAY|UVM_COUNT);</code><span>       // 将 warning加入到计数目标 和 error一起计数</span><br><code>drv.set_report_severity_action(UVM_ERROR, UVM_DISPLAY)</code><span>   // 将 error 移除出计数目标</span></td></tr><tr><td><span>set_report_severity_action_hier</span></td><td><span>递归的....</span></td></tr><tr><td><font color="gree"><span>根据：信息ID</span></font></td><td>&nbsp;</td></tr><tr><td><span>set_report</span><span>_</span><font color="violet"><strong><span>id</span></strong></font><span>_action</span></td><td><span>将 某个</span><code>component</code><span>中的某种 </span><font color="blue"><span>信息ID</span></font><span> 加入到计数目标中 / </span><font color="red"><span>移除</span></font><br><span>第1个参数：可以是</span><font color="blue"><span> UVM_WARNING、UVM_INFO、UVM_ERROR</span></font><span>、</span><font color="red"><span>UVM_FATAL</span></font><br><span>例如：</span><code>drv.set_report_id_action("my_drv", UVM_DISPLAY| UVM_COUNT);</code></td></tr><tr><td><span>set_report_id_action_hier</span></td><td><span>递归的....</span></td></tr><tr><td><font color="gree"><span>根据：严重性+信息ID</span></font></td><td>&nbsp;</td></tr><tr><td><span>set_report</span><span>_</span><font color="violet"><strong><span>severity_id</span></strong></font><span>_action</span></td><td><span>例如：</span><code>drv.set_report_severity_id_action(UVM_WARNING, "my_driver", UVM_DISPLAY| UVM_COUNT);</code></td></tr><tr><td><span>.set_report_severity_id_action_hier</span></td><td><span>递归的....</span></td></tr><tr><td><font color="blue"><strong><span>编译命名</span></strong></font></td><td><sim command=""><span> +uvm_set</span><span>_</span><font color="blue"><span>action</span></font><span>=</span><comp><span>,</span><id><span>,</span><severity><span>,</span><action><br><span>说明：所有的ID，可以用  </span><font color="red"><strong><span>_</span><span>ALL</span><span>_</span></strong></font><br><span>例如：</span><sim command=""><span> +uvm_set_action="uvm_test_top.env.i_agt.drv,</span><span>_</span><span>ALL_,UVM_WARNING,UVM_DISPLAY</span><span>|</span><span>UVM_COUNT"</span></sim></action></severity></id></comp></sim></td></tr></tbody></table></figure></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p></li></ul><h5><a name="◻-断点uvmstop）" class="md-header-anchor"></a><span>◻ 断点（UVM_STOP）</span></h5><ul><li><p><span>3.4.5 UVM的断点功能</span></p><p><font color="blue"><span>函数</span></font><span>，同上方 【计数（UVM_COUNT）-加入计数目标】章节  </span><font color="red"><strong><span>set</span><span>_</span><span>*_action</span></strong></font></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">base_test</span>代码》<span class="cm-variable">connect_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">drv</span>.<span class="cm-variable">set_report_severity_action</span><span class="cm-bracket">(</span><span class="cm-variable">UVM_WARNING</span>, <span class="cm-variable">UVM_DISPLAY</span><span class="cm-meta">|</span> <span class="cm-variable">UVM_STOP</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ 根据严重性设置UVM_STOP</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 编译命令还是 uvm_set_action, &nbsp; 只是将 UVM_COUNT 替换为 UVM_STOP 即可</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 179px;"></div><div class="CodeMirror-gutters" style="display: none; height: 179px;"></div></div></div></pre><p>&nbsp;</p><p>&nbsp;</p></li></ul><p>&nbsp;</p><h5><a name="◻-导出到文件uvmlog）" class="md-header-anchor"></a><span>◻ 导出到文件（UVM_LOG）</span></h5><ul><li><p><span>3.4.6 将输出信息导入文件中</span>
<span>—— </span><strong><span>UVM_LOG</span></strong><span>： 输出到日志文件，它能工作的前提是  </span><font color="blue"><span>设置好了日志文件</span></font><span>  </span><font color="red"><span> &lt;</span><code>set_*_action</code><span>  +   </span><code>set_*_file</code><span>&nbsp;&gt;&nbsp;</span></font>
<font color="red"><span> </span><code>set_*_action</code><span>&nbsp;:&nbsp; UVM_LOG </span></font>
<font color="red"><span> </span><code>set_*_file</code><span> : 文件名&nbsp;</span></font></p><figure><table><thead><tr><th><span>uvm函数</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><font color="gree"><span>根据：严重性</span></font></td><td>&nbsp;</td></tr><tr><td><span>set_report</span><span>_</span><font color="violet"><strong><span>severity</span></strong></font><span>_file</span></td><td><span>将 某个</span><code>component</code><span> 的某种 </span><font color="blue"><span>严重性</span></font><span>，输出到 </span><font color="blue"><span>指定名称</span></font><span> 的日志文件中</span><br><span>例如：</span><code>drv.set_report_severity_file(UVM_INFO, info_log)</code></td></tr><tr><td><span>set_report_severity_file_hier</span></td><td><span>递归的.....</span></td></tr><tr><td><font color="gree"><span>根据：信息ID</span></font></td><td>&nbsp;</td></tr><tr><td><span>set_report</span><span>_</span><font color="violet"><strong><span>id</span></strong></font><span>_file</span></td><td><span>将 某个</span><code>component</code><span> 的某 </span><font color="blue"><span>信息ID</span></font><span>，输出到 </span><font color="blue"><span>指定名称</span></font><span> 的日志文件中</span><br><span>例如：</span><code>drv.set_report_id_file("my_driver", driver_log)</code></td></tr><tr><td><span>set_report_id_file_hier</span></td><td><span>递归的.....</span></td></tr><tr><td><font color="gree"><span>根据：严重性+信息ID</span></font></td><td>&nbsp;</td></tr><tr><td><span>set_report</span><span>_</span><font color="violet"><strong><span>severity_id</span></strong></font><span>_file</span></td><td><span>将 某个</span><code>component</code><span> 的某种 </span><font color="blue"><span>严重性</span></font><span>和某 </span><font color="blue"><span>信息ID</span></font><span>，输出到 </span><font color="blue"><span>指定名称</span></font><span> 的日志文件中</span><br><span>例如：</span><code>drv.set_report_severity_id_file(UVM_WARNING, "my_driver",driver_ &lt;br/&gt;log)</code></td></tr><tr><td><span>set_report_severity_id_file_hier</span></td><td><span>递归的.....</span></td></tr></tbody></table></figure></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h4><a name="35-configdb机制" class="md-header-anchor"></a><span>3.5 config_db机制</span></h4><ul><li><p><code>config</code><span>  vs  </span><code>config_db</code></p><p><strong><font color="red"><code>config</code></font></strong><span>  指的是把所有的参数放在一个</span><code>object</code><span>中，主要的作用是   </span><font color="blue"><span>规范验证平台的行为方式</span></font></p><p><strong><font color="red"><code>config_db</code></font></strong><span> 是将参数设置给所有需要的</span><code>component</code><span>的一种方式</span></p><p><code>config_db机制</code><span>的作用：用于在UVM验证平台间 </span><font color="blue"><span>传递参数</span></font></p></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h5><a name="◻-路径-vs-层次结构" class="md-header-anchor"></a><span>◻ 路径 vs 层次结构</span></h5><ul><li><p><span>3.5.1 UVM中的路径</span></p><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-config_db机制-路径vs层次结构.jpg" referrerpolicy="no-referrer"></p></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h5><a name="◻-configdbset--get" class="md-header-anchor"></a><span>◻ config_db::set / get</span></h5><h6><a name="▨-set--get-" class="md-header-anchor"></a><span>▨ </span><code>set</code><span> &amp; </span><code>get</code></h6><ul><li><p><span>3.5.2 set与get函数的参数</span></p><figure><table><thead><tr><th><span>函数</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>uvm_config_db#(int)::set(this,   "env.i_agt.drv",   "pre_num",   100);</span></td><td><span>设置参数值（寄信）</span></td></tr><tr><td><span>uvm_config_db#(int)::get(this,   "",   "pre_num",   pre_num);</span></td><td><span>获得参数值（收信）</span></td></tr><tr><td><font color="blue"><strong><span>参数说明</span></strong></font></td><td><span>第1参数： </span><code>component</code><font color="red"><span>实例指针</span></font><br><span>第2参数：</span><string><span> </span><font color="blue"><span>相对</span></font><span>此实例的</span><font color="blue"><span>路径</span></font><br><span>第3参数：</span><string><span> 目标参数记号</span><br><span>第4参数：【set】要设置的 </span><font color="blue"><span>值</span></font><br><span>                 【get】get值后要设置的 </span><font color="blue"><span>变量</span></font></string></string></td></tr><tr><td><font color="blue"><span>补充说明</span></font></td><td><span>① 第1+第2 个参数 = 组成</span><font color="blue"><span>目标路径</span></font><br><span>② </span><font color="red"><code>null</code><span> = </span><code>uvm_root::get()</code></font><br><span>③  </span><font color="red"><code>this</code></font><span> 指的是 </span><font color="red"><span>当前实例指针</span></font><br><span>④  </span><code>set</code><span>和</span><code>get</code><span>中</span><font color="blue"><span> 第三个参数 </span></font><span>可以不一致，但最好一致  </span><a href="file:///E:/Disc/%E3%80%901%E3%80%91~~%E5%B8%B8%E7%94%A8~~/%E3%80%90D-%E5%99%A8%E3%80%91%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E3%80%81%E5%B7%A5%E5%85%B7/10%20Verilog+SV+UVM+EDA+Makefile/UVM.html#Ctrl%E8%B7%B3%E8%BD%AC4"><span>(这样</span><code>file_automation</code><span> 可以省略</span><code>get</code><span>语句)</span></a></td></tr></tbody></table></figure></li></ul><p>&nbsp;</p><ul><li><p><span>3.5.3 省略get语句</span></p><p><font color="red"><strong><span>省略 </span><code>config_db::get</code></strong></font><span>，及其3个前提条件：</span><a href="file:///E:/Disc/%E3%80%901%E3%80%91~~%E5%B8%B8%E7%94%A8~~/%E3%80%90D-%E5%99%A8%E3%80%91%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E3%80%81%E5%B7%A5%E5%85%B7/10%20Verilog+SV+UVM+EDA+Makefile/UVM.html#Ctrl%E8%B7%B3%E8%BD%AC4"><span>参见【field_automation机制-自动获得参数值】 </span></a></p><p>&nbsp;</p></li></ul><h6><a name="▨-场景跨层多次set" class="md-header-anchor"></a><span>▨ 场景：跨层多次set</span></h6><p><span>——看：① 权威；② 时间</span></p><ul><li><p><span>3.5.4 跨层次的多重设置</span></p><ul><li><p><span>标准：先看 </span><strong><font color="red"><span>发信人</span></font></strong><span> 的权威，看</span><font color="blue"><span>高</span></font><span>的；当权威一致时，看 </span><strong><font color="red"><span>时间</span></font></strong><span>，看</span><font color="blue"><span>近</span></font><span>的； </span></p></li><li><p><font color="red"><span>发信人权威</span></font><span> 的鉴别：</span>
<span>① </span><code>set</code><span> 第一参数为</span><code>this</code><span>， </span><code>component</code><span>树结构就是发信人，树结构越高，越权威；   </span><font color="red"><span>&lt;推荐&gt;</span></font></p><p><span>②  </span><code>set</code><span> 第一参数为 </span><code>null</code><span>或者 </span><code>uvm_root：：get（）</code><span>, 不管</span><code>component</code><span>， 调用</span><code>set</code><span>的权威最高</span></p></li><li><p><span>示例：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""发信人权威 + 时间  -案例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-keyword">case</span>代码》<span class="cm-variable">build_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_root</span>::<span class="cm-variable">get</span><span class="cm-bracket">()</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 此处就不管test了，就是 根（uvm_top）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"uvm_test_top.env.i_agt.drv"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"pre_num"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">999</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"my_case0"</span>, <span class="cm-string">"in my_case0, env.i_agt.drv.pre_num is set to 999"</span>, <span class="cm-variable">UVM_LOW</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">env</span>代码》<span class="cm-variable">build_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_root</span>::<span class="cm-variable">get</span><span class="cm-bracket">()</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 此处就不管test了，就是 根（uvm_top）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"uvm_test_top.env.i_agt.drv"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"pre_num"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">100</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"my_env"</span>, <span class="cm-string">"in my_env, env.i_agt.drv.pre_num is set to 100"</span>,<span class="cm-variable">UVM_LOW</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@  输出 </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">driver</span>得到的<span class="cm-variable">pre_num</span>的值是<span class="cm-number">100</span>。<span class="cm-bracket">[</span><span class="cm-variable">env</span>的结果<span class="cm-bracket">]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 分析：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">1</span>） <span class="cm-variable">test</span>和<span class="cm-variable">env</span>的<span class="cm-variable">set</span>的第一参数都是<span class="cm-variable">uvm_root</span>::<span class="cm-variable">get</span><span class="cm-bracket">()</span>，他们的权威都是 根<span class="cm-variable">uvm_top</span>（相同）。这种情况下，需要进一步比较时间，而<span class="cm-bracket">[</span><span class="cm-variable">UVM</span>的<span class="cm-variable">build_phase</span>是自上而下执行的<span class="cm-bracket">]</span>，所以 <span class="cm-variable">env</span>后执行，所以是<span class="cm-number">100</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">2</span>）若将上述<span class="cm-number">2</span>处，都修改为 <span class="cm-keyword">this</span>，那么结果就是 <span class="cm-variable">test</span>的权威比 <span class="cm-variable">env</span>的高，结果等于<span class="cm-number">999</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 694px;"></div><div class="CodeMirror-gutters" style="display: none; height: 694px;"></div></div></div></pre></li></ul></li></ul><p>&nbsp;</p><p>&nbsp;</p><h6><a name="▨-场景同层多次set" class="md-header-anchor"></a><span>▨ 场景：同层多次set</span></h6><p><span>——权威相同，看：时间</span></p><ul><li><p><span>3.5.5 同一层次的多重设置</span></p><ul><li><p><span>标准： 看 </span><strong><font color="red"><span>时间</span></font></strong><span> </span><font color="blue"><span>近</span></font><span>的</span></p></li><li><p><span>应用场景：派生自</span><code>base_test</code><span> 的 </span><code>case</code><span> 激励-</span><code>build_phase</code><span> 的 </span><code>set</code><span> 更新 </span></p></li><li><p><span>代码：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""`case` 激励-`build_phase` 的 `set` 更新"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 同一层次，权威相同，看时间近的</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 而，build_phase 是 由上至下 执行的，派生出来的会在后面执行</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">base_test</span>代码》父类<span class="cm-meta">-</span><span class="cm-variable">build_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">classs</span> <span class="cm-variable">base_test</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_test</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"env.i_agt.drv"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">pre_num_max</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">7</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《正常的<span class="cm-keyword">case</span>：<span class="cm-variable">case1</span><span class="cm-meta">~</span><span class="cm-variable">case99</span>代码》子类<span class="cm-meta">-</span>直接继承<span class="cm-meta">-</span><span class="cm-variable">build_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">case1</span> <span class="cm-keyword">extends</span> <span class="cm-variable">base_test</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《特殊的<span class="cm-keyword">case</span>：<span class="cm-variable">case100</span>代码》子类<span class="cm-meta">-</span>更新掉（可以理解为重载了）<span class="cm-meta">-</span><span class="cm-variable">build_phase</span> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">case100</span> <span class="cm-keyword">extends</span> <span class="cm-variable">base_test</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>, &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"env.i_agt.drv"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">pre_num_max</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">100</span><span class="cm-bracket">)</span>; <span class="cm-comment">//@@ build_phase 是 由上至下 执行的，派生出来的会在后面执行</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; <span class="cm-comment">//@@ pre_num_max 值会等于100</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> &nbsp;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 762px;"></div><div class="CodeMirror-gutters" style="display: none; height: 762px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h6><a name="▨-场景非直线setx）--get✔）" class="md-header-anchor"></a><span>▨ 场景：非直线set（x） &amp; get（✔）</span></h6><ul><li><p><span>3.5.6 非直线的设置与获取</span></p><ul><li><p><span>非直线：例如：</span><font color="blue"><strong><span>非直线的设置（set）</span></strong></font><span> - 通过</span><code>scoreboard</code><span> 对 </span><code>driver</code><span>的某些变量进行 </span><code>config_db::set</code>
<span>    </span><code>driver</code><span>的路径为</span><code>uvm_test_top.env.i_agt.drv</code><span>    </span><font color="red"><strong><span>&lt;不推荐&gt;</span></strong></font></p><p><span>					</span><span> </span><span>	</span><font color="blue"><strong><span>非直线的获取（get）</span></strong></font><span> - </span><code>reference model</code><span>中获取其他</span><code>component</code><span>设置给</span><code>my_driver</code><span>的参数的值  </span><font color="red"><strong><span>&lt;推荐&gt;</span></strong></font></p></li><li><p><span>注意点：无论是设置（set）还是获取（get）,都需要 注意 </span><strong><span>第1参数</span></strong><span>（例化组件实例指针）和 </span><strong><span>第2参数</span></strong><span>（相对此实例的路径）</span></p></li><li><p><span>推荐/不推荐：</span></p><p><span>① </span><strong><span>不推荐</span></strong><span> 非直线的设置（set），会有一定的风险，应该避免这种情况，原因是： </span><code>build_phase</code><span> 同级是</span><font color="blue"><span>字典序的，存在不确定性 </span></font></p><p><span>② </span><strong><span>推荐</span></strong><span> 非直线的获取（get），可以在验证平台中 </span><font color="blue"><span>多个组件</span></font><span>（UVM树结点）需要</span><font color="blue"><span>使用同一个参数</span></font><span>时，</span><font color="blue"><span>减少</span><code>config_db::set</code><span>的冗余</span></font></p></li><li><p><span>示例代码：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""[非直线的获取（get）]可以在某些情况下避免config_db：：set的冗余-示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ reference model中获取driver的pre_num的值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">reference</span> <span class="cm-variable">model</span>代码》<span class="cm-variable">build_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_model</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">port</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"port"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ap</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"ap"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"my_model"</span>, <span class="cm-meta">$sformatf</span><span class="cm-bracket">(</span><span class="cm-string">"before get, the pre_num is %0d"</span>, <span class="cm-variable">drv_pre_num</span><span class="cm-bracket">)</span>, <span class="cm-variable">UVM_LOW</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">void</span>'<span class="cm-bracket">(</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span><span class="cm-bracket">)</span>::<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>.<span class="cm-variable">m_parent</span>, &nbsp; <span class="cm-comment">//@@ 非直线的获取</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"i_agt.drv"</span>, &nbsp; &nbsp; <span class="cm-comment">//@@ reference model中获取driver的pre_num的值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"pre_num"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">drv_pre_num</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"my_model"</span>, <span class="cm-meta">$sformatf</span><span class="cm-bracket">(</span><span class="cm-string">"after get, the pre_num is %0d"</span>, <span class="cm-variable">drv_pre_num</span><span class="cm-bracket">)</span>, <span class="cm-variable">UVM_LOW</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 上述config_db::get方式 也可以这么写</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">void</span>'<span class="cm-bracket">(</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span><span class="cm-bracket">)</span>::<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_root</span>::<span class="cm-variable">get</span><span class="cm-bracket">()</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"uvm_test_top.env.i_agt.drv"</span>, &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 和上面等价</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"pre_num"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">drv_pre_num</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 分析</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1</span>、【非直线的获取】在<span class="cm-variable">reference</span> <span class="cm-variable">model</span>中获取<span class="cm-variable">driver</span>的<span class="cm-variable">pre_num</span>的值</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2</span>、如果不这样做，而采用【直线获取】的方式，那么需要在测试用例中通过<span class="cm-variable">cofig_db</span>：：<span class="cm-variable">set</span>分别给<span class="cm-variable">reference</span> <span class="cm-variable">model</span>和<span class="cm-variable">driver</span>设置<span class="cm-variable">pre_num</span>的值。</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">3</span>、同样的参数值设置出现在不同的两条语句中，这大大增加了出错的可能性。</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 672px;"></div><div class="CodeMirror-gutters" style="display: none; height: 672px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h5><a name="◻-configdb调试" class="md-header-anchor"></a><span>◻ </span><code>config_db</code><span>调试</span></h5><p><strong><font color="red"><code>config_db</code><span>机制致命缺点</span></font></strong><span>：</span><code>set</code><span>函数的</span><font color="blue"><span>第二个参数</span></font><span> 是字符串，如果字符串写错，那么根本就不能正确地设置参数值</span></p><p><span>如果 </span><code>set</code><span>函数的</span><font color="blue"><span>第二个参数</span></font><span>设置错误，以下 各种调试方式，</span><strong><font color="red"><span>都不会</span></font></strong><span> 给出错误信息。</span></p><p><span>若要解决这个问题，需要参见：</span><a href="file:///E:/Disc/%E3%80%901%E3%80%91~~%E5%B8%B8%E7%94%A8~~/%E3%80%90D-%E5%99%A8%E3%80%91%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E3%80%81%E5%B7%A5%E5%85%B7/10%20Verilog+SV+UVM+EDA+Makefile/UVM.html#Ctrl%E8%B7%B3%E8%BD%AC21"><span>参见【10.6 参数-用自定义函数check_all 去检查第2参数】 </span></a></p><p>&nbsp;</p><ul><li><p><span>3.5.8、3.5.10 </span><code>config_db</code><span>的调试</span></p><ul><li><p><font color="blue"><code>check_config_usage</code></font></p><p><span>——可以</span><font color="red"><span>间接的&nbsp;推测</span></font><span>：第2参数有没有写错</span>
<strong><font color="red"><span>有写没读的情况：</span></font></strong>
<span>①  </span><code>set</code><span> 和  </span><code>get</code><span> </span><font color="blue"><span>路径名称（第2参数）</span></font><span>不一致 / </span><font color="blue"><span>变量名称（第3参数）</span></font><span>不一致 </span>
<span>②  全都一致，但是  </span><font color="blue"><span>还没到调用的 </span><code>phase</code><span> 阶段</span></font>
<span>     (例如在</span><code>connect_phase</code><span> 调用该</span><code>check_config_usage</code><span>函数，看</span><code>default_sequence</code><span>，</span>
<span>       结果肯定是：已写未读，因为读的</span><code>phase</code><span>阶段是</span><code>main_phase</code><span>，还没到)</span></p><figure><table><thead><tr><th><span>函数</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>check_config_usage</span></td><td><span>显示出截止到函数调用时，系统中有哪些 参数 </span><font color="blue"><span>被设置（set）过但是没有被读取（get）过</span></font></td></tr><tr><td><font color="blue"><span>补充说明</span></font></td><td><span>由于</span><code>config_db</code><span>的</span><code>set</code><span>及</span><code>get</code><span>语句一般都用于</span><code>build_phase</code><span>阶段，所以此函数一般</span><font color="red"><span>在</span><code>connect_phase</code><span>被调用</span></font><span>，它也可以在</span><code>connect_phase</code><span> </span><strong><font color="red"><span>后&nbsp;</span></font></strong><span>的任一</span><code>phase</code><span>被调用</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""check_config_usage 函数被调用-示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-keyword">case</span>代码》<span class="cm-variable">build_phase</span>：进行<span class="cm-variable">set</span>、<span class="cm-variable">get</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_object_wrapper</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"env.i_agt.sqr.main_phase"</span>, &nbsp; &nbsp; <span class="cm-comment">//@@ 发生在main_phase阶段</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"default_sequence"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">case0_sequence</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">get</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"env.i_atg.drv"</span>, &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 【！】故意将 i_agt 错写成  i_atg</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"pre_num"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">999</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"env.mdl"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"rm_value"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">10</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-keyword">case</span>代码》在<span class="cm-variable">connect_phase</span>：进行读取【被设置但是没有被<span class="cm-variable">get</span>的情况】</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ connect_phase 或是 这之后</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">check_config_usage</span><span class="cm-bracket">()</span>; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 输出</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《控制台打印信息》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">#</span> <span class="cm-variable">default_sequence</span> <span class="cm-bracket">[</span><span class="cm-meta">/^</span><span class="cm-variable">uvm_test_top</span>\.<span class="cm-variable">env</span>\.<span class="cm-variable">i_agt</span>\.<span class="cm-variable">sqr</span>\.<span class="cm-variable">main_phase$</span><span class="cm-meta">/</span><span class="cm-bracket">]</span> : <span class="cm-bracket">(</span><span class="cm-keyword">class</span> <span class="cm-variable">uvm_pkg</span>::<span class="cm-variable">uvm_object_wr</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">#</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">#</span> <span class="cm-variable">uvm_test_top</span> <span class="cm-variable">reads</span>: <span class="cm-number">0</span> @ <span class="cm-number">0</span> <span class="cm-variable">writes</span>: <span class="cm-number">1</span> @ <span class="cm-number">0</span> &nbsp; &nbsp;<span class="cm-comment">//@@ default_sequence 被设置1次，被读取0次</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">#</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 原因是：main_phase 发生在connect_phase之后，还没被读取 &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">#</span> <span class="cm-variable">pre_num</span> <span class="cm-bracket">[</span><span class="cm-meta">/^</span><span class="cm-variable">uvm_test_top</span>\.<span class="cm-variable">env</span>\.<span class="cm-variable">i_atg</span>\.<span class="cm-variable">drv$</span><span class="cm-meta">/</span><span class="cm-bracket">]</span> : <span class="cm-bracket">(</span><span class="cm-keyword">int</span><span class="cm-bracket">)</span> <span class="cm-number">999</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">#</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">#</span> <span class="cm-variable">uvm_test_top</span> <span class="cm-variable">reads</span>: <span class="cm-number">0</span> @ <span class="cm-number">0</span> <span class="cm-variable">writes</span>: <span class="cm-number">1</span> @ <span class="cm-number">0</span> &nbsp; &nbsp;<span class="cm-comment">//@@ pre_num 被设置1次，被读取0次</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 原因是：将 i_agt 错写成了 i_atg， &nbsp; 导致没读取到</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 829px;"></div><div class="CodeMirror-gutters" style="display: none; height: 829px;"></div></div></div></pre></li></ul><p>&nbsp;</p><ul><li><p><span>其他调试</span></p><figure><table><thead><tr><th><span>函数</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>print_config(1);</span></td><td><span>遍历整个验证平台的所有结点，找出哪些</span><font color="blue"><span>被设置过（set）的信息&nbsp;</span></font><span>对于它们是可见的</span><br><span>参数：1-递归的查询；  </span><br><span>            0-只显示当前component的信息</span></td></tr><tr><td><font color="blue"><strong><span>编译命令</span></strong></font></td><td><sim command=""><span> +UVM_CONFIG_DB_TRACE</span></sim></td></tr></tbody></table></figure><p>&nbsp;</p><p>&nbsp;</p></li></ul></li></ul><p>&nbsp;</p><p>&nbsp;</p><h5><a name="◻-不建议项" class="md-header-anchor"></a><span>◻ 不建议项</span></h5><ul><li><p><span>3.5.7 config_db机制对通配符的支持</span></p><p><span>config_db机制支持通配符，但是 </span><font color="blue"><span>不建议</span></font><span> 过度使用 </span><font color="red"><span>通配符</span></font></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""config_db机制支持通配符，但是不建议过度使用通配符"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">top_tb</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">virtual</span> <span class="cm-variable">my_if</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">null</span>, <span class="cm-string">"uvm_test_top.env.i_agt*"</span>, <span class="cm-string">"vif"</span>, <span class="cm-variable">input_if</span><span class="cm-bracket">)</span>; &nbsp;<span class="cm-comment">//@@ 可以，最好不用</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">virtual</span> <span class="cm-variable">my_if</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">null</span>, <span class="cm-string">"*i_agt*"</span>, <span class="cm-string">"vif"</span>, <span class="cm-variable">input_if</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 应避免</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>3.5.9 set_config与get_config</span></p><p><font color="blue"><span>不建议</span></font><span> 使用</span><code>set_config_*</code><span>和</span><code>get_config_*</code><span>，例如：</span><code>set_config_int</code><span>     </span><font color="red"><span>&lt;已过时&gt;</span></font></p><p><code>config_db</code><span> 对比 </span><code>set/get_config</code><span> 强大的地方在于，它设置的参数类型并不局限于以上三种（</span><font color="blue"><span>int、string、object</span></font><span>）。常见的</span><font color="blue"><span>枚举类型、virtual interface、bit类型、队列</span></font><span> 等都可以成为</span><code>config_db</code><span>设置的 </span><strong><span>数据类型</span></strong><span>。</span></p><figure><table><thead><tr><th><span>编译命令</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><font color="blue"><strong><span>等价编译命令</span></strong></font></td><td>&nbsp;</td></tr><tr><td><sim command=""><span> +uvm_set_config_int=</span><comp><span>,</span><field><span>,</span><value></value></field></comp></sim></td><td><span>例如：</span><sim command=""><span> +uvm_set_config_int="uvm_test_top.env.i_agt.drv,pre_num,'h8"</span></sim></td></tr><tr><td><sim command=""><span> +uvm_set_config_string=</span><comp><span>,</span><field><span>,</span><value></value></field></comp></sim></td><td>&nbsp;</td></tr></tbody></table></figure><p>&nbsp;</p></li></ul><h5><a name="补充" class="md-header-anchor"></a><span>补充：</span></h5><ul><li><span>config_db 高阶：</span><a href="file:///E:/Disc/%E3%80%901%E3%80%91~~%E5%B8%B8%E7%94%A8~~/%E3%80%90D-%E5%99%A8%E3%80%91%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E3%80%81%E5%B7%A5%E5%85%B7/10%20Verilog+SV+UVM+EDA+Makefile/UVM.html#Ctrl%E8%B7%B3%E8%BD%AC21"><span>参见【10.6 参数-用自定义函数check_all 去检查第2参数】 </span></a></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h3><a name="ch-4tlm通信" class="md-header-anchor"></a><span>Ch. 4_TLM通信</span></h3><p><font color="red"><strong><span>要点总结</span></strong><span>：</span></font>
<font color="red"><strong><span>一对一</span></strong><span>：port、export、imp   +  put、get、peek、get_peek、transport</span></font>
<font color="red"><strong><span>一对多</span></strong><span>：analysis   +   write 、   FIFO</span></font></p><h4><a name="41-端口介绍" class="md-header-anchor"></a><span>4.1 端口介绍</span></h4><ul><li><p><span>4.1.1~4.1.3  控制流、数据流、端口</span></p></li><li><p><span>操作</span></p><p><span>三者皆有阻塞、非阻塞之分</span></p><figure><table><thead><tr><th><span>操作</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>put</span></td><td><span>主动发送</span></td></tr><tr><td><span>get</span></td><td><span>主动获取</span></td></tr><tr><td><span>transport</span></td><td><span>transport操作相当于一次put加一次get操作，这两次操作的“发起者”都是A，也称 request-response操作。</span></td></tr></tbody></table></figure><p>&nbsp;</p><p>&nbsp;</p></li><li><p><span>端口类型</span></p><figure><table><thead><tr><th><span>端口</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>port</span></td><td>&nbsp;</td></tr><tr><td><span>export</span></td><td>&nbsp;</td></tr><tr><td><span>imp</span></td><td>&nbsp;</td></tr><tr><td><font color="blue"><span>&nbsp;&lt;analysis系列&gt;&nbsp;</span></font></td><td><span>analysis_port</span><br><span>analysis_export</span><br><span>analysis_imp</span><br><span>analysis_fifo</span></td></tr></tbody></table></figure><p><span>UVM中三种端口 </span><font color="red"><span>控制流</span></font><span>：PORT &gt;  EXPORT &gt; IMP。  </span><font color="blue"><span>&lt;靠前为主动方，靠后为被动方&gt;</span></font></p><p><span>IMP的优先级最低，一个PORT可以连接到一个IMP，并发起三种操作，反之则不行。</span></p><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-TLM机制-port端口图.jpg" referrerpolicy="no-referrer"></p><ul><li><p><span>端口 声明</span></p><p><span>① 5种操作：put、get、peek、get_peek、transport</span></p><p><span>② 3类阻塞/非阻塞：blocking、nonblocking、不写（可以是blocking，也可以是nonblocking）</span></p><p><span>③ analysis 系列端口，没有阻塞/非阻塞之分</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ export 端口 只需将下方的 port==&gt;export</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ imp 端口 只需将 port==&gt;imp，参数多加个imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""【port】声明方法"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_blocking_put_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; <span class="cm-variable">x_port</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ put</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_nonblocking_put_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span><span class="cm-bracket">)</span> &nbsp; &nbsp;<span class="cm-variable">x_port</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ T：tr</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_put_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x_port</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//不写,  可以是blocking，也可以是nonblocking</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_blocking_get_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; <span class="cm-variable">x_port</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ get</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_nonblocking_get_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span><span class="cm-bracket">)</span> &nbsp; &nbsp;<span class="cm-variable">x_port</span>;<span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_get_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x_port</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_blocking_peek_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp;<span class="cm-variable">x_port</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ peek</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_nonblocking_peek_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span><span class="cm-bracket">)</span> &nbsp; <span class="cm-variable">x_port</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_peek_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">x_port</span>; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_blocking_get_peek_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span><span class="cm-bracket">)</span> &nbsp; &nbsp;<span class="cm-variable">x_port</span>; &nbsp; <span class="cm-comment">//@@ get_peek = get + peek</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_nonblocking_get_peek_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span><span class="cm-bracket">)</span> <span class="cm-variable">x_port</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_get_peek_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">x_port</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_blocking_transport_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">REQ</span>, <span class="cm-variable">RSP</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; <span class="cm-variable">x_port</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ transport</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_nonblocking_transport_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">REQ</span>, <span class="cm-variable">RSP</span><span class="cm-bracket">)</span> &nbsp; &nbsp;<span class="cm-variable">x_port</span>; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_transport_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">REQ</span>, <span class="cm-variable">RSP</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x_port</span>; &nbsp;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 515px;"></div><div class="CodeMirror-gutters" style="display: none; height: 515px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""【imp】声明方法"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_blocking_put_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span>, <span class="cm-variable">IMP</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">x_imp</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ put</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_nonblocking_put_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span>, <span class="cm-variable">IMP</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x_imp</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ IMP：组件类的名称</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_put_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span>, <span class="cm-variable">IMP</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x_imp</span>; &nbsp; &nbsp;<span class="cm-comment">//不写,  可以是blocking，也可以是nonblocking</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_blocking_get_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span>, <span class="cm-variable">IMP</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">x_imp</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ get</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_nonblocking_get_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span>, <span class="cm-variable">IMP</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x_imp</span>; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_get_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span>, <span class="cm-variable">IMP</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x_imp</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_blocking_peek_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span>, <span class="cm-variable">IMP</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x_imp</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ peek</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_nonblocking_peek_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span>, <span class="cm-variable">IMP</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; <span class="cm-variable">x_imp</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_peek_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span>, <span class="cm-variable">IMP</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">x_imp</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_blocking_get_peek_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span>, <span class="cm-variable">IMP</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp;<span class="cm-variable">x_imp</span>; &nbsp; &nbsp;<span class="cm-comment">//@@  get_peek</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_nonblocking_get_peek_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span>, <span class="cm-variable">IMP</span><span class="cm-bracket">)</span> &nbsp; <span class="cm-variable">x_imp</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_get_peek_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span>, <span class="cm-variable">IMP</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">x_imp</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_blocking_transport_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">REQ</span>, <span class="cm-variable">RSP</span>, <span class="cm-variable">IMP</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; <span class="cm-variable">x_imp</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ transport</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_nonblocking_transport_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">REQ</span>, <span class="cm-variable">RSP</span>, <span class="cm-variable">IMP</span><span class="cm-bracket">)</span> &nbsp; &nbsp;<span class="cm-variable">x_imp</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_transport_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">REQ</span>, <span class="cm-variable">RSP</span>, <span class="cm-variable">IMP</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x_imp</span>; </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 448px;"></div><div class="CodeMirror-gutters" style="display: none; height: 448px;"></div></div></div></pre><p>&nbsp;</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"""【analysis系列端口】声明方法"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_analysis_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp;<span class="cm-variable">x_ap</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_analysis_export</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span><span class="cm-bracket">)</span> &nbsp; &nbsp; <span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-tab" role="presentation" cm-text="	">   </span> &nbsp;<span class="cm-variable">x_aexp</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_analysis_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span>, <span class="cm-variable">IMP</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">x_aimp</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ IMP：组件类的名称</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 【<span class="cm-variable">imp</span>后缀声明】</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">step</span><span class="cm-meta">-</span><span class="cm-number">1</span>: &nbsp; 宏注册后缀，示例： &nbsp; <span class="cm-def">`uvm_analysis_imp_decl</span><span class="cm-bracket">(</span><span class="cm-variable">_monitor</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">step</span><span class="cm-meta">-</span><span class="cm-number">2</span>: &nbsp; 后缀声明方式，示例： &nbsp;<span class="cm-variable">uvm_analysis_imp_monitor</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span>, <span class="cm-variable">my_scoreboard</span><span class="cm-bracket">)</span> <span class="cm-variable">monitor_imp</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">step</span><span class="cm-meta">-</span><span class="cm-number">3</span>: &nbsp; 后续的<span class="cm-variable">write</span>函数也要加上后缀： &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">write_monitor</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>【<span class="cm-variable">analysis_fifo</span>声明】</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_tlm_analysis_fifo</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span><span class="cm-bracket">)</span> &nbsp; &nbsp; <span class="cm-tab" role="presentation" cm-text="	">  </span> <span class="cm-tab" role="presentation" cm-text="	">   </span> &nbsp;<span class="cm-variable">x1_x2_fifo</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_tlm_fifo</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">T</span><span class="cm-bracket">)</span> &nbsp; &nbsp; <span class="cm-tab" role="presentation" cm-text="	">   </span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp;<span class="cm-variable">x1_x2_fifo</span>; &nbsp; &nbsp;<span class="cm-comment">//@@  FIFO内部比上面的 少一个 analysis_export</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 269px;"></div><div class="CodeMirror-gutters" style="display: none; height: 269px;"></div></div></div></pre><p>&nbsp;</p></li></ul><p><span> </span></p><p><span>  </span></p></li></ul><p>&nbsp;</p><h4><a name="42--一对一通信" class="md-header-anchor"></a><span>4.2  一对一通信</span></h4><ul><li><p><span>4.2.1~4.2.6  blocking_</span><strong><span>put</span></strong><span> 端口互联</span></p><p><span>① 编写基本过程：</span>
<span>		</span><span>step-1： 声明</span><span>	</span>
<span>		</span><span>step-2： 例化  （new）</span>
<span>		</span><span>step-3： 连接  （connect）    </span><font color="blue"><span>&lt;在env连接 / 大组件里面连接， 取决于裸露在什么空间下 &gt;</span></font>
<span>		</span><span>step-4： 发送激励  （port . put( tr )）</span>
<span>		</span><span>step-5： 被动方 - 构造 </span><font color="blue"><span>操作任务 / 函数</span></font><span>   （put、get、peek、get_peek、transport）</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>function new (string name,</span><br><span>                         uvm_component parent,</span><br><span>                         int min_size = 1;</span><br><span>                         int max_size = 1);</span></td><td><span>例化端口，创建内存空间</span><br><br><span>参数1：端口名</span><br><span>参数2：父结点名</span><br><span>参数3、4：</span><br><span>必须连接到这个PORT的下级端口数量的最小值和最大值，</span><br><span>也即这一个PORT应该调用的connect函数的最小值和最大值，默认1</span></td></tr><tr><td><font color="blue"><span>主动方</span></font><span> 端口.connect( </span><font color="blue"><span>被动方</span></font><span> 端口 )</span></td><td><span>在env中连接端口，</span><br><font color="blue"><span>高优先级</span></font><span>端口.connect ( 低优先级端口 )</span><br><font color="blue"><span>主动内组件</span></font><span>端口.connect ( 主动外组件端口 )</span><br><font color="blue"><span>被动外组件</span></font><span>端口.connect ( 被动内组件端口 )</span></td></tr><tr><td><font color="blue"><span>&lt;【系统自带】端口.任务/函数&gt;</span></font><br><font color="red"><span>本质是调用，被动方定义的操作任务/函数</span></font><br><span>端口可以是 port、export、imp</span><br></td><td><span>端口.put（tr）</span><br><span>端口.get（tr）</span><br><span>端口.transport（req,  rsp）</span><br><span>端口.can_put( )</span><br><span>端口.try_put( tr )</span><br><span>...</span><br><span>端口.write( tr )</span></td></tr><tr><td><span>tr_queue 队列操作</span></td><td><span>tr = tr_queue.pop_front();         //  tr 队列 操作，删除第一个</span><br><span>tr_queue.push_back(tr);            //  tr 队列 操作，放到最后</span></td></tr></tbody></table></figure><p><span>构造 </span><font color="red"><span>操作任务/函数</span></font><span> 的规律</span></p><p><span> 注意区分</span><font color="red"><span> </span><code>B. port. put()</code><span> </span></font><span>  和</span><font color="red"><span> </span><code>B. put()</code><span>  </span></font><span>的差别，此处是后者！！！！！</span></p><figure><table><thead><tr><th><span>序号</span></th><th><span>A_port   情况</span></th><th><span>B_imp   情况</span></th><th><span>构造     操作任务/函数</span></th></tr></thead><tbody><tr><td><span>1</span></td><td><span>blocking_put</span></td><td><span>blocking_put</span></td><td><span>B. put</span></td></tr><tr><td><span>2</span></td><td><span>nonblocking_put</span></td><td><span>nonblocking_put</span></td><td><span>B. try_put、B. can_put</span></td></tr><tr><td><span>3</span></td><td><span>put</span></td><td><span>put</span></td><td><span>B. put、B. try_put、B. can_put</span></td></tr><tr><td><span>4</span></td><td><span>blocking_get</span></td><td><span>blocking_get</span></td><td><span>B. get</span></td></tr><tr><td><span>5</span></td><td><span>nonblocking_get</span></td><td><span>nonblocking_get</span></td><td><span>B. try_get、B. can_get</span></td></tr><tr><td><span>6</span></td><td><span>get</span></td><td><span>get</span></td><td><span>B. get、B. try_get、B. can_get</span></td></tr><tr><td><span>7</span></td><td><span>blocking_peek</span></td><td><span>blocking_peek</span></td><td><span>B. peek</span></td></tr><tr><td><span>8</span></td><td><span>nonblocking_peek</span></td><td><span>nonblocking_peek</span></td><td><span>B. try_peek、B. can_peek</span></td></tr><tr><td><span>9</span></td><td><span>peek</span></td><td><span>peek</span></td><td><span>B. peek、B. try_peek、B. can_peek</span></td></tr><tr><td><span>10</span></td><td><span>blocking_get_peek</span></td><td><span>blocking_get_peek</span></td><td><span>B. get、B. peek</span></td></tr><tr><td><span>11</span></td><td><span>nonblocking_get_peek</span></td><td><span>nonblocking_get_peek</span></td><td><span>B. try_get、   B. can_get</span><br><span>B. try_peek、B. can_peek</span></td></tr><tr><td><span>12</span></td><td><span>get_peek</span></td><td><span>get_peek</span></td><td><span>B. get、   B. try_get、   B. can_get</span><br><span>B. peek、B. try_peek、B. can_peek</span></td></tr><tr><td><span>13</span></td><td><span>blocking_transport</span></td><td><span>blocking_transport</span></td><td><span>B. transport</span></td></tr><tr><td><span>14</span></td><td><span>nonblocking_transport</span></td><td><span>nonblocking_transport</span></td><td><font color="blue"><span>B. nb_transport</span></font></td></tr><tr><td><span>15</span></td><td><span>transport</span></td><td><span>transport</span></td><td><span>B. transport、B. nb_transport</span></td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td><font color="red"><span>函数/任务说明</span></font></td><td><code>nonblocking</code><span>只能定义为函数</span><br><span>【函数】如下：</span><br><font color="blue"><span>try_xxx、can_xxx、nb_transport</span></font><span>      </span><br><span>其他的都是 【任务/函数】</span></td></tr></tbody></table></figure><p>&nbsp;</p><p><span>② 通信实现过程，以blocking_put为例</span>
<span>		</span><span>step-1：</span><font color="blue"><span>A.A_port.put（transaction）</span></font><span>这个任务会调用 </span><font color="blue"><span>B.B_export.put</span></font>
<span>			</span><span>step-2：B.B_export.put（transaction）又会调用</span><font color="blue"><span>B.B_imp. put（transaction）</span></font>
<span>			</span><span>step-3：而B_imp.put最终又会调用B的相关任务，如 </span><font color="blue"><span>B.put（transaction）</span></font><span>。</span></p><p><span>	</span><strong><font color="red"><span>终点必须是一个IMP。</span></font></strong></p><p>&nbsp;</p><p><span>③ 有以下连接组合</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""优先级：port &gt; export &gt; imp"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 上级 连 下级 </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">port</span> <span class="cm-meta">==</span>&gt; <span class="cm-keyword">export</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">port</span> <span class="cm-meta">==</span>&gt; <span class="cm-variable">imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">export</span> <span class="cm-meta">==</span>&gt; <span class="cm-variable">imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 内部连接</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">port</span> <span class="cm-meta">==</span>&gt; <span class="cm-variable">port</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">export</span> <span class="cm-meta">==</span>&gt; <span class="cm-keyword">export</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 外部连接在 env的connect_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 内部连接在 组件自己的connect_phase</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 246px;"></div><div class="CodeMirror-gutters" style="display: none; height: 246px;"></div></div></div></pre></li></ul><p><img src="./UVM_files/SV&amp;UVM基础_UVMTLM机制4种模式.jpg" referrerpolicy="no-referrer"></p><p><font color="blue"><strong><span>以下以 blocking_put 为例</span></strong><span>：</span></font></p><h5><a name="◻-port--export" class="md-header-anchor"></a><span>◻ port ==&gt; export</span></h5><p><font color="red"><span>终点必须是 imp</span></font><span>， 所以本质是  port ==&gt; export ==&gt; imp</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""A的port ==&gt; B的export"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 本质是 port ==&gt; export ==&gt; imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">A</span>组件代码》主动<span class="cm-variable">port</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">A</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">A</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_blocking_put_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span> <span class="cm-variable">A_port</span>; &nbsp; <span class="cm-comment">//@@ 声明一个port</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_port</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"A_port"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ 例化port创建内存空间</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 第一个参数：名字，</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 第二个参数：一个uvm_component类型的父结点变量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">repeat</span><span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">#10</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tr</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"tr"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_port</span>.<span class="cm-variable">put</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 【系统自带：port.put(tr)】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">B</span>组件代码》被动<span class="cm-keyword">export</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">B</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">B</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_blocking_put_export</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">B_export</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 声明一个export</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_blocking_put_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span>, <span class="cm-variable">B</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	">   </span> <span class="cm-variable">B_imp</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 声明一个imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">B_export</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"B_export"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化new创建内存空间</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">B_imp</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"B_imp"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化new创建内存空间</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">B_export</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">B_imp</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ 在内部直接将 export 连接 imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 构造 操作任务/函数（B.put）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">put</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"B"</span>, <span class="cm-string">"receive a transaction"</span>, <span class="cm-variable">UVM_LOW</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tr</span>.<span class="cm-variable">print</span><span class="cm-bracket">()</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@  B.put任务 内涵</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">env</span>代码》 在<span class="cm-variable">env</span>中连接</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_env</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_env</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">A</span> <span class="cm-variable">A_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">B</span> <span class="cm-variable">B_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">A</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"A_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">B_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">B</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"B_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_inst</span>.<span class="cm-variable">A_port</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">B_inst</span>.<span class="cm-variable">B_export</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 在env中 连接2组件的端口，主动 ==&gt; 被动</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1546px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1546px;"></div></div></div></pre><p>&nbsp;</p><h5><a name="◻-port--imp" class="md-header-anchor"></a><span>◻ port ==&gt; imp</span></h5><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""A的port ==&gt; B的imp"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">A</span>组件代码》主动<span class="cm-variable">port</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 略，同 port==&gt;export 《A代码》</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">B</span>组件代码》被动<span class="cm-variable">imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">B</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">B</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_blocking_put_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span>, <span class="cm-variable">B</span><span class="cm-bracket">)</span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">B_imp</span>; &nbsp;<span class="cm-comment">//@@ 声明一个imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">B_imp</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"B_imp"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化new创建内存空间</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 构造操作任务/函数 B.put</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">put</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"B"</span>, <span class="cm-string">"receive a transaction"</span>, <span class="cm-variable">UVM_LOW</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tr</span>.<span class="cm-variable">print</span><span class="cm-bracket">()</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">env</span>代码》 在<span class="cm-variable">env</span>中连接</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ &nbsp; 其他代码完全相同，只有connect_phase改一下</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_env</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_env</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">A</span> <span class="cm-variable">A_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">B</span> <span class="cm-variable">B_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">A</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"A_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">B_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">B</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"B_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_inst</span>.<span class="cm-variable">A_port</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">B_inst</span>.<span class="cm-variable">B_imp</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 在env中 连接2组件的端口，主动 ==&gt; 被动</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 896px;"></div><div class="CodeMirror-gutters" style="display: none; height: 896px;"></div></div></div></pre><p>&nbsp;</p><h5><a name="◻-export--imp" class="md-header-anchor"></a><span>◻ export ==&gt; imp</span></h5><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""A的export ==&gt; B的imp"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">A</span>组件代码》主动<span class="cm-keyword">export</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">A</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">A</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_blocking_put_export</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-variable">A_export</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 声明export</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_export</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"A_export"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ 例化export创建内存空间</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 第一个参数：名字，</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 第二个参数：一个uvm_component类型的父结点变量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_transaction</span><span class="cm-tab" role="presentation" cm-text="	">  </span> <span class="cm-variable">tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">repeat</span><span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">#10</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tr</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"tr"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_export</span>.<span class="cm-variable">put</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 【系统自带：export.put(tr)】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">B</span>组件代码》被动<span class="cm-variable">imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 略，同 port==&gt;imp 《B代码》</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">env</span>代码》 在<span class="cm-variable">env</span>中连接</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ &nbsp; 其他代码完全相同，只有connect_phase改一下</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_env</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_env</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">A</span> <span class="cm-variable">A_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">B</span> <span class="cm-variable">B_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">A</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"A_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">B_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">B</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"B_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_inst</span>.<span class="cm-variable">A_export</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">B_inst</span>.<span class="cm-variable">B_imp</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 在env中 连接2组件的端口，主动export ==&gt; 被动imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1030px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1030px;"></div></div></div></pre><p>&nbsp;</p><h5><a name="◻-port--port" class="md-header-anchor"></a><span>◻ port ==&gt; port</span></h5><p><span>内部连接 C_port ==&gt; A_port</span>
<font color="red"><span>终点必须是 imp</span></font><span>， 所以本质是  port ==&gt; port ==&gt; imp</span></p><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-TLM机制-内部连接port-port连接.jpg" referrerpolicy="no-referrer"></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""A的内部组件C port ==&gt; A组件的"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《内部组件<span class="cm-variable">C</span>的代码》主动<span class="cm-variable">port</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">C</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">C</span><span class="cm-bracket">)</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_blocking_put_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-variable">C_port</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 声明一个port</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ new例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">C_port</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"C_port"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 例化port创建内存空间 &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 第一个参数：名字，</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 第二个参数：一个uvm_component类型的父结点变量 【存在疑问】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 发送激励</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">repeat</span><span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">#10</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tr</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"tr"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">C_port</span>.<span class="cm-variable">put</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 【系统自带：port.put(tr)】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《外部组件<span class="cm-variable">A</span>的代码》被动<span class="cm-variable">port</span><span class="cm-meta">+</span>主动<span class="cm-variable">port</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">A</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">A</span><span class="cm-bracket">)</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">C</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">C_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_blocking_put_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-variable">A_port</span>; &nbsp; <span class="cm-comment">//@@ 声明一个port</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_port</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"A_port"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ A_port的例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">C_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">C</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"C_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ C组件的例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 连接</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">C_inst</span>.<span class="cm-variable">C_port</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>.<span class="cm-variable">A_port</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ 在env中 连接2组件的端口，主动 port ==&gt; 被动port</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ this 指的就是 A组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 发送激励</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">repeat</span><span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">#10</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tr</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"tr"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_port</span>.<span class="cm-variable">put</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ &nbsp; 【系统自带：port.put(tr)】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">B</span>组件代码》被动<span class="cm-variable">imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 略，同 port==&gt;imp 《B代码》</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">env</span>代码》 在<span class="cm-variable">env</span>中连接</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 略，同 port==&gt;imp 《env代码》</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1501px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1501px;"></div></div></div></pre><p>&nbsp;</p><h5><a name="◻-export--export" class="md-header-anchor"></a><span>◻ export ==&gt; export</span></h5><p><span>内部连接 C_export ==&gt; B_export</span>
<font color="red"><span>终点必须是 imp</span></font><span>， 所以本质是  export ==&gt; export ==&gt; imp</span></p><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-TLM机制-内部连接export-export连接.jpg" referrerpolicy="no-referrer"></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""C_export ==&gt; C的内部组件B的export"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">A</span>代码》主动<span class="cm-variable">port</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 略，同 port==&gt;export 《A代码》</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《外组件<span class="cm-variable">C</span>代码》被动<span class="cm-keyword">export</span><span class="cm-meta">+</span>主动<span class="cm-keyword">export</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">C</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">C</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">B</span> <span class="cm-variable">B_inst</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_blocking_put_export</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-variable">C_export</span>; &nbsp;<span class="cm-comment">//@@ 声明export</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">C_export</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"C_export"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 例化C的export</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">B_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">B</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"B_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化B组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 连接</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">C_export</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">B_inst</span>.<span class="cm-variable">B_export</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ C_export 连接 B_export</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 发送激励</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_transaction</span><span class="cm-tab" role="presentation" cm-text="	">  </span> <span class="cm-variable">tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">repeat</span><span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">#10</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tr</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"tr"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">C_export</span>.<span class="cm-variable">put</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 【系统自带：export.put(tr)】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《内部组件<span class="cm-variable">B</span>的代码》被动<span class="cm-keyword">export</span><span class="cm-meta">+</span>主动<span class="cm-keyword">export</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 略，同 port==&gt;export 《B代码》</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">env</span>代码》 在<span class="cm-variable">env</span>中连接</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_env</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_env</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">A</span> <span class="cm-variable">A_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">C</span> <span class="cm-variable">C_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">A</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"A_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化组件A</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">C_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">C</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"C_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_inst</span>.<span class="cm-variable">A_port</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">C_inst</span>.<span class="cm-variable">C_export</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 在env中 连接2组件的端口，主动port ==&gt; 被动export</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1277px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1277px;"></div></div></div></pre><p>&nbsp;</p><p><font color="blue"><strong><span>以上都是以 blocking_put 为例</span></strong><span>：</span></font></p><ul><li><span>4.2.7 blocking_</span><strong><span>get</span></strong><span> 端口互联</span></li></ul><h5><a name="◻-blockingget" class="md-header-anchor"></a><span>◻ blocking_get</span></h5><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-TLM机制- blocking_get-port-export-imp.jpg" referrerpolicy="no-referrer"></p><p><font color="red"><span>终点必须是 imp</span></font><span>， 所以示例的本质是  port ==&gt;export ==&gt; imp</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""blocking_get 举例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""控制流：port ==&gt; export ==&gt; imp"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""数据流：A ==&gt; B"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">A</span>代码》被动方 </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">A</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">A</span><span class="cm-bracket">)</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_blocking_get_export</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">A_export</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ 声明export</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_blocking_get_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span>, <span class="cm-variable">A</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	">   </span> <span class="cm-variable">A_imp</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 声明imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-variable">tr_q</span><span class="cm-bracket">[</span>$<span class="cm-bracket">]</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_export</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"A_export"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化 export</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_imp</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"A_imp"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化 imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 连接</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_export</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">A_imp</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 内部连接 &nbsp;  主动==&gt;被动</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 发送激励/数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">repeat</span><span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">#10</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tr</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"tr"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tr_q</span>.<span class="cm-variable">push_back</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@  【系统自带：tr_queue.push_back(tr)】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 【被动方】构造 操作任务/函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-keyword">output</span> <span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-variable">tr_q</span>.<span class="cm-variable">size</span><span class="cm-bracket">()</span> <span class="cm-meta">==</span> <span class="cm-number">0</span><span class="cm-bracket">)</span> <span class="cm-def">#2</span>; &nbsp; &nbsp; <span class="cm-comment">//每隔2个时间单位检查tr_q中是否有数据, &nbsp; 无限循环，有才跳出</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tr</span> <span class="cm-meta">=</span> <span class="cm-variable">tr_q</span>.<span class="cm-variable">pop_front</span><span class="cm-bracket">()</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@  【系统自带：tr_queue.pop_front()】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">B</span>代码》主动方</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">B</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">B</span><span class="cm-bracket">)</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_blocking_get_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span><span class="cm-tab" role="presentation" cm-text="	">  </span> <span class="cm-variable">B_port</span>; &nbsp; <span class="cm-comment">//@@ 声明port</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">B_port</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"B_port"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 获得激励/数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">B_port</span>.<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp;<span class="cm-comment">//@@  【系统自带：端口.get(tr)】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"B"</span>, <span class="cm-string">"get a transaction"</span>, <span class="cm-variable">UVM_LOW</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tr</span>.<span class="cm-variable">print</span><span class="cm-bracket">()</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">env</span>代码》 在<span class="cm-variable">env</span>中连接</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_env</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_env</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">A</span> <span class="cm-variable">A_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">B</span> <span class="cm-variable">B_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">A</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"A_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化组件A</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">B_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">B</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"B_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">B_inst</span>.<span class="cm-variable">B_port</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">A_inst</span>.<span class="cm-variable">A_export</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 在env中 连接2组件的端口，主动port ==&gt; 被动export</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1792px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1792px;"></div></div></div></pre><p>&nbsp;</p><ul><li><span>4.2.8 blocking_</span><strong><span>transport</span></strong><span> 端口互联</span></li></ul><h5><a name="◻-blockingtransport" class="md-header-anchor"></a><span>◻ blocking_transport</span></h5><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-TLM机制- blocking_transport_transport-imp.jpg" referrerpolicy="no-referrer">
<font color="red"><span>终点必须是 imp</span></font><span>， 所以示例的本质是 transport ==&gt; imp</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""transport 举例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""控制流：transport ==&gt; imp"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""数据流：A &lt;==&gt; B"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">A</span>代码》主动方 </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">A</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">A</span><span class="cm-bracket">)</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_blocking_transport_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span>, <span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">A_transport</span>; &nbsp;<span class="cm-comment">//@@ 声明transport</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_transport</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"A_transport"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 发送激励</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">rsp</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">repeat</span><span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">#10</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tr</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"tr"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_transport</span>.<span class="cm-variable">transport</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span>, <span class="cm-variable">rsp</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 【系统自带】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"A"</span>, <span class="cm-string">"received rsp"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">rsp</span>.<span class="cm-variable">print</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">B</span>代码》被动方</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">B</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">B</span><span class="cm-bracket">)</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_blocking_transport_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span>, <span class="cm-variable">my_transaction</span>, <span class="cm-variable">B</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">B_imp</span>; <span class="cm-comment">//@@ 声明一个imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">B_imp</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"B_imp"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 构造  操作任务 /函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">transport</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span> <span class="cm-variable">req</span>, <span class="cm-keyword">output</span> <span class="cm-variable">my_transaction</span> <span class="cm-variable">rsp</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"B"</span>, <span class="cm-string">"receive a transaction"</span>, <span class="cm-variable">UVM_LOW</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">req</span>.<span class="cm-variable">print</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//do something according to req </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">#5</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">rsp</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"rsp"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">env</span>代码》 在<span class="cm-variable">env</span>中连接</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_env</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_env</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">A</span> <span class="cm-variable">A_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">B</span> <span class="cm-variable">B_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 例化组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">A</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"A_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">B_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">B</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"B_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 连接</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_inst</span>.<span class="cm-variable">A_transport</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">B_inst</span>.<span class="cm-variable">B_imp</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 在env中 连接2组件的端口，主动 ==&gt; 被动</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1590px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1590px;"></div></div></div></pre><p>&nbsp;</p><ul><li><span>4.2.9  </span><strong><span>nonblocking</span></strong><span> 端口互联</span></li></ul><h5><a name="◻-nonblockingput" class="md-header-anchor"></a><span>◻ nonblocking_put</span></h5><p><span>① 是非阻塞的，换言之，</span><font color="red"><span>必须</span></font><span> 用 </span><strong><font color="blue"><span>函数</span></font></strong><span> 实现，而不能用任务实现</span></p><p><span>② 由于端口变为了非阻塞的，所以在送出</span><code>tr</code><span>之前需要调用</span><font color="blue"><code>端口.can_put函数</code></font><span>来确认是否能够执行</span><code>put</code><span>操作。</span><code>can_put</code><span>最终会调用</span><font color="blue"><code>B. can_put</code></font><span>：</span></p><p><font color="red"><span>终点必须是 imp</span></font><span>， 所以示例的本质是 port ==&gt; export ==&gt; imp</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""A的port ==nonblocking==&gt; B的export"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 本质是 port ==&gt; export ==&gt; imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">A</span>组件代码》主动<span class="cm-variable">port</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">A</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">A</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_nonblocking_put_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span><span class="cm-tab" role="presentation" cm-text="	">   </span> <span class="cm-variable">A_port</span>; &nbsp; <span class="cm-comment">//@@ 声明一个nonblocking port</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_port</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"A_port"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ 例化port创建内存空间</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 第一个参数：名字，</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 第二个参数：一个uvm_component类型的父结点变量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 发送激励</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-variable">tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">repeat</span><span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">tr</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"tr"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-meta">!</span><span class="cm-variable">A_port</span>.<span class="cm-variable">can_put</span><span class="cm-bracket">())</span> <span class="cm-def">#10</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 【系统自带】端口.can_put函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">void</span>'<span class="cm-bracket">(</span><span class="cm-variable">A_port</span>.<span class="cm-variable">try_put</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span><span class="cm-bracket">))</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 【系统自带】端口.try_put函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">B</span>组件代码》被动<span class="cm-variable">imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">B</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">B</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_nonblocking_put_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span>, <span class="cm-variable">B</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">B_imp</span>; &nbsp;<span class="cm-comment">//@@ 声明一个nonblocking imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">tr_q</span><span class="cm-bracket">[</span>$<span class="cm-bracket">]</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 例化端口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">B_imp</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"B_imp"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化new创建内存空间</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 构造  操作函数<span class="cm-tab" role="presentation" cm-text="	">   </span>B.can_put</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">bit</span> <span class="cm-variable">can_put</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">tr_q</span>.<span class="cm-variable">size</span><span class="cm-bracket">()</span> &gt; <span class="cm-number">0</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 构造  操作函数 B.try_put</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">bit</span> <span class="cm-variable">try_put</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"B"</span>, <span class="cm-string">"receive a transaction"</span>, <span class="cm-variable">UVM_LOW</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">tr_q</span>.<span class="cm-variable">size</span><span class="cm-bracket">()</span> &gt; <span class="cm-number">0</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tr_q</span>.<span class="cm-variable">push_back</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 放队列后面</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 发送激励</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_transaction</span><span class="cm-tab" role="presentation" cm-text="	">  </span> <span class="cm-variable">tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">tr_q</span>.<span class="cm-variable">size</span><span class="cm-bracket">()</span> &gt; <span class="cm-number">0</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tr</span> <span class="cm-meta">=</span> <span class="cm-variable">tr_q</span>.<span class="cm-variable">pop_front</span><span class="cm-bracket">()</span>; &nbsp; <span class="cm-comment">//@@ 队列前面的拿出去</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">#25</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">env</span>代码》 在<span class="cm-variable">env</span>中连接</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_env</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_env</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">A</span> <span class="cm-variable">A_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">B</span> <span class="cm-variable">B_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">A</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"A_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">B_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">B</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"B_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_inst</span>.<span class="cm-variable">A_port</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">B_inst</span>.<span class="cm-variable">B_imp</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 在env中 连接2组件的端口，主动 ==&gt; 被动</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1994px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1994px;"></div></div></div></pre><p>&nbsp;</p><h4><a name="43--一对多广播" class="md-header-anchor"></a><span>4.3  一对多广播</span></h4><ul><li><span>4.3.1~4.3.2  analysis port</span></li></ul><h5><a name="◻-analysis-port" class="md-header-anchor"></a><span>◻ analysis port</span></h5><p><span>特点：①  </span><font color="blue"><span>一对多</span></font><span>（广播），一个</span><code>ap</code><span>可以和多个</span><code>IMP</code><span>相连</span>
<span>		</span><span>    ②  </span><font color="blue"><span>无  阻塞/非阻塞 之分  </span></font>
<span>		</span><span>    ③  终点也必须是imp</span>
<span>			</span><span>④  只有一种</span><font color="blue"><span>操作函数</span></font><span>：</span><code>write()</code><span>,  也是在 </span><font color="blue"><span>被动方</span></font><span>（a_imp）中需要构造 </span></p><p><img src="./UVM_files/SV&amp;UVM基础_UVM-TLM通信analysis mode.jpg" referrerpolicy="no-referrer"></p><p>&nbsp;</p><p><font color="red"><span>终点必须是 imp</span></font><span>， 所以示例的本质是 a_port  ==&gt; a_imp</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""analysis_port ==&gt; analysis_imp"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""广播,被动方write()"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 主动方《<span class="cm-variable">A</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">A</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">A</span><span class="cm-bracket">)</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_analysis_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span> &nbsp; &nbsp;<span class="cm-variable">A_ap</span>; &nbsp; <span class="cm-comment">//@@ 声明一个ap</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 例化端口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_ap</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"A_ap"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ 例化port创建内存空间</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 第一个参数：名字，</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 第二个参数：一个uvm_component类型的父结点变量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 发送激励</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_transaction</span><span class="cm-tab" role="presentation" cm-text="	">  </span> <span class="cm-variable">tr</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">repeat</span><span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">#10</span>; &nbsp; <span class="cm-comment">//每隔10个时间单位写入一个tr</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tr</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"tr"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_ap</span>.<span class="cm-variable">write</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 【系统自带】端口.write()</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 被动方《<span class="cm-variable">B</span><span class="cm-meta">/</span><span class="cm-variable">C</span> 代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">B</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">B</span><span class="cm-bracket">)</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_analysis_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span>, <span class="cm-variable">B</span><span class="cm-bracket">)</span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">B_aimp</span>; &nbsp; <span class="cm-comment">//@@ 声明一个 imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 例化端口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">B_aimp</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"B_aimp"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ 例化port创建内存空间</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 第一个参数：名字，</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 第二个参数：一个uvm_component类型的父结点变量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 构造 操作函数 write</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">write</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"B"</span>, <span class="cm-string">"receive a transaction"</span>, <span class="cm-variable">UVM_LOW</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tr</span>.<span class="cm-variable">print</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">env</span>代码》 在<span class="cm-variable">env</span>中连接</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_env</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_env</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">A</span> <span class="cm-variable">A_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">B</span> <span class="cm-variable">B_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">C</span> <span class="cm-variable">C_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 例化组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">A</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"A_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">B_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">B</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"B_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">C_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">C</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"C_inst"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 连接</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_inst</span>.<span class="cm-variable">A_ap</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">B_inst</span>.<span class="cm-variable">B_aimp</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 在env中 连接2组件的端口，主动 ==&gt; 被动</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_inst</span>.<span class="cm-variable">A_ap</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">C_inst</span>.<span class="cm-variable">C_aimp</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 在env中 连接2组件的端口，主动 ==&gt; 被动</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1546px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1546px;"></div></div></div></pre><p>&nbsp;</p><h5><a name="◻a-namectrl跳转12-ap-内部连接a" class="md-header-anchor"></a><span>◻</span><a name="Ctrl跳转12"><span> ap 内部连接</span></a></h5><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-TLM机制-analysis端口的内部连接.jpg" referrerpolicy="no-referrer"></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""analysis_port 方式三：monitor 连接 scoreboard 为例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 本质是 外部的ap要不要声明例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">monitor</span>代码》主动方</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">monitor</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_monitor</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_analysis_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-variable">ap</span>; &nbsp; <span class="cm-comment">//@@ 声明ap</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@例化端口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">mon_ap</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"mon_ap"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ 例化ap创建内存空间</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 第一个参数：名字，</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 第二个参数：一个uvm_component类型的父结点变量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 发送激励</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ap</span>.<span class="cm-variable">write</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 【系统自带】取决于被动者 去定义这个函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">agent</span>代码》被动方<span class="cm-meta">+</span>主动方 【三种方式主要差别点在<span class="cm-variable">agt</span>】</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_agent</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_agent</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_analysis_port</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span><span class="cm-tab" role="presentation" cm-text="	"> </span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-variable">ap</span>; &nbsp;<span class="cm-comment">//@@ 声明一个agt_ap</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@  不例化端口！！！！</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ap</span> <span class="cm-meta">=</span> <span class="cm-variable">mon</span>.<span class="cm-variable">ap</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 方式三：  agt的connect_phase中，进行 &nbsp; 句柄赋值，指针指向 mon_ap</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">scoreboard</span>代码》被动方</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">scoreboard</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_scoreboard</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_analysis_imp</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span>, <span class="cm-variable">scoreboard</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">scb_imp</span>; &nbsp; <span class="cm-comment">//@@ 声明aimp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 例化端口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">scb_aimp</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"scb_aimp"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ 例化aimp创建内存空间</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 第一个参数：名字，</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 第二个参数：一个uvm_component类型的父结点变量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 构造  操作函数write</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">write</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span><span class="cm-bracket">)</span>;<span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//do something on tr endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">env</span>代码》连接</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_env</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_env</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">scoreboard</span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">scb</span>; <span class="cm-tab" role="presentation" cm-text="	">   </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">monitor</span><span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">mon</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">my_agent</span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">o_agt</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 例化组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">scb</span> <span class="cm-meta">=</span> <span class="cm-variable">scoreboard</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"scb"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">mon</span> <span class="cm-meta">=</span> <span class="cm-variable">monitor</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"mon"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">o_agt</span> <span class="cm-meta">=</span> <span class="cm-variable">my_agent</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"o_agt"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 连接外部端口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">o_agt</span>.<span class="cm-variable">ap</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">scb</span>.<span class="cm-variable">scb_imp</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 在env中 连接2组件的端口，主动 ==&gt; 被动</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1770px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1770px;"></div></div></div></pre><p>&nbsp;</p><h5><a name="◻-a-namectrl跳转14-aimp视角多对一a" class="md-header-anchor"></a><span>◻ </span><a name="Ctrl跳转14"><span> a_imp视角(多对一)</span></a></h5><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-TLM机制-analysis_imp多个write.jpg" referrerpolicy="no-referrer"></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>`</span><span>uvm_analysis_imp_decl(_monitor)</span></td><td><font color="blue"><span>【class之外，全局定义】</span></font><br><span>宏注册了一个 _monitor 后缀的类：</span><br><span>uvm_analysis_imp_monitor        用于 声明 imp</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""imp后缀多个write函数，多对一 代码示例""""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">`uvm_analysis_imp_decl</span><span class="cm-bracket">(</span><span class="cm-variable">_monitor</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">`uvm_analysis_imp_decl</span><span class="cm-bracket">(</span><span class="cm-variable">_model</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_scoreboard</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_scoreboard</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">my_transaction</span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">expect_queue</span><span class="cm-bracket">[</span>$<span class="cm-bracket">]</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_analysis_imp_monitor</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span>, <span class="cm-variable">my_scoreboard</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-variable">monitor_imp</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_analysis_imp_model</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span>, <span class="cm-variable">my_scoreboard</span><span class="cm-bracket">)</span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">model_imp</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 构造 操作函数write_model</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">write_model</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">expect_queue</span>.<span class="cm-variable">push_back</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 构造 操作函数write_monitor</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">write_monitor</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">tmp_tran</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">bit</span> <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">result</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">expect_queue</span>.<span class="cm-variable">size</span><span class="cm-bracket">()</span> &gt; <span class="cm-number">0</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 605px;"></div><div class="CodeMirror-gutters" style="display: none; height: 605px;"></div></div></div></pre><p>&nbsp;</p><ul><li><span>4.3.3~4.3.5  analysis fifo</span></li></ul><h5><a name="◻-analysis-fifo" class="md-header-anchor"></a><span>◻ analysis FIFO</span></h5><p><span>① </span><code>FIFO</code><span> 的本质是一块缓存加2个</span><code>IMP</code>
<span>② 控制流 是从</span><code>scoreboard</code><span>到 </span><code>FIFO</code><span>，而数据流 是从 </span><code>FIFO</code><span> 到 </span><code>scoreboard</code><span>。</span>
<span>③ </span><font color="blue"><code>analysis_export</code></font><span> 和</span><font color="blue"><span> </span><code>blocking_get_export</code><span> </span></font><span>虽然名字中有关键字 </span><code>export</code><span>，但是其类型却是 </span><font color="blue"><code>IMP</code></font>
<span>④ </span><code>agent</code><span> 、</span><code>monitor</code><span> 依然是 </span><font color="blue"><code>analysis_port</code></font><span>，</span><code>scoreboard</code><span>变为  </span><strong><font color="blue"><code>blocking_get_port</code></font></strong><span>,</span><br><span>⑤ </span><code>FIFO</code><span> 优势：</span>
<span>          a.    </span><code>scb</code><span> 可以有主动权，</span><code>scb</code><span>中不用再写</span><code>write函数</code>
<span>		</span><span>  b.    </span><code>FIFO</code><span>的另一大优势是：大量端口（例如：端口数组）时，可以使用</span><font color="blue"><span> </span><code>for</code><span>循环</span></font><span> ，减少代码量/犯错   </span><a href="file:///E:/Disc/%E3%80%901%E3%80%91~~%E5%B8%B8%E7%94%A8~~/%E3%80%90D-%E5%99%A8%E3%80%91%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E3%80%81%E5%B7%A5%E5%85%B7/10%20Verilog+SV+UVM+EDA+Makefile/UVM.html#Ctrl%E8%B7%B3%E8%BD%AC13"><span>参见【FIFO for循环】 </span></a></p><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-TLM机制-analysis端口的内部连接-外部FIFO.jpg" referrerpolicy="no-referrer"></p><p><img src="./UVM_files/SV&amp;UVM基础_UVMTLM机制fifo_4_monitor、scb、reference model.jpg" referrerpolicy="no-referrer" alt="图片"></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>uvm_tlm_analysis_fifo #(my_transaction) </span><span>	</span><span>agt_scb_fifo;</span></td><td><span>声明一个agt==&gt;fifo==&gt;scb的 FIFO</span></td></tr><tr><td><span>uvm_tlm_fifo #(my_transaction)                 </span><span>	</span><span>agt_scb_fifo;</span></td><td><span>声明... FIFO，FIFO内部少一个analysis_export</span></td></tr></tbody></table></figure><p><a href="file:///E:/Disc/%E3%80%901%E3%80%91~~%E5%B8%B8%E7%94%A8~~/%E3%80%90D-%E5%99%A8%E3%80%91%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E3%80%81%E5%B7%A5%E5%85%B7/10%20Verilog+SV+UVM+EDA+Makefile/UVM.html#Ctrl%E8%B7%B3%E8%BD%AC12"><span>左侧[方式三]参见【ap 内部连接】 </span></a></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""左侧[方式三]、右侧fifo+blocking_get_port实现 monitor和scb通信"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">monitor</span>代码》主动方</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 略，同【ap 内部连接】方式三 示例代码</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">agent</span>代码》被动方<span class="cm-meta">+</span>主动方 【方式三】</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 略，同【ap 内部连接】方式三 示例代码</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">scoreboard</span>代码》被动方</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_scoreboard</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_scoreboard</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">my_transaction</span><span class="cm-tab" role="presentation" cm-text="	">  </span> <span class="cm-variable">expect_queue</span><span class="cm-bracket">[</span>$<span class="cm-bracket">]</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_blocking_get_port</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">exp_port</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 声明port，期望输出（从输入侧输入） </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_blocking_get_port</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">act_port</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 声明port，实际输出（从DUT输出侧输入） </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 例化端口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">exp_port</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"exp_port"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ 例化aimp创建内存空间</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">act_port</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"act_port"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;<span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-comment">//@@ 第一个参数：名字，</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 第二个参数：一个uvm_component类型的父结点变量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 发送激励：不断的去要数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">fork</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">while</span> <span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">exp_port</span>.<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-variable">get_expect</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ [系统自带]端口.get</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">expect_queue</span>.<span class="cm-variable">push_back</span><span class="cm-bracket">(</span><span class="cm-variable">get_expect</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">while</span> <span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">act_port</span>.<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-variable">get_actual</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ [系统自带]端口.get</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">join</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">env</span>代码》连接</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_env</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_env</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_agent</span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">i_agt</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_agent</span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">o_agt</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_model</span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">mdl</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_scoreboard</span><span class="cm-tab" role="presentation" cm-text="	">   </span> <span class="cm-variable">scb</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_tlm_analysis_fifo</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">agt_scb_fifo</span>; &nbsp; <span class="cm-comment">//@@ 声明一个o_agt==&gt;scb 的fifo</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_tlm_analysis_fifo</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">agt_mdl_fifo</span>; &nbsp; <span class="cm-comment">//@@ 声明一个i_agt==&gt;mdl 的fifo</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_tlm_analysis_fifo</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">mdl_scb_fifo</span>; &nbsp; <span class="cm-comment">//@@ 声明一个mdl==&gt;scb 的fifo</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 例化组件 &amp; 端口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">o_agt</span> <span class="cm-meta">=</span> <span class="cm-variable">my_agent</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"o_agt"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">i_agt</span> <span class="cm-meta">=</span> <span class="cm-variable">my_agent</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"i_agt"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">mdl</span> <span class="cm-meta">=</span> <span class="cm-variable">my_model</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"mdl"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">scb</span> <span class="cm-meta">=</span> <span class="cm-variable">my_scoreboard</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"scb"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@@ 连接端口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">i_agt</span>.<span class="cm-variable">ap</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">agt_mdl_fifo</span>.<span class="cm-variable">analysis_export</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 本质 analysis_export 是一个imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">mdl</span>.<span class="cm-variable">port</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">agt_mdl_fifo</span>.<span class="cm-variable">blocking_get_export</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ 本质 blocking_get_export 是一个imp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">mdl</span>.<span class="cm-variable">ap</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">mdl_scb_fifo</span>.<span class="cm-variable">analysis_export</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">scb</span>.<span class="cm-variable">exp_port</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">mdl_scb_fifo</span>.<span class="cm-variable">blocking_get_export</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">o_agt</span>.<span class="cm-variable">ap</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">agt_scb_fifo</span>.<span class="cm-variable">analysis_export</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">scb</span>.<span class="cm-variable">act_port</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">agt_scb_fifo</span>.<span class="cm-variable">blocking_get_export</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1658px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1658px;"></div></div></div></pre><p>&nbsp;</p><h5><a name="◻-fifo-端口和函数" class="md-header-anchor"></a><span>◻ FIFO 端口和函数</span></h5><p><span>① </span><code>uvm_tlm_analysis_fifo</code><span>  具备下图所有 端口</span>
<span>     </span><code>uvm_tlm_fifo</code><span>     少一个 </span><code>analysis_export</code><span> 端口</span>
<span>②  </span><code>get</code><span>任务被调用时，</span><code>FIFO</code><span>内部缓存中会少一个</span><code>transaction</code>
<span>      </span><code>peek</code><span>被调用时，</span><code>FIFO</code><span>会把</span><code>tr</code><span>复制一份发送出去，其内部缓存中的</span><code>tr</code><span>数量并不会减少</span>
<span>③  </span><code>FIFO</code><span>内部被定义的</span><code>put任务</code><span>被调用，这个</span><code>put任务</code><span>把传递过来的</span><code>tr</code><span>放在</span><code>FIFO</code><span>内部的缓存里，同时，把这个</span><code>tr</code><span>通过</span><code>put_ap</code><span>使用</span><code>write函数</code><span>发送出去</span>
<span>④   内部缓存，通过 </span><code>mailbox</code><span> 实现</span></p><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-TLM机制-analysis FIFO端口.jpg" referrerpolicy="no-referrer"></p><figure><table><thead><tr><th><span>fifo 函数</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>fifo. used（）</span></td><td><span>查询 </span><code>FIFO</code><span>缓存中有多少 </span><code>tr</code></td></tr><tr><td><span>fifo. is_empty（）</span></td><td><span>判断当前 </span><code>FIFO</code><span> 缓存是否为空</span></td></tr><tr><td><span>fifo. is_full（）</span></td><td><span>判断当前 </span><code>FIFO</code><span> 缓存是否为满</span></td></tr><tr><td><span>fifo. flush（）</span></td><td><span>清空 </span><code>FIFO</code><span> 缓存中的所有数据，常用于复位</span></td></tr><tr><td><span>fifo = new（</span><string name=""><span>, &lt;uvm_component parent = null&gt;, </span><int size="1"><span>）</span></int></string></td><td><span>例化fifo</span><br><span>参数三 size=0表示无穷大</span></td></tr></tbody></table></figure><p>&nbsp;</p><h5><a name="◻-a-namectrl跳转13fifo-for循环a-----------------font-colorgree-感觉后缀法-其实也可以-font" class="md-header-anchor"></a><span>◻ </span><a name="Ctrl跳转13"><span>FIFO for循环</span></a><span>                 </span><font color="gree"><span>&lt; 感觉后缀法 其实也可以 &gt;</span></font></h5><p><span>——应对大量的端口连接（例如 数组端口），相较于后缀法（`uvm_analysis_imp_decl(_monitor)，</span><a href="file:///E:/Disc/%E3%80%901%E3%80%91~~%E5%B8%B8%E7%94%A8~~/%E3%80%90D-%E5%99%A8%E3%80%91%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E3%80%81%E5%B7%A5%E5%85%B7/10%20Verilog+SV+UVM+EDA+Makefile/UVM.html#Ctrl%E8%B7%B3%E8%BD%AC14"><span>参见 【a_imp视角(多对一)】 </span></a><span>），可以使用for循环  </span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""FIFO优势：可使用for循环,声明、例化创建、连接端口"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">model</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_model</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_blocking_get_port</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span><span class="cm-tab" role="presentation" cm-text="	"> </span> <span class="cm-variable">port</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_analysis_port</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span><span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">ap</span><span class="cm-bracket">[</span><span class="cm-number">16</span><span class="cm-bracket">]</span>; &nbsp; &nbsp; <span class="cm-comment">//【？？？？？】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">port</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"port"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span> <span class="cm-variable">i</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> &lt; <span class="cm-number">16</span>; <span class="cm-variable">i</span><span class="cm-meta">++</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ap</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">]</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-meta">$sformatf</span><span class="cm-bracket">(</span><span class="cm-string">"ap_%0d"</span>, <span class="cm-variable">i</span><span class="cm-bracket">)</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//【？？？？？】 &nbsp; </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">scoreboard</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_scoreboard</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_scoreboard</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-variable">expect_queue</span><span class="cm-bracket">[</span>$<span class="cm-bracket">]</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_blocking_get_port</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">exp_port</span><span class="cm-bracket">[</span><span class="cm-number">16</span><span class="cm-bracket">]</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_blocking_get_port</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">act_port</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 例化端口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span> <span class="cm-variable">i</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> &lt; <span class="cm-number">16</span>; <span class="cm-variable">i</span><span class="cm-meta">++</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">exp_port</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">]</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-meta">$sformatf</span><span class="cm-bracket">(</span><span class="cm-string">"exp_port_%0d"</span>, <span class="cm-variable">i</span><span class="cm-bracket">)</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">act_port</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"act_port"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 例化端口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span> <span class="cm-variable">i</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> &lt; <span class="cm-number">16</span>; <span class="cm-variable">i</span><span class="cm-meta">++</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">fork</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">automatic</span> <span class="cm-keyword">int</span> <span class="cm-variable">k</span> <span class="cm-meta">=</span> <span class="cm-variable">i</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> <span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">exp_port</span><span class="cm-bracket">[</span><span class="cm-variable">k</span><span class="cm-bracket">]</span>.<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-variable">get_expect</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 【系统自带：port.get】被动方构造函数get</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">expect_queue</span>.<span class="cm-variable">push_back</span><span class="cm-bracket">(</span><span class="cm-variable">get_expect</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">join_none</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> <span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">act_port</span>.<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-variable">get_actual</span><span class="cm-bracket">)</span>; &nbsp;<span class="cm-comment">//@@ 【系统自带：port.get】被动方构造函数get</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">scoreboard</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_env</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_env</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_tlm_analysis_fifo</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span><span class="cm-tab" role="presentation" cm-text="	"> </span> <span class="cm-variable">agt_scb_fifo</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_tlm_analysis_fifo</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span><span class="cm-tab" role="presentation" cm-text="	"> </span> <span class="cm-variable">agt_mdl_fifo</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_tlm_analysis_fifo</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span><span class="cm-tab" role="presentation" cm-text="	"> </span> <span class="cm-variable">mdl_scb_fifo</span><span class="cm-bracket">[</span><span class="cm-number">16</span><span class="cm-bracket">]</span>; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 【核心】后缀法无法这样</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 例化组件&amp;端口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">agt_scb_fifo</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"agt_scb_fifo"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">agt_mdl_fifo</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"agt_mdl_fifo"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">for</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span> <span class="cm-variable">i</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> &lt; <span class="cm-number">16</span>; <span class="cm-variable">i</span><span class="cm-meta">++</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">mdl_scb_fifo</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">]</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-meta">$sformatf</span><span class="cm-bracket">(</span><span class="cm-string">"mdl_scb_fifo_%0d"</span>, <span class="cm-variable">i</span><span class="cm-bracket">)</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 连接</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">i_agt</span>.<span class="cm-variable">ap</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">agt_mdl_fifo</span>.<span class="cm-variable">analysis_export</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">mdl</span>.<span class="cm-variable">port</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">agt_mdl_fifo</span>.<span class="cm-variable">blocking_get_export</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span> <span class="cm-variable">i</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> &lt; <span class="cm-number">16</span>; <span class="cm-variable">i</span><span class="cm-meta">++</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">mdl</span>.<span class="cm-variable">ap</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">]</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">mdl_scb_fifo</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">]</span>.<span class="cm-variable">analysis_export</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ analysis_export</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">scb</span>.<span class="cm-variable">exp_port</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">]</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">mdl_scb_fifo</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">]</span>.<span class="cm-variable">blocking_get_export</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ blocking_get_export</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">o_agt</span>.<span class="cm-variable">ap</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">agt_scb_fifo</span>.<span class="cm-variable">analysis_export</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">scb</span>.<span class="cm-variable">act_port</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">agt_scb_fifo</span>.<span class="cm-variable">blocking_get_export</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1725px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1725px;"></div></div></div></pre><p>&nbsp;</p><h4><a name="补充-n1165" class="md-header-anchor"></a><span>补充：</span></h4><ul><li><span>uvm_seq_item_pull_port：</span><a href="file:///E:/Disc/%E3%80%901%E3%80%91~~%E5%B8%B8%E7%94%A8~~/%E3%80%90D-%E5%99%A8%E3%80%91%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E3%80%81%E5%B7%A5%E5%85%B7/10%20Verilog+SV+UVM+EDA+Makefile/UVM.html#Ctrl%E8%B7%B3%E8%BD%AC17"><span>参见【10.2~10.3  seq 高阶】</span></a></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h3><a name="ch-5phase机制" class="md-header-anchor"></a><span>Ch. 5_phase机制</span></h3><p><font color="red"><strong><span>要点总结</span></strong><span>：phase机制、objection机制</span></font></p><h4><a name="51-phase机制" class="md-header-anchor"></a><span>5.1 phase机制</span></h4><ul><li><p><span>5.1.1 ~ 5.1.4 function phase、task phase、执行顺序、树遍历</span></p><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-phase机制-uvm中的phase.jpg" referrerpolicy="no-referrer"></p><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-phase机制-phase同步.jpg" referrerpolicy="no-referrer"></p></li></ul><p>&nbsp;</p><ul><li><p><span>5.1.5 super.phase</span></p><p><code>super.build_phase</code><span>的目的是 获取 </span><code>config_db::set</code><span> 的参数</span></p><p><span>不是</span><code>uvm_component</code><span>的（例如 base_test），也需要调用 </span><code>super.</code><span> ，例如：</span><code>super.connect_phase</code></p><p><font color="blue"><span>反正都调用就不会错了</span></font></p></li></ul><p>&nbsp;</p><ul><li><p><span>5.1.6 虽然是 </span><code>UVM_ERROR</code><span> 也会结束仿真</span></p><p><span>在</span><font color="blue"><code>end_of_elaboration_phase</code></font><span>及其前的</span><code>phase</code><span>（</span><font color="blue"><code>build_phase</code><span>、</span><code>connect_phase</code></font><span>）中，如果出现了一个或多个</span><code>UVM_ERROR</code><span>，那么UVM就认为出现了致命错误，会调用</span><code>uvm_fatal</code><span>结束仿真。</span></p></li></ul><p>&nbsp;</p><ul><li><p><span>5.1.7  phase 的 jump</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th><th><span>备注</span></th></tr></thead><tbody><tr><td><span>phase . jump (  uvm</span><span>_</span><xxx><span>_phase::get ( ) );</span></xxx></td><td><span>当前 phase跳转至 xxx_phase</span></td><td>&nbsp;</td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"""phase的jump示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">my_driver</span>::<span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  @<span class="cm-bracket">(</span><span class="cm-keyword">negedge</span> <span class="cm-variable">vif</span>.<span class="cm-variable">rst_n</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">phase</span>.<span class="cm-variable">jump</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_reset_phase</span>::<span class="cm-variable">get</span><span class="cm-bracket">())</span>; &nbsp; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"""可选参数"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_xxxx_phase</span>::<span class="cm-variable">get</span><span class="cm-bracket">()</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ &nbsp; xxxx 可以是 func. phase 或是 task phase 中的任意一个</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"""规则"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">1</span>、必须是【前<span class="cm-meta">-</span>后】关系</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">2</span>、不能是并行关系（<span class="cm-variable">run_phase</span> 和 <span class="cm-variable">run</span><span class="cm-meta">-</span><span class="cm-variable">time_phase</span>）</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">3</span>、不能是 <span class="cm-variable">func</span>.<span class="cm-variable">phase</span> 跳 <span class="cm-variable">func</span>.<span class="cm-variable">phase</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 336px;"></div><div class="CodeMirror-gutters" style="display: none; height: 336px;"></div></div></div></pre></li></ul><p>&nbsp;</p><ul><li><p><span>5.1.8  phase 必要性 / 意义</span></p><p><span>① </span><font color="blue"><span>在不同时间做不同的事情</span></font><span>，这就是 UVM 中</span><code>phase</code><span>的设计哲学;</span></p><p><span>② phase的引入在很大程度上解决了</span><font color="blue"><span>因代码顺序杂乱</span></font><span>可能会引发的问题；</span></p><p><span>③ UVM的设计哲学就是全部</span><font color="blue"><span>由</span><code>seq</code><span>来控制激励的生成</span></font><span>，因此一般情况下只在</span><code>seq</code><span>中</span><font color="blue"><span>控制</span><code>objection</code></font><span>。</span></p></li></ul><p>&nbsp;</p><ul><li><p><span>5.1.9 phase 调试</span></p><figure><table><thead><tr><th><span>sim 仿真命令</span></th><th><span>注释</span></th><th><span>备注</span></th></tr></thead><tbody><tr><td><span>+UVM_PHASE_TRACE</span></td><td><span>phase 调试</span></td><td>&nbsp;</td></tr></tbody></table></figure><p>&nbsp;</p></li><li><p><span>5.1.10 超时退出</span></p><p><span>2种方法：</span>
<span>① 方法1： uvm代码</span>
<span>② 方法2：sim 仿真命令 </span><font color="blue"><span>&lt;推荐&gt;</span></font></p><ul><li><span>方法1</span></li></ul><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th><th><span>备注</span></th></tr></thead><tbody><tr><td><span>uvm_top . set_timeout ( </span><timeout><span>, </span><overridable><span>);</span></overridable></timeout></td><td><span>设置超时退出</span><br><span>参数1：设置时间</span><br><span>参数2：能否被覆盖 (1/0)</span></td><td>&nbsp;</td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""方法1：uvm代码 示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">base_test</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env</span> <span class="cm-meta">=</span> <span class="cm-variable">my_env</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"env"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_top</span>.<span class="cm-variable">set_timeout</span><span class="cm-bracket">(</span><span class="cm-number">500</span><span class="cm-variable">ns</span>, <span class="cm-number">0</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 第一个参数：设置的时间</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 第二个参数：设置是否可以被其后的其他set_timeout语句覆盖 </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""默认时间是：9200s"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">`define</span> <span class="cm-variable">UVM_DEFAULT_TIMEOUT</span> <span class="cm-number">9200</span><span class="cm-variable">s</span> &nbsp;<span class="cm-comment">// uvm源代码</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 224px;"></div><div class="CodeMirror-gutters" style="display: none; height: 224px;"></div></div></div></pre><ul><li><span>方法2</span></li></ul><figure><table><thead><tr><th><span>sim 仿真命令</span></th><th><span>注释</span></th><th><span>备注</span></th></tr></thead><tbody><tr><td><span>+UVM_TIMEOUT=</span><timeout><span>,</span><overridable></overridable></timeout></td><td><span>设置超时退出</span><br><span>参数1：设置时间</span><br><span>参数2：能否被覆盖 (YES/NO)</span></td><td><span>+UVM_TIMEOUT="300ns, YES"</span></td></tr></tbody></table></figure><p>&nbsp;</p></li></ul><h4><a name="52-objection机制" class="md-header-anchor"></a><span>5.2 objection机制</span></h4><p><font color="blue"><span>主要应用于 task phase</span></font><span> ( </span><code>run_phase</code><span> 和 </span><code>run-time_phase</code><span> )</span></p><ul><li><p><span>5.2.1~5.2.2 task_phase的objection、参数phase</span></p><p><span>1、如果想执行一些耗费时间的代码（</span><code>task</code><span>），那么要在 此phase下任意一个</span><code>component</code><span>中至少提起一次objection。</span></p><p><span>2、如果UVM发现此</span><code>phase</code><span>没有提起任何</span><code>objection</code><span>，那么将会 </span><font color="blue"><span>直接跳转到下一个</span><code>phase</code><span>中</span></font><span>。</span></p><p><span>3、</span><code>run_phase</code><span> 和 </span><code>run-time_phase</code><span> 最好都有自己的 objection</span></p><p><span>4、靠 传入的 </span><font color="blue"><span>参数 phase</span></font><span> 提起 objection</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th><th><span>备注</span></th></tr></thead><tbody><tr><td><span>phase . raise_objection(this)</span></td><td><span>提起objection机制</span></td><td><font color="blue"><span>多个参数</span></font><span> 见示例2</span></td></tr><tr><td><span>phase . drop_objection(this)</span></td><td><span>放下objection机制</span></td><td>&nbsp;</td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""objection机制示例1""""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">phase</span>.<span class="cm-variable">raise_objection</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">phase</span>.<span class="cm-variable">drop_objection</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""objection机制示例2：多个参数""""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_case0</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_test</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">starting_phase</span> <span class="cm-meta">!=</span> <span class="cm-keyword">null</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">starting_phase</span>.<span class="cm-variable">raise_objection</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>, <span class="cm-string">"case0 objection"</span>, <span class="cm-number">2</span><span class="cm-bracket">)</span>; &nbsp;<span class="cm-comment">//@@ 第二个参数是字符串，可以为空</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 第三个参数为objection的数量。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">#10000</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">starting_phase</span> <span class="cm-meta">!=</span> <span class="cm-keyword">null</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">starting_phase</span>.<span class="cm-variable">drop_objection</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>, <span class="cm-string">"case0 objection"</span>, <span class="cm-number">2</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 448px;"></div><div class="CodeMirror-gutters" style="display: none; height: 448px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>5.2.3 在哪控制objection</span></p><p><span>2种选择：</span>
<span>① 在 </span><code>scoreboard</code><span> 中提起 </span><code>objection</code>
<span>② 在 </span><strong><code>seq</code></strong><span> 中提起 </span><strong><code>sqr</code></strong><span> 的 </span><code>objection</code><span> （在 顶层 virtual seq  提起 ） </span><font color="red"><span>（推荐) </span></font><span>&nbsp;</span>
<span>   </span><font color="blue"><span>因为UVM的设计哲学就是：全部由</span><code>seq</code><span>来控制激励的生成，因此一般情况下只在</span><code>sqr</code><span>中控制</span><code>objection</code><span>。 </span></font></p><ul><li><p><span>在 </span><code>scoreboard</code><span> 种 提起 </span><code>objection</code></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""【不推荐，仅仅科普】在 scoreboard 中提起 objection 的示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">task</span> <span class="cm-variable">my_scoreboard</span>::<span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">phase</span>.<span class="cm-variable">raise_objection</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">fork</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> <span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">exp_port</span>.<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-variable">get_expect</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">expect_queue</span>.<span class="cm-variable">push_back</span><span class="cm-bracket">(</span><span class="cm-variable">get_expect</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span> <span class="cm-variable">i</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> &lt; <span class="cm-variable">pkt_num</span>; <span class="cm-variable">i</span><span class="cm-meta">++</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">act_port</span>.<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-variable">get_actual</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">join_any</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">phase</span>.<span class="cm-variable">drop_objection</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 336px;"></div><div class="CodeMirror-gutters" style="display: none; height: 336px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><a name="Ctrl跳转10"><span>在 顶层 </span><code>v_seq</code><span>种 提起 </span><code>objection</code></a><span>、</span><code>starting_phase</code></p><p><span>因为</span><code>virtual seq</code><span>是起统一调度作用的，这种统一调度不只体现在</span><code>transaction</code><span>上，也应该体现在</span><code>objection</code><span>的控制上。</span></p><ul><li><p><font color="bule"><code>starting_phase</code></font></p><p><span>① 在</span><code>seq</code><span>中可以使用</span><code>starting_phase</code><span>来控制 </span><font color="red"><strong><span>验证平台的关闭</span></strong></font><span>。</span></p><p><span>② </span><code>starting_phase</code><span> 值 </span><font color="blue"><span>不为 </span><code>null</code><span>  </span></font><span>的情况有以下2种，其他时候都为</span><code>null</code><span>（例如</span><font color="green"><code>`uvm_do(seq)</code><span> </span></font><span>时）：</span></p><p><span>		</span><span>a.  </span><font color="blue"><span>手工启动</span><code>seq</code><span>时为</span><code>starting_phase</code><span>赋值</span></font></p><p><span>		</span><span>b.  将此</span><code>seq</code><span>作为</span><code>sqr</code><span>的某</span><code>task phase</code><span>的 </span><font color="blue"><code>default_sequence</code></font></p><p><span>③ </span><font color="red"><span>当 </span><code>starting_phase</code><span>=</span><code>null</code><span> 的时候，使用</span><code>starting_phase.raise_objection</code><span>是没有任何用处的</span></font><span>。</span></p><p><span>④ </span><code>`uvm_do系列</code><span>宏并不提供 </span><code>starting_phase</code><span>的传递功能。</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>if(starting_phase != null)</span></td><td><span>判断</span><code>stating_phase</code><span>是否为</span><code>null</code></td></tr><tr><td><span>starting_phase.raise_objection(this);</span></td><td><span>利用</span><code>stating_phase</code><span>提起 </span><code>objection</code></td></tr><tr><td><span>starting_phase.drop_objection(this);</span></td><td><span>利用</span><code>stating_phase</code><span>放下 </span><code>objection</code></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""starting_phase = null, raise_objection 没有用 示例""""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ &nbsp; drv0_seq中的starting_phase为null，从而不会对objection进行操作</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">seq0</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">drv0_seq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">starting_phase</span> <span class="cm-meta">!=</span> <span class="cm-keyword">null</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">starting_phase</span>.<span class="cm-variable">raise_objection</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"drv0_seq"</span>, <span class="cm-string">"raise objection"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">else</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"drv0_seq"</span>, <span class="cm-string">"starting_phase is null, can't raise objection"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">v_seq</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">case0_vseq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">drv0_seq</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-variable">seq0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">starting_phase</span> <span class="cm-meta">!=</span> <span class="cm-keyword">null</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">starting_phase</span>.<span class="cm-variable">raise_objection</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do_on</span><span class="cm-bracket">(</span><span class="cm-variable">seq0</span>, <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_sqr0</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">#100</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">starting_phase</span> <span class="cm-meta">!=</span> <span class="cm-keyword">null</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">starting_phase</span>.<span class="cm-variable">drop_objection</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 672px;"></div><div class="CodeMirror-gutters" style="display: none; height: 672px;"></div></div></div></pre></li></ul></li></ul></li></ul><p>&nbsp;</p><p>&nbsp;</p><ul><li><p><span>5.2.4  objection的延时关闭属性</span></p><p><span>一个 </span><code>phase</code><span> 对应一个</span><code>drain_time</code><span>，并不是所有的</span><code>phase</code><span>共享一个drain_time。</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th><th><span>备注</span></th></tr></thead><tbody><tr><td><span>phase . phase_done . set_drain_time(this, 200);</span></td><td><span>为当前phase，设置objection延时关闭时间</span></td><td>&nbsp;</td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""objection的延时关闭属性示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">task</span> <span class="cm-variable">base_test</span>::<span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">phase</span>.<span class="cm-variable">phase_done</span>.<span class="cm-variable">set_drain_time</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>, <span class="cm-number">200</span><span class="cm-bracket">)</span>; &nbsp;<span class="cm-comment">//@@ 为当前phase，设置objection延时关闭时间为200个时间单位</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>5.2.5  objection调试</span></p><figure><table><thead><tr><th><span>sim 仿真命令</span></th><th><span>注释</span></th><th><span>备注</span></th></tr></thead><tbody><tr><td><span>+UVM_OBJECTION_TRACE</span></td><td><span>objection 调试</span></td><td>&nbsp;</td></tr></tbody></table></figure></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h4><a name="53-domain" class="md-header-anchor"></a><span>5.3 domain</span></h4><ul><li><p><span>5.3.1~5.3.3 </span></p><p><span>① domain 把</span><font color="blue"><span>两块时钟域隔开</span></font><span>，之后两个时钟域内的各个动态运行（run_time）的phase就可以不必同步。</span></p><p><span>② 注意，这里 domain </span><strong><span>只能隔离</span></strong><span> </span><strong><code>run-time phase</code></strong><span>，对于其他phase，其实还是同步的</span></p><p><span>             （即两个domain的 </span><code>run_phase</code><span>依然是同步的，其他的</span><code>function phase</code><span>也是同步的）</span></p><p><span>③ domain的应用使得 phase的跳转 可以</span><strong><span>只局限于验证平台的一部分</span></strong><span>。</span></p><p><span>			</span><span> （例如：B 两次进入了reset_phase和main_phase，而A只进入了一次）</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th><th><span>备注</span></th></tr></thead><tbody><tr><td><span>uvm_domain xxx;</span></td><td><span>在组件A的类中，声明一个domain指针xxx</span></td><td>&nbsp;</td></tr><tr><td><span>xxx = new("xxx");</span></td><td><span>在组件A的类中，在</span><strong><span>new func.</span></strong><span>中new</span></td><td>&nbsp;</td></tr><tr><td><span>set_domain (xxx，</span><int hier="1"><span>);</span></int></td><td><span>在组件A的类中，在</span><strong><span>connect_phase</span></strong><span>中  将A domain出去</span><br><span>参数2：为1时，表示递归其所有子类也加入该domain</span></td><td>&nbsp;</td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""完整domain示例代码"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">A</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_domain</span> <span class="cm-variable">new_domain</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 声明</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">A</span><span class="cm-bracket">)</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-keyword">string</span> <span class="cm-variable">name</span><span class="cm-meta">=</span><span class="cm-string">"A"</span>, <span class="cm-variable">uvm_component</span> <span class="cm-variable">parent</span><span class="cm-meta">=</span><span class="cm-keyword">null</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">super</span>.<span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-variable">name</span>, <span class="cm-variable">parent</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">new_domain</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"new_domain"</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@  new例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;<span class="cm-tab" role="presentation" cm-text="	">   </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">set_domain</span><span class="cm-bracket">(</span><span class="cm-variable">new_domain</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 设置启动</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 336px;"></div><div class="CodeMirror-gutters" style="display: none; height: 336px;"></div></div></div></pre><p>&nbsp;</p></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h3><a name="ch-6sequence机制" class="md-header-anchor"></a><span>Ch. 6_sequence机制</span></h3><p><font color="red"><strong><span>要点总结</span></strong><span>：</span></font></p><p><font color="red"><strong><span>seq内部</span></strong><span>：启动（uvm_do）、例化（uvm_create） 、发送（uvm_send）、tr优先级（pri）、rsp</span></font></p><p><font color="red"><strong><span>seq-seq</span></strong><span>：seq优先级（start）、lock、grab、seq嵌套、m_sqr、p_sqr、同步</span></font></p><p><font color="red"><strong><span>seq外部</span></strong><span>：v_seq、seq_lib、config_db</span></font></p><h4><a name="61-sequence-启动" class="md-header-anchor"></a><span>6.1 sequence 启动</span></h4><ul><li><p><span>6.1.1 sequence 的意义/作用</span></p><p><span>为了避免重复定义</span><strong><span>激励函数 </span></strong><code>gen_pkt函数</code><span>，有以下3种方法：</span></p><p><span>① </span><code>`gen_pkt</code><span>定义为</span><code>virtual</code><span>类型的</span><font color="blue"><span>虚函数</span></font><span>，重载 </span><code>gen_pkt函数</code><span> </span></p><p><span>	</span><strong><span>缺陷：</span></strong><span>新的问题产生，如何在这个测试用例中实例化这个新的driver呢？需要重新定义一个my_agent </span>
<span>​</span><span>		</span><span>        为了实例化这个新的agent，又只能重新定义一个my_env。</span></p><p><span>② 定义一个</span><font color="blue"><span>名称不一样</span></font><span>的 </span><code>gen_pkt函数</code><span> </span></p><p><span>	</span><strong><span>缺陷：</span></strong><span>driver的main_phase中又无法执行这种具有不同名字的函数，需要修改driver代码</span></p><p><span>③ 采用</span><font color="blue"><span>sequence机制</span></font><span>：</span>
<span>		</span><span>在不同的测试用例中，将不同的 </span><code>sequence</code><span> 设置成 </span><code>sequencer</code><span> 的 </span><code>main_phase</code><span> 的 </span><font color="blue"><code>default_sequence</code></font><span>。</span>
<span>		</span><span>当 </span><code>sequencer</code><span> 执行到 </span><code>main_phase</code><span> 时，发现有 </span><code>default_sequence</code><span>，那么它就启动</span><code>sequence</code><span>。</span></p></li></ul><p>&nbsp;</p><ul><li><p><span>6.1.2 sequence 的启动</span></p><p><span>在 </span><font color="blue"><strong><span>test_case&nbsp;</span></strong></font><span>中有3种方法 </span><strong><span>启动sequence</span></strong><span>:</span></p><p><span>① 方法1：手动启动 </span><code>seq.start</code>
<span>② 方法2：通过 </span><code>default_sequence</code><span>启动，   </span><code>uvm_config_db#(uvm_object_wrapper)::set</code><span> + </span><code>seq::type_id::get()</code>
<span>③ 方法3：通过 </span><code>default_sequence</code><span>启动，   </span><code>uvm_config_db#(uvm_sequence_base)::set</code><span>   + 例化后的</span><code>seq</code></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th><th><span>备注</span></th></tr></thead><tbody><tr><td><span>seq . start ( </span><sqr><span>,</span><parent seq=""><span>,</span><priority><span>);</span></priority></parent></sqr></td><td><span>启动sequence，将seq发送给sqr</span><br><span>参数1：sequencer</span><br><span>参数2：seq的父seq</span><br><span>参数3：优先级，默认-1</span></td><td><span>seq . start (sqr);</span></td></tr><tr><td><span>uvm_config_db#(uvm_object_wrapper)::set（略）</span></td><td>&nbsp;</td><td><font color="blue"><span>default_sequence 启动有2种办法，详见代码示例</span></font></td></tr><tr><td><span>uvm_config_db#(uvm_sequence_base)::set（略）</span></td><td>&nbsp;</td><td>&nbsp;</td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""方法1：手动启动seq.start示例1"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">my_sequence</span> <span class="cm-variable">my_seq</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">my_seq</span> <span class="cm-meta">=</span> <span class="cm-variable">my_sequence</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"my_seq"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">my_seq</span>.<span class="cm-variable">start</span><span class="cm-bracket">(</span><span class="cm-variable">sequencer</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""方法1：手动启动seq.start示例2"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">task</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">sqr</span>.<span class="cm-variable">set_arbitration</span><span class="cm-bracket">(</span><span class="cm-variable">SEQ_ARB_STRICT_FIFO</span><span class="cm-bracket">)</span>; &nbsp;<span class="cm-comment">// 仲裁方式设定</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">fork</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq0</span>.<span class="cm-variable">start</span><span class="cm-bracket">(</span><span class="cm-variable">env</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">sqr</span>, <span class="cm-keyword">null</span>, <span class="cm-number">100</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ 参数1：sequencer，参数2：seq的父seq，参数3：优先级，默认-1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq1</span>.<span class="cm-variable">start</span><span class="cm-bracket">(</span><span class="cm-variable">env</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">sqr</span>, <span class="cm-keyword">null</span>, <span class="cm-number">200</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@  优先级200</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">join</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 381px;"></div><div class="CodeMirror-gutters" style="display: none; height: 381px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""方法2：通过 `default_sequence`启动1"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_object_wrapper</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"env.i_agt.sqr.main_phase"</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 在case种设置sqr的</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"default_sequence"</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ default_sequence</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">case0_sequence</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">get</span><span class="cm-bracket">())</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""方法3：通过 `default_sequence`启动2"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">case0_sequence</span> <span class="cm-variable">cseq</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cseq</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"cseq"</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_sequence_base</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"env.i_agt.sqr.main_phase"</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"default_sequence"</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cseq</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 403px;"></div><div class="CodeMirror-gutters" style="display: none; height: 403px;"></div></div></div></pre><p>&nbsp;</p></li></ul><p>&nbsp;</p><h4><a name="62-sequence-仲裁机制" class="md-header-anchor"></a><span>6.2 sequence 仲裁机制</span></h4><ul><li><p><span>6.2.1 优先级 和 仲裁方式</span></p><ul><li><p><a name="Ctrl跳转9"><span>tr优先级</span></a></p><p><span>① 在</span><font color="blue"><span> seq</span></font><span> 代码中，设置 </span><strong><span>tr</span></strong><span>的优先级</span>
<span>② tr  和 seq  默认优先级都是 -1</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th><th><span>备注</span></th></tr></thead><tbody><tr><td><span>`</span><span>uvm_do（</span><seq or="" item=""><span>）</span></seq></td><td><span>seq 发送 seq  /  item</span><span>|</span><span>`uvm_do(m_trans)</span></td><td>&nbsp;</td></tr><tr><td><span>`uvm_do_pri（</span><seq or="" item=""><span>,  </span><priority><span>）</span></priority></seq></td><td><span>... 并设定优先级</span></td><td>&nbsp;</td></tr><tr><td><span>`uvm_do_with（</span><seq or="" item=""><span>,  </span><constraint><span>）</span></constraint></seq></td><td><span>... 并设定约束</span></td><td>&nbsp;</td></tr><tr><td><span>`uvm_do_pri_with（</span><seq or="" item=""><span>,  </span><priority><span>,  </span><constraint><span>）</span></constraint></priority></seq></td><td><span>... 并设定优先级、约束</span></td><td>&nbsp;</td></tr><tr><td><span>`uvm_do_on（</span><seq or="" item=""><span>,  </span><sqr><span>）</span></sqr></seq></td><td><span>seq 发送 (seq/item) 给 sqr</span></td><td>&nbsp;</td></tr><tr><td><span>`uvm_do_on_pri（</span><seq or="" item=""><span>,  </span><sqr><span>,  </span><priority><span>）</span></priority></sqr></seq></td><td><span>... 并设定优先级</span></td><td>&nbsp;</td></tr><tr><td><span>`uvm_do_on_with（</span><seq or="" item=""><span>,  </span><sqr><span>,  </span><constraint><span>）</span></constraint></sqr></seq></td><td><span>... 并设定约束</span></td><td>&nbsp;</td></tr><tr><td><span>`uvm_do_on_pri_with（</span><seq or="" item=""><span>,  </span><sqr><span>,  </span><priority><span>,  </span><constraint><span>）</span></constraint></priority></sqr></seq></td><td><span>... 并设定优先级、约束</span></td><td>&nbsp;</td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""tr优先级设定示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">sequence0</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">5</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do_pri</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span>, <span class="cm-number">100</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 优先级设定为100</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"sequence0"</span>, <span class="cm-string">"send one transaction"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">#100</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">sequence1</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">5</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do_pri_with</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span>, <span class="cm-number">200</span>, <span class="cm-bracket">{</span><span class="cm-variable">m_trans</span>.<span class="cm-variable">pload</span>.<span class="cm-variable">size</span> &lt; <span class="cm-number">500</span>;<span class="cm-bracket">})</span> &nbsp; &nbsp; <span class="cm-comment">//@@优先级+约束</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"sequence1"</span>, <span class="cm-string">"send one transaction"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 672px;"></div><div class="CodeMirror-gutters" style="display: none; height: 672px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>seq优先级、sqr 仲裁方式</span></p><p><span>① 在 </span><font color="blue"><span>test_case</span></font><span>代码中，设置 seq的优先级</span></p><p><span>② tr  和 seq  默认优先级都是 -1</span></p><p><span>③ 对</span><code>sequence</code><span>设置优先级的本质即设置其内产生的 </span><code>transaction</code><span>的优先级</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th><th><span>备注</span></th></tr></thead><tbody><tr><td><span>sqr . set_arbitration ( &lt;仲裁方式选项&gt; );</span></td><td><span>选择具体的仲裁方式</span></td><td><span>sqr.set_arbitration(SEQ_ARB_STRICT_FIFO);</span></td></tr><tr><td><font color="blue"><span>以下为具体仲裁方式选项</span></font></td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>SEQ_ARB_FIFO</span></td><td><span>先入先出，不考虑优先级</span></td><td>&nbsp;</td></tr><tr><td><span>SEQ_ARB_WEIGHTED</span></td><td><span>加权的仲裁，不考虑优先级</span></td><td>&nbsp;</td></tr><tr><td><span>SEQ_ARB_RANDOM</span></td><td><span>完全随机，不考虑优先级</span></td><td>&nbsp;</td></tr><tr><td><span>SEQ_ARB_STRICT_FIFO</span></td><td><font color="red"><span>先按优先级</span></font><br><span>优先级一致时，按先入先出</span></td><td>&nbsp;</td></tr><tr><td><span>SEQ_ARB_STRICT_RANDOM</span></td><td><font color="red"><span>先按优先级</span></font><br><span>优先级一致时，</span><font color="red"><span>随机从最高优先级中选择</span></font><span>&gt;</span></td><td>&nbsp;</td></tr><tr><td><span>SEQ_ARB_USER</span></td><td><span>用户自定义</span></td><td>&nbsp;</td></tr></tbody></table></figure><p>&nbsp;</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""seq 优先级 和 仲裁方式代码示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">task</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">sqr</span>.<span class="cm-variable">set_arbitration</span><span class="cm-bracket">(</span><span class="cm-variable">SEQ_ARB_STRICT_FIFO</span><span class="cm-bracket">)</span>; <span class="cm-comment">//@@ 仲裁方式设定</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 若想按照优先级，可选SEQ_ARB_STRICT_FIFO或是SEQ_ARB_STRICT_RANDOM</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">fork</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq0</span>.<span class="cm-variable">start</span><span class="cm-bracket">(</span><span class="cm-variable">env</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">sqr</span>, <span class="cm-keyword">null</span>, <span class="cm-number">100</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ 参数1：sequencer，参数2：seq的父seq，参数3：优先级，默认-1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq1</span>.<span class="cm-variable">start</span><span class="cm-bracket">(</span><span class="cm-variable">env</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">sqr</span>, <span class="cm-keyword">null</span>, <span class="cm-number">200</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@  优先级200</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">join</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 269px;"></div><div class="CodeMirror-gutters" style="display: none; height: 269px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li><li><p><span>6.2.2~6.2.3    seq ==影响==&gt; sqr 仲裁队列</span></p><p><font color="red"><span>—— lock任务、grab任务</span></font></p><p><span>在 </span><strong><font color="blue"><span>seq&nbsp;</span></font></strong><span>中写，去 </span><strong><font color="blue"><span>sqr&nbsp;</span></font></strong><span>的仲裁队列 </span><font color="blue"><span>排队</span></font></p><p><span>通过 </span><code>lock任务</code><span> 和 </span><code>grab任务</code><span>，</span><code>seq</code><span> 可以独占 </span><code>sqr</code><span>，强行使 </span><code>sqr</code><span> 发送自己产生的  </span><code>transaction</code><span>。</span></p><p><span>仲裁算法是由 </span><code>sqr</code><span> 决定的，</span><code>seq</code><span> 除了可以在 </span><strong><span>优先级</span></strong><span> 上进行设置外，对 </span><strong><span>仲裁的结果</span></strong><span> 无能为力。</span></p><figure><table><thead><tr><th><span>项目</span></th><th><font color="red"><span>lock</span></font><span>     vs     </span><font color="red"><span>grab</span></font></th></tr></thead><tbody><tr><td><span>差异点</span></td><td><span>【lock】 排入sqr的仲裁队列 </span><strong><span>最后</span></strong><span>，</span><strong><span>前面的都</span></strong><span>执行完了，才能执行</span><br><span>【grab】排入sqr的仲裁队列 </span><strong><span>最前</span></strong><span>，</span><strong><span>当前的</span></strong><span>执行完了，就能开始执行</span></td></tr><tr><td><span>共同点</span></td><td><span>开启时，只能它自己一个执行，直至它结束</span></td></tr><tr><td><span>优先级</span></td><td><span>grab &gt; lock</span></td></tr><tr><td><span>uvm代码</span></td><td><span>【lock】在</span><code>seq</code><span>的</span><code>body()  task</code><span>中定义</span><br><span>               lock( );</span><br><span>               unlock( );</span><br><span>【grab】在</span><code>seq</code><span>的</span><code>body()  task</code><span>中定义</span><br><span>                grab( );</span><br><span>                ungrab( );</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""lock示例（grab雷同）"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">sequence0</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">2</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span><span class="cm-bracket">)</span><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"sequence0"</span>, <span class="cm-string">"send one transaction"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lock</span><span class="cm-bracket">()</span>; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 锁住</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">5</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"sequence0"</span>, <span class="cm-string">"send one transaction"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">unlock</span><span class="cm-bracket">()</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@  解锁</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">2</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span><span class="cm-bracket">)</span><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"sequence0"</span>, <span class="cm-string">"send one transaction"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">#100</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-tab" role="presentation" cm-text="	"> </span>… </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_object_utils</span><span class="cm-bracket">(</span><span class="cm-variable">sequence0</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 560px;"></div><div class="CodeMirror-gutters" style="display: none; height: 560px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>6.2.4   seq 失效</span></p><p><font color="red"><span>——构造 is_relevant函数、wait_for_relevant任务</span></font></p><p><span> </span><code>is_relevant函数</code><span>、</span><code>wait_for_relevant任务</code><span>，也是在 </span><strong><font color="blue"><span>seq&nbsp;</span></font></strong><span>中写</span></p><p><span>① 通过设置</span><code>is_relevant函数</code><span>，可以使</span><code>seq</code><span>主动放弃</span><code>sqr</code><span>的使用权，而</span><code>grab任务</code><span>和</span><code>lock任务</code><span>则强占</span><code>sqr</code><span>的所有权。</span></p><p><span>② </span><code>sqr</code><span>发现</span><code>seq</code><span>无效，会调用</span><code>seq</code><span>的</span><code>wait_for_relevant任务</code><span>，等待</span><code>seq</code><span>变有效，所以， </span><code>is_relevant函数</code><span>与</span><code>wait_for_relevant任务</code><span>一般应成对重载，不能只重载其中的一个，否则会进入死循环</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""is_relevant函数、wait_for_relevant任务 示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">sequence0</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">bit</span> <span class="cm-variable">is_relevant</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span><span class="cm-bracket">((</span><span class="cm-variable">num</span> &gt;<span class="cm-meta">=</span> <span class="cm-number">3</span><span class="cm-bracket">)</span><span class="cm-meta">&amp;&amp;</span><span class="cm-bracket">(</span><span class="cm-meta">!</span><span class="cm-variable">has_delayed</span><span class="cm-bracket">))</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">else</span> <span class="cm-keyword">return</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">wait_for_relevant</span><span class="cm-bracket">()</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">#10000</span>;<span class="cm-tab" role="presentation" cm-text="	"> </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">has_delayed</span> <span class="cm-meta">=</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">num</span><span class="cm-meta">++</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"sequence0"</span>, <span class="cm-string">"send one transaction"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 605px;"></div><div class="CodeMirror-gutters" style="display: none; height: 605px;"></div></div></div></pre><p>&nbsp;</p><p>&nbsp;</p></li></ul><h4><a name="63-sequence-相关宏" class="md-header-anchor"></a><span>6.3 sequence 相关宏</span></h4><ul><li><p><span>6.3.1、6.3.4~6.3.5  uvm_do系列、start_item任务、finish_item任务、pre_do任务、mid_do函数、post_do函数</span></p><ul><li><p><code>uvm_do系列</code></p><p><a href="file:///E:/Disc/%E3%80%901%E3%80%91~~%E5%B8%B8%E7%94%A8~~/%E3%80%90D-%E5%99%A8%E3%80%91%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E3%80%81%E5%B7%A5%E5%85%B7/10%20Verilog+SV+UVM+EDA+Makefile/UVM.html#Ctrl%E8%B7%B3%E8%BD%AC9"><span>详细参见 tr优先级 </span></a></p><p><span>① </span><code>`uvm_do系列</code><span>宏并不提供 </span><code>starting_phase</code><span>的传递功能。</span></p><p><font color="blue"><span>本质、内部构造</span></font><span>：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="apl"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="apl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">uvm_do</span> <span class="cm-keyword">第一个参数为</span> <span class="cm-keyword">tr时，调用：</span> &nbsp;<span class="cm-keyword">start_item任务、finish_item任务</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">uvm_do</span> <span class="cm-keyword">第一个参数为seq时，调用</span> <span class="cm-keyword">seq的</span> <span class="cm-keyword">start任务</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-sequence机制-uvm_do本质结构.jpg" referrerpolicy="no-referrer"></p></li></ul><ul><li><p><span>uvm_do 下1层： </span><code>start_item任务</code><span>、</span><code>finish_item任务</code></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th><th><span>备注</span></th></tr></thead><tbody><tr><td><span>start_item(</span><item><span>, </span><priority><span>);</span></priority></item></td><td><span>seq开始处理tr，优先级默认-1</span></td><td><font color="blue"><span>参数必须是item，不能是seq</span></font></td></tr><tr><td><span>finish_item(</span><item><span>, </span><priority><span>);</span></priority></item></td><td><span>seq结束处理tr，优先级默认-1</span></td><td><font color="blue"><span>参数必须是item，不能是seq</span></font></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""uvm_do 内部封装了start_item任务、finish_item任务 """</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">tr</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"tr"</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">start_item</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span>，<span class="cm-number">100</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@  参数2为 tr的优先级，此处为100</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">()</span> <span class="cm-keyword">with</span> <span class="cm-bracket">{</span><span class="cm-variable">tr</span>.<span class="cm-variable">pload</span>.<span class="cm-variable">size</span><span class="cm-bracket">()</span> <span class="cm-meta">==</span> <span class="cm-number">200</span>;<span class="cm-bracket">})</span>; <span class="cm-variable">finish_item</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">finish_item</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span>，<span class="cm-number">100</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 202px;"></div><div class="CodeMirror-gutters" style="display: none; height: 202px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>uvm_do 下2层： </span><code>pre_do任务</code><span>、</span><code>mid_do函数</code><span>、</span><code>post_do函数</code></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>类型</span></th><th><span>位置</span></th><th><span>参数说明</span></th></tr></thead><tbody><tr><td><span>pre_do ( &lt;bit is_item&gt; )</span></td><td><span>任务</span></td><td><span>start_item最后一行</span></td><td><span>表明uvm_do宏是在对一个transaction还是在对一个sequence进行操作</span></td></tr><tr><td><span>mid_do ( </span><seq or="" item=""><span> )</span></seq></td><td><span>函数</span></td><td><span>finish_item最开始</span></td><td><span>正在操作的sequence或者item的指针</span></td></tr><tr><td><span>post_do ( </span><seq or="" item=""><span> )</span></seq></td><td><span>函数</span></td><td><span>finish_item最后一行</span></td><td><span>正在操作的sequence或者item的指针</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">""" pre_do任务、mid_do函数、post_do函数 示例代码 """</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">case0_sequence</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-variable">m_trans</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">int</span> <span class="cm-variable">num</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">pre_do</span><span class="cm-bracket">(</span><span class="cm-keyword">bit</span> <span class="cm-variable">is_item</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">#100</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"sequence0"</span>, <span class="cm-string">"this is pre_do"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">mid_do</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_sequence_item</span> <span class="cm-variable">this_item</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">int</span> <span class="cm-variable">p_sz</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"sequence0"</span>, <span class="cm-string">"this is mid_do"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">void</span>'<span class="cm-bracket">(</span><span class="cm-meta">$cast</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span>, <span class="cm-variable">this_item</span><span class="cm-bracket">))</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">p_sz</span> <span class="cm-meta">=</span> <span class="cm-variable">tr</span>.<span class="cm-variable">pload</span>.<span class="cm-variable">size</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-bracket">{</span><span class="cm-variable">tr</span>.<span class="cm-variable">pload</span><span class="cm-bracket">[</span><span class="cm-variable">p_sz</span> <span class="cm-number">4</span><span class="cm-bracket">]</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">tr</span>.<span class="cm-variable">pload</span><span class="cm-bracket">[</span><span class="cm-variable">p_sz</span> <span class="cm-number">3</span><span class="cm-bracket">]</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp; <span class="cm-variable">tr</span>.<span class="cm-variable">pload</span><span class="cm-bracket">[</span><span class="cm-variable">p_sz</span> <span class="cm-number">2</span><span class="cm-bracket">]</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">tr</span>.<span class="cm-variable">pload</span><span class="cm-bracket">[</span><span class="cm-variable">p_sz</span> <span class="cm-number">1</span><span class="cm-bracket">]}</span> <span class="cm-meta">=</span> <span class="cm-variable">num</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">tr</span>.<span class="cm-variable">crc</span> <span class="cm-meta">=</span> <span class="cm-variable">tr</span>.<span class="cm-variable">calc_crc</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-tab" role="presentation" cm-text="	">   </span> <span class="cm-variable">tr</span>.<span class="cm-variable">print</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">post_do</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_sequence_item</span> <span class="cm-variable">this_item</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"sequence0"</span>, <span class="cm-string">"this is post_do"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">num</span><span class="cm-meta">++</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 851px;"></div><div class="CodeMirror-gutters" style="display: none; height: 851px;"></div></div></div></pre></li></ul></li></ul><p>&nbsp;</p><ul><li><p><span>6.3.2~6.3.3  uvm_create系列、uvm_send系列</span></p><p><font color="blue"><code>uvm_do</code><span> 相当于 </span><code>uvm_create</code><span>&nbsp; + </span><code>uvm_send</code></font></p><ul><li><p><span>uvm_create系列</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>`</span><span>uvm_create(</span><seq or="" item=""><span>)</span></seq></td><td><span>例化tr，等价于new( )</span><span>|</span><span>`uvm_create(m_trans)</span><br><font color="blue"><span>等价于 m_trans= new("m_trans");</span></font></td></tr></tbody></table></figure><p>&nbsp;</p></li><li><p><span>uvm_send系列</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>`</span><span>uvm_send（</span><seq or="" item=""><span>）</span></seq></td><td><span>seq 发送 seq  /  item</span><br><span>例如：</span><span>`</span><span>uvm_send(m_trans)</span></td></tr><tr><td><span>`uvm_send_pri（</span><seq or="" item=""><span>,    </span><priority><span>）</span></priority></seq></td><td><span>... 并设定优先级</span></td></tr><tr><td><span>`</span><span>uvm_rand_send（</span><seq or="" item=""><span>）</span></seq></td><td><span>seq 发送 随机化的seq  /  item</span><br><span>例如：`uvm_rand_send(m_trans)</span></td></tr><tr><td><span>`uvm_rand_send_pri（</span><seq or="" item=""><span>,    </span><priority><span>）</span></priority></seq></td><td><span>... 并设定优先级</span></td></tr><tr><td><span>`uvm_rand_send_with（</span><seq or="" item=""><span>， </span><constraint><span>）</span></constraint></seq></td><td><span>... 并设定约束</span></td></tr><tr><td><span>`uvm_rand_send_pri_with（</span><seq or="" item=""><span>,   </span><priority><span>,  </span><constraint><span>）</span></constraint></priority></seq></td><td><span>... 并设定优先级、约束</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""seq代码中uvm_send示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">sequence0</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">m_trans</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"m_trans"</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 等价于 `uvm_create(m_trans)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_rand_send_pri_with</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span>, <span class="cm-number">100</span>, <span class="cm-bracket">{</span><span class="cm-variable">m_trans</span>.<span class="cm-variable">pload</span>.<span class="cm-variable">size</span> <span class="cm-meta">==</span> <span class="cm-number">100</span>;<span class="cm-bracket">})</span> &nbsp;<span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 246px;"></div><div class="CodeMirror-gutters" style="display: none; height: 246px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li></ul><p>&nbsp;</p><h4><a name="64--seq嵌套msqrpsqr" class="md-header-anchor"></a><span>6.4  seq嵌套、m_sqr、p_sqr</span></h4><ul><li><p><span>6.4.1、6.4.3  嵌套seq</span></p><p><span>① 一个 </span><code>sqr</code><span> 只能产生一种类型的</span><code>transaction</code></p><p><span>② 一个 </span><code>seq</code><span> 如果要想在此</span><code>sqr</code><span>上启动，那么其所产生的</span><code>tr</code><span>的类型必须是这种 </span><code>transaction</code><span> 或者 派生自这种</span><code>transaction</code></p><p><span>③ 若 </span><code>tr</code><span> 类型不同的2个 </span><code>seq</code><span>被嵌套，那么需要进行在</span><font color="blue"><code>driver代码</code></font><span>中 </span><font color="blue"><code>$cast（子seq对象，父seq指针）</code><span> </span></font><span> 进行补救</span></p><ul><li><p><span>tr类型相同的seq嵌套</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""示例1：tr类型相同的seq嵌套，直接嵌套"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">case0_sequence</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">crc_seq</span> <span class="cm-variable">cseq</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ &nbsp;  此处假设 crc_seq 和 long_seq 有派生关系，属于 同一种 tr类型</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">long_seq</span> <span class="cm-variable">lseq</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">cseq</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">lseq</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 336px;"></div><div class="CodeMirror-gutters" style="display: none; height: 336px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>tr类型不同的seq嵌套</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""示例2：tr类型不同的seq嵌套，driver使用$cast补救"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">seq</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">case0_sequence</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-variable">m_trans</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 两个的类型不一样</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">your_transaction</span> <span class="cm-variable">y_trans</span>; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span><span class="cm-bracket">)</span> &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">y_trans</span><span class="cm-bracket">)</span> &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_object_utils</span><span class="cm-bracket">(</span><span class="cm-variable">case0_sequence</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">driver</span>代码》补救</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">task</span> <span class="cm-variable">my_driver</span>::<span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-variable">m_tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">your_transaction</span> <span class="cm-variable">y_tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq_item_port</span>.<span class="cm-variable">get_next_item</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-meta">$cast</span><span class="cm-bracket">(</span><span class="cm-variable">m_tr</span>, <span class="cm-variable">req</span><span class="cm-bracket">))</span> <span class="cm-keyword">begin</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 假如[类的向下转换成功] req为父指针（item），m_tr为子对象</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">drive_my_transaction</span><span class="cm-bracket">(</span><span class="cm-variable">m_tr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"driver"</span>, <span class="cm-string">"receive a transaction whose type is my_transaction"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-meta">$cast</span><span class="cm-bracket">(</span><span class="cm-variable">y_tr</span>, <span class="cm-variable">req</span><span class="cm-bracket">))</span> <span class="cm-keyword">begin</span> &nbsp; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">drive_your_transaction</span><span class="cm-bracket">(</span><span class="cm-variable">y_tr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"driver"</span>, <span class="cm-string">"receive a transaction whose type is your_transaction"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-keyword">begin</span> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_error</span><span class="cm-bracket">(</span><span class="cm-string">"driver"</span>, <span class="cm-string">"receive a transaction whose type is unknown"</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq_item_port</span>.<span class="cm-variable">item_done</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 874px;"></div><div class="CodeMirror-gutters" style="display: none; height: 874px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li><li><p><span>6.4.2 seq 使用rand 变量</span></p><p><span>在</span><font color="blue"><span> </span><code>seq</code></font><span> 中定义</span><font color="blue"><code>rand类型变量</code></font><span> 以向产生的</span><code>tr</code><span>传递约束时，变量的名字一定要与</span><font color="blue"><code>tr</code></font><span>中相应字段的 </span><strong><font color="red"><span>名字不同</span></font></strong><span>。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">long_seq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span><span class="cm-bracket">[</span><span class="cm-number">47</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">ldmac</span>; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do_with</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span>, <span class="cm-bracket">{</span><span class="cm-variable">tr</span>.<span class="cm-variable">crc_err</span> <span class="cm-meta">==</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-tab" role="presentation" cm-text="	">   </span> &nbsp;<span class="cm-variable">tr</span>.<span class="cm-variable">pload</span>.<span class="cm-variable">size</span><span class="cm-bracket">()</span> <span class="cm-meta">==</span> <span class="cm-number">1500</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tr</span>.<span class="cm-variable">dmac</span> <span class="cm-meta">==</span> <span class="cm-variable">ldmac</span>;<span class="cm-bracket">})</span> &nbsp; &nbsp; <span class="cm-comment">//@@ 命名需不一样，( dmac 和 ldmac )</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">tr</span>.<span class="cm-variable">print</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 246px;"></div><div class="CodeMirror-gutters" style="display: none; height: 246px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>6.4.4~6.4.5  m_sequencer、p_sequencer</span></p><ul><li><p><code>m_sequencer</code></p><p><span>①  </span><font color="red"><span>使用 </span><code>uvm_do</code><span> 进行 相同</span><code>tr</code><span>类型的 </span><strong><code>seq</code><span> 嵌套时</span></strong><span>，实际上系统自动 给 内嵌的 </span><code>seq</code><span>分配的 </span><code>sqr</code><span> 就是 </span><code>m_sequencer</code><span>&nbsp;类型</span></font></p><p><span>② </span><code>m_sequencer</code><span> 是 </span><code>uvm_sequencer_base</code><span> 类型（ </span><code>uvm_sequencer</code><span>的基类），即 </span><font color="blue"><code>m_sequencer</code><span>&nbsp;</span></font><span>和 </span><font color="blue"><span> </span><code>uvm_sequencer</code><span>&nbsp;</span></font><span> 都由 </span><font color="blue"><code>uvm_sequencer_base</code></font><span>  </span><font color="red"><span>派生&nbsp;</span></font><span>而来 </span></p><p>&nbsp;</p></li><li><p><code>p_sequencer</code></p><p><font color="blue"><code>seq</code><span> </span></font><span>访问</span><font color="blue"><span> </span><code>sqr.变量</code><span> </span></font><span>的值的方式有2种：</span></p><p><span>① 方法1：在 seq代码中，使用</span><font color="blue"><span> </span><code>$cast(my_sequencer的对象, m_sequencer的指针)</code></font><span>转换后，读取</span><code>my_sequencer的对象.变量</code></p><p><span>② 方法2：在 seq代码中，使用</span><font color="blue"><span> </span><code>`uvm_declare_p_sequencer(my_sequencer类型)</code></font><span>转换后，读取</span><code>p_sequencer.变量</code><span>   </span><strong><font color="red"><span>&lt;推荐&gt;</span></font></strong></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th><th><span>备注</span></th></tr></thead><tbody><tr><td><span>`uvm_declare_p_sequencer(my_sequencer)</span></td><td><span>在seq中，将my_sequencer声明为p_sequencer</span></td><td><font color="blue"><span>声明后，在seq 的pre_body（）之前 ，自动完成$cast操作：$cast(my_sequencer对象， m_sequencer );</span></font></td></tr><tr><td><span>p_sequencer . 变量</span></td><td><span>调用p_sequencer的变量值</span></td><td><span>p_sequencer.dmac</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""my_sqr代码"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// my_sequencer的父类是uvm_sequencer，uvm_sequencer与m_sequencer平级，都继承自uvm_sequencer_base</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 即 my_sequencer例化后，就是子对象， m_sequencer 是父指针</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_sequencer</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequencer</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">bit</span><span class="cm-bracket">[</span><span class="cm-number">47</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">dmac</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">bit</span><span class="cm-bracket">[</span><span class="cm-number">47</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">smac</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">void</span>'<span class="cm-bracket">(</span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">bit</span><span class="cm-bracket">[</span><span class="cm-number">47</span>:<span class="cm-number">0</span><span class="cm-bracket">])</span>::<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,<span class="cm-string">""</span>, <span class="cm-string">"dmac"</span>, <span class="cm-variable">dmac</span><span class="cm-bracket">))</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">void</span>'<span class="cm-bracket">(</span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">bit</span><span class="cm-bracket">[</span><span class="cm-number">47</span>:<span class="cm-number">0</span><span class="cm-bracket">])</span>::<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,<span class="cm-string">""</span>, <span class="cm-string">"smac"</span>, <span class="cm-variable">smac</span><span class="cm-bracket">))</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">my_sequencer</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""【会报错】seq直接引用"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">seq0</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do_with</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span>, <span class="cm-bracket">{</span><span class="cm-variable">m_trans</span>.<span class="cm-variable">dmac</span> <span class="cm-meta">==</span> <span class="cm-variable">m_sequencer</span>.<span class="cm-variable">dmac</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 会报错</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">m_trans</span>.<span class="cm-variable">smac</span> <span class="cm-meta">==</span> <span class="cm-variable">m_sequencer</span>.<span class="cm-variable">smac</span>;<span class="cm-bracket">})</span> &nbsp; <span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""【正确用法-方法1】seq使用$cast转换sqr"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">seq0</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-variable">m_trans</span>; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_sequencer</span> &nbsp;<span class="cm-variable">x_sqr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$cast</span><span class="cm-bracket">(</span><span class="cm-variable">x_sqr</span>, <span class="cm-variable">m_sequencer</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ x_sqr是my_sequencer例化后的子对象，m_sequencer是父指针</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp;<span class="cm-comment">//@@ [类的向下转换]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do_with</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span>, <span class="cm-bracket">{</span><span class="cm-variable">m_trans</span>.<span class="cm-variable">dmac</span> <span class="cm-meta">==</span> <span class="cm-variable">x_sqr</span>.<span class="cm-variable">dmac</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 正确，不会报错</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">m_trans</span>.<span class="cm-variable">smac</span> <span class="cm-meta">==</span> <span class="cm-variable">x_sqr</span>.<span class="cm-variable">smac</span>;<span class="cm-bracket">})</span> &nbsp; <span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""【正确用法-方法2】seq使用p_quencer"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">seq0</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_transaction</span> <span class="cm-variable">m_trans</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_object_utils</span><span class="cm-bracket">(</span><span class="cm-variable">seq0</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_declare_p_sequencer</span><span class="cm-bracket">(</span><span class="cm-variable">my_sequencer</span><span class="cm-bracket">)</span> &nbsp; &nbsp;<span class="cm-comment">//@@ 声明了一个sqr类型的成员变量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp;<span class="cm-comment">//@@ 声明后，在seq 的pre_body（）之前 ，自动完成$cast操作</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ $cast(my_sequencer对象， m_sequencer );</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do_with</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span>, <span class="cm-bracket">{</span><span class="cm-variable">m_trans</span>.<span class="cm-variable">dmac</span> <span class="cm-meta">==</span> <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">dmac</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 正确，不会报错</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">m_trans</span>.<span class="cm-variable">smac</span> <span class="cm-meta">==</span> <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">smac</span>;<span class="cm-bracket">})</span> &nbsp; <span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1411px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1411px;"></div></div></div></pre></li></ul></li></ul><p>&nbsp;</p><h4><a name="65-seq-同步virtual-seq" class="md-header-anchor"></a><span>6.5 seq 同步、virtual seq</span></h4><ul><li><p><span>6.5.1~6.5.3  seq的同步</span></p><p><span>同步的方法有2个：</span></p><p><span>① 方法1：在 </span><code>seq</code><span>代码中，设置 </span><font color="blue"><span>全局事件</span></font><span>    </span><font color="red"><span>&lt;不推荐&gt;</span></font></p><p><span>② 方法2：通过 </span><font color="blue"><span> </span><code>virtual seq</code><span> </span></font><span>    （</span><strong><span>核心是</span></strong><span>：</span><font color="red"><strong><code>p_sequencer</code></strong><span> + 事先发送</span><strong><span>最长包</span></strong><code>`uvm_do_on_with</code></font><span>）</span></p><ul><li><p><span>通过 全局事件，达成</span><code>seq</code><span>的同步</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>-&gt;xxx;</span></td><td><span>触发事件xxx</span></td></tr><tr><td><span>@xxx;</span></td><td><span>等待该事件：  在这里暂停执行，直到 xxx事件被触发</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""【不推荐】在seq代码中，设置 全局事件，实现seq同步"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">seq0</span> 和 <span class="cm-variable">seq1</span> 代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">event</span> <span class="cm-variable">send_over</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ global event</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">drv0_seq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do_with</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span>, <span class="cm-bracket">{</span><span class="cm-variable">m_trans</span>.<span class="cm-variable">pload</span>.<span class="cm-variable">size</span> <span class="cm-meta">==</span> <span class="cm-number">1500</span>;<span class="cm-bracket">})</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-meta">-</span>&gt;<span class="cm-variable">send_over</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 触发事件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"drv0_seq"</span>, <span class="cm-string">"send one transaction"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">drv1_seq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  @<span class="cm-variable">send_over</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 等待该事件：  在这里暂停执行，直到 send_over 事件被触发</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"drv1_seq"</span>, <span class="cm-string">"send one transaction"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-keyword">case</span> 代码》 &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 通过 default_sequence 发送激励</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_object_wrapper</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"env0.i_agt.sqr.main_phase"</span>, &nbsp; <span class="cm-comment">//@@ 环境0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"default_sequence"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">drv0_seq</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">get</span><span class="cm-bracket">())</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ seq0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_object_wrapper</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"env1.i_agt.sqr.main_phase"</span>, &nbsp; <span class="cm-comment">//@@ 环境1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"default_sequence"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">drv1_seq</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">get</span><span class="cm-bracket">())</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ seq1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span> &nbsp; &nbsp; &nbsp;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 874px;"></div><div class="CodeMirror-gutters" style="display: none; height: 874px;"></div></div></div></pre></li></ul><p>&nbsp;</p></li><li><p><span>通过</span><code>virtual seq</code><span>，达成</span><code>seq</code><span>的同步</span></p><p><span>① 它根本就不发送</span><code>transaction</code><span>，它只是控制其他的</span><code>sequence</code><span>，起</span><font color="blue"><span>统一调度</span></font><span>的作用。</span></p><p><span>③ 为了使用 </span><code>virtual seq</code><span>，需要有一个 </span><font color="blue"><code>virtual sqr</code></font></p><p><span>  </span><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-sequence机制-virtual seq、virtual sqr.jpg" referrerpolicy="no-referrer"></p><p><span>  </span><strong><span>代码</span></strong><span>：</span>
<span>part1：《virtual sqr》          </span><br><span>  part2：《virtual seq》  </span><font color="blue"><span>发送seq，有2种方法</span><code>`uvm_do( )</code><span>和 手动 </span><code>seq.start()</code><span> </span></font>
<span>  part3：《seq0》、《seq1》   发送tr</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"""【part1】《virtual sqr代码》"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-def">##</span> 《<span class="cm-variable">v_sqr</span> 类》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">class</span> <span class="cm-variable">my_vsqr</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequencer</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_sequencer</span> <span class="cm-variable">p_sqr0</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ virtual sqr里面包含指向其他真实sqr的指针</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_sequencer</span> <span class="cm-variable">p_sqr1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-def">##</span> 《<span class="cm-variable">base_test_case</span>》中例化 <span class="cm-variable">v_sqr</span> 和 <span class="cm-variable">sqr</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">class</span> <span class="cm-variable">base_test</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_test</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">my_env</span> &nbsp; <span class="cm-tab" role="presentation" cm-text="	">   </span> <span class="cm-variable">env0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">my_env</span>  <span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">env1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">my_vsqr</span><span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">v_sqr</span>; &nbsp; <span class="cm-comment">//@@ 声明 v_sqr</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">env0</span> <span class="cm-meta">=</span> <span class="cm-variable">my_env</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"env0"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">env1</span> <span class="cm-meta">=</span> <span class="cm-variable">my_env</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"env1"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">v_sqr</span> <span class="cm-meta">=</span> <span class="cm-variable">my_vsqr</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"v_sqr"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化 v_sqr</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">v_sqr</span>.<span class="cm-variable">p_sqr0</span> <span class="cm-meta">=</span> <span class="cm-variable">env0</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">sqr</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 【直接赋值过来！！！！】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">v_sqr</span>.<span class="cm-variable">p_sqr1</span> <span class="cm-meta">=</span> <span class="cm-variable">env1</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">sqr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">endclass</span> </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 605px;"></div><div class="CodeMirror-gutters" style="display: none; height: 605px;"></div></div></div></pre><p><span>  </span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"""【part2】《virtual seq代码》发送seq：方法1：uvm_do()"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">class</span> <span class="cm-variable">case0_vseq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_object_utils</span><span class="cm-bracket">(</span><span class="cm-variable">case0_vseq</span><span class="cm-bracket">)</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_declare_p_sequencer</span><span class="cm-bracket">(</span><span class="cm-variable">my_vsqr</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 声明 my_vsqr 为 p_sequencer</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">drv0_seq</span> <span class="cm-variable">seq0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">drv1_seq</span> <span class="cm-variable">seq1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do_on_with</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span>, <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_sqr0</span>, <span class="cm-bracket">{</span><span class="cm-variable">tr</span>.<span class="cm-variable">pload</span>.<span class="cm-variable">size</span> <span class="cm-meta">==</span> <span class="cm-number">1500</span>;<span class="cm-bracket">})</span> <span class="cm-comment">//@@ 【核心】最长包≈时间最大并集</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"vseq"</span>, <span class="cm-string">"send one longest packet on p_sequencer.p_sqr0"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">fork</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do_on</span><span class="cm-bracket">(</span><span class="cm-variable">seq0</span>, <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_sqr0</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ seq 在 最大时间 下跑，必然是同步的</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do_on</span><span class="cm-bracket">(</span><span class="cm-variable">seq1</span>, <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_sqr1</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">join</span><span class="cm-tab" role="presentation" cm-text="	">  </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">/*</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-comment">在使用uvm_do_on宏的情况下，虽然seq0是在case0_vseq中启动，但是它最终会被交给p_sequencer.p_sqr0，也即env0.i_agt.sqr，而不是v_sqr。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-comment">这个就是virtual sequence和virtual sequencer中virtual的来源。它们各自并不产生transaction，而只是控制其他的sequence为相应的sequencer产生transaction。【统一调度】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-comment">*/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"""【part2】《virtual seq代码》发送seq：方法2：手动seq.start(sqr)"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">//@@  手动seq.start()： 好处是可以传递一些值进去</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">class</span> <span class="cm-variable">case0_vseq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_object_utils</span><span class="cm-bracket">(</span><span class="cm-variable">case0_vseq</span><span class="cm-bracket">)</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_declare_p_sequencer</span><span class="cm-bracket">(</span><span class="cm-variable">my_vsqr</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 声明 my_vsqr 为 p_sequencer</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">drv0_seq</span> <span class="cm-variable">seq0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">drv1_seq</span> <span class="cm-variable">seq1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do_on_with</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span>, <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_sqr0</span>, <span class="cm-bracket">{</span><span class="cm-variable">tr</span>.<span class="cm-variable">pload</span>.<span class="cm-variable">size</span> <span class="cm-meta">==</span> <span class="cm-number">1500</span>;<span class="cm-bracket">})</span> <span class="cm-comment">//@@ 【核心】最长包≈时间最大并集</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"vseq"</span>, <span class="cm-string">"send one longest packet on p_sequencer.p_sqr0"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq0</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"seq0"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq0</span>.<span class="cm-variable">file_name</span> <span class="cm-meta">=</span> <span class="cm-string">"data.txt"</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 手动启动 之 手动例化的好处[传入值]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq1</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"seq1"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">fork</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq0</span>.<span class="cm-variable">start</span><span class="cm-bracket">(</span><span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_sqr0</span><span class="cm-bracket">)</span>; &nbsp;<span class="cm-comment">//@@ 手动启动 之 seq.start</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq1</span>.<span class="cm-variable">start</span><span class="cm-bracket">(</span><span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_sqr1</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">join</span><span class="cm-tab" role="presentation" cm-text="	">  </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1187px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1187px;"></div></div></div></pre><p><span>  </span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"""【part3】seq0、seq1 发送tr"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-def">##</span> 《<span class="cm-variable">seq0</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">class</span> <span class="cm-variable">drv0_seq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 发送tr</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"drv0_seq"</span>, <span class="cm-string">"send one transaction"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">endclass</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-def">##</span> 《<span class="cm-variable">seq1</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">class</span> <span class="cm-variable">drv1_seq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 发送tr</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"drv1_seq"</span>, <span class="cm-string">"send one transaction"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 493px;"></div><div class="CodeMirror-gutters" style="display: none; height: 493px;"></div></div></div></pre><p><span>  </span></p></li><li><p><a name="Ctrl跳转11"><span>6.5.3-2 virtual seq 另外的</span><strong><span>好处</span></strong><span>/特点：</span></a></p><p><span>① </span><code>virtual seq</code><span> 的使用可以</span><font color="blue"><span>减少</span><code>config_db</code><span>语句</span></font><span>的使用</span></p><p><span>② </span><code>virtual seq</code><span> 作为一种特殊的</span><code>seq</code><span>，也可以在其中启动其他的</span><code>virtual seq</code><span>：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""减少`config_db`语句的使用"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-keyword">case</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_object_wrapper</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"v_sqr.main_phase"</span>, &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 一个config_db 顶很多个seq的cfg</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"default_sequence"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">case0_vseq</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">get</span><span class="cm-bracket">())</span>; &nbsp; <span class="cm-comment">//@@ v_seq内部的都被操作了</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 202px;"></div><div class="CodeMirror-gutters" style="display: none; height: 202px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""virtual seq 启动 其他virtual seq"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">case0_vseq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">cfg_vseq</span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">cvseq</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">cvseq</span><span class="cm-bracket">)</span> &nbsp; &nbsp; <span class="cm-comment">//v_seq0 发送 v_seq1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 224px;"></div><div class="CodeMirror-gutters" style="display: none; height: 224px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>6.5.4  顶层</span><code>virtual seq</code><span> 提起</span><code>objection</code><span>、</span><code>starting_phase</code></p><p><a href="file:///E:/Disc/%E3%80%901%E3%80%91~~%E5%B8%B8%E7%94%A8~~/%E3%80%90D-%E5%99%A8%E3%80%91%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E3%80%81%E5%B7%A5%E5%85%B7/10%20Verilog+SV+UVM+EDA+Makefile/UVM.html#Ctrl%E8%B7%B3%E8%BD%AC10"><span>参见 objection机制 </span></a></p><p>&nbsp;</p></li><li><p><span>6.5.5  </span><code>seq</code><span>并发运行、 </span><code>seq</code><span> 中 慎用 </span><code>for...join_none</code></p><p><span>系统会新启动这些进程，但是并不等待这些</span><code>seq</code><span>执行完毕就直接返回了, 返回之后就到了</span><code>endtask</code><span>。此时系统认为这个</span><code>seq</code><span>已经执行完成了。执行完成之后，系统将会清理这个</span><code>seq</code><span>之前占据的内存空间，“杀死”掉由其启动的进程。所以，本质上 这些 </span><code>seq</code><span>并未执行完。</span></p><p><span>解决办法有2个：</span></p><p><span>① 办法1：</span><code>fork...join_none</code><span> + </span><code>wait fork</code><span>      </span><font color="red"><span>&lt;推荐&gt;</span></font></p><p><span>② 办法2：使用 </span><code>fork...join</code><span>，缺陷是 </span><font color="blue"><span>无法使用 for 循环</span></font></p><ul><li><p><code>wait fork</code></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>wait fork;</span></td><td><span>等待fork结束，否则一直阻塞</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""fork...join_none + wait for"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">case0_vseq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_transaction</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">drv_seq</span> <span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; <span class="cm-variable">dseq</span><span class="cm-bracket">[</span><span class="cm-number">4</span><span class="cm-bracket">]</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">for</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span> <span class="cm-variable">i</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> &lt; <span class="cm-number">4</span>; <span class="cm-variable">i</span><span class="cm-meta">++</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">fork</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">automatic</span> <span class="cm-keyword">int</span> <span class="cm-variable">j</span> <span class="cm-meta">=</span> <span class="cm-variable">i</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do_on</span><span class="cm-bracket">(</span><span class="cm-variable">dseq</span><span class="cm-bracket">[</span><span class="cm-variable">j</span><span class="cm-bracket">]</span>, <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_sqr</span><span class="cm-bracket">[</span><span class="cm-variable">j</span><span class="cm-bracket">])</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">join_none</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-keyword">wait</span> <span class="cm-keyword">fork</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 314px;"></div><div class="CodeMirror-gutters" style="display: none; height: 314px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><code>for...join</code></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""fork...join"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">case0_vseq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">drv_seq</span><span class="cm-tab" role="presentation" cm-text="	"> </span> <span class="cm-variable">dseq</span><span class="cm-bracket">[</span><span class="cm-number">4</span><span class="cm-bracket">]</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">fork</span> &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 缺点： 只是这样就无法使用for循环了（for循环会导致实际运行的是4个for...join）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_do_on</span><span class="cm-bracket">(</span><span class="cm-variable">dseq</span><span class="cm-bracket">[</span><span class="cm-number">0</span><span class="cm-bracket">]</span>, <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_sqr</span><span class="cm-bracket">[</span><span class="cm-number">0</span><span class="cm-bracket">])</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_do_on</span><span class="cm-bracket">(</span><span class="cm-variable">dseq</span><span class="cm-bracket">[</span><span class="cm-number">1</span><span class="cm-bracket">]</span>, <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_sqr</span><span class="cm-bracket">[</span><span class="cm-number">1</span><span class="cm-bracket">])</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_do_on</span><span class="cm-bracket">(</span><span class="cm-variable">dseq</span><span class="cm-bracket">[</span><span class="cm-number">2</span><span class="cm-bracket">]</span>, <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_sqr</span><span class="cm-bracket">[</span><span class="cm-number">2</span><span class="cm-bracket">])</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_do_on</span><span class="cm-bracket">(</span><span class="cm-variable">dseq</span><span class="cm-bracket">[</span><span class="cm-number">3</span><span class="cm-bracket">]</span>, <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_sqr</span><span class="cm-bracket">[</span><span class="cm-number">3</span><span class="cm-bracket">])</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">join</span> &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 269px;"></div><div class="CodeMirror-gutters" style="display: none; height: 269px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li></ul><p>&nbsp;</p><p>&nbsp;</p><h4><a name="66-在seq中使用configdb" class="md-header-anchor"></a><span>6.6 在seq中使用config_db</span></h4><ul><li><p><span>6.6.1~6.6.2 获取和设置</span></p><ul><li><p><span>获取 get</span></p><p><span>① </span><code>get</code><span>函数原型中，第一个参数必须是一个</span><code>component</code><span>，而</span><code>seq</code><span>不是一个</span><code>component</code><span>，所以这里  </span><font color="red"><span>不能使用</span><code>this</code><span>指针</span></font><span>，只能使用  </span><font color="blue"><code>null</code><span>&nbsp;</span></font><span>或者  </span><font color="blue"><code>uvm_root：：get（）</code></font></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>uvm_config_db#(数据类型)::get(组件名，例化名，变量名，变量);</span></td><td><span>获得变量值</span></td></tr><tr><td><code>get</code><span>函数的第一参数：可以是</span><font color="blue"><span> </span><code>null</code></font><span>  或是 </span><font color="blue"><span> </span><code>uvm_root::get()</code></font><span>,  不能是</span><font color="red"><span> </span><code>this</code></font></td><td>&nbsp;</td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""获取（get）示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">seq</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span><span class="cm-bracket">)</span>::<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-keyword">null</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 注意【get】seq的第一参数只能是：null / uvm_root::get()</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">get_full_name</span><span class="cm-bracket">()</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"count"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">count</span><span class="cm-bracket">)</span>; &nbsp; </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 134px;"></div><div class="CodeMirror-gutters" style="display: none; height: 134px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>设置 set</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>uvm_config_db#(数据类型)::set(组件名，例化名，变量名，值);</span></td><td><span>设置变量值</span></td></tr><tr><td><code>set</code><span>函数的第一参数：可以是</span><font color="blue"><span> </span><code>this</code></font><span> 或是</span><font color="blue"><span> </span><code>null</code></font><span>  或是 </span><font color="blue"><span> </span><code>uvm_root::get()</code></font></td><td>&nbsp;</td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""设置（set）示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-keyword">case</span>代码》<span class="cm-variable">build_phase</span> <span class="cm-meta">/</span> 《<span class="cm-variable">seq</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 【set】seq的第一参数 可以是：this / null / uvm_root::get()</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"env.i_agt.sqr.*"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"count"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">9</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">bit</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_root</span>::<span class="cm-variable">get</span><span class="cm-bracket">()</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"uvm_test_top.env0.scb"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"cmp_en"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">0</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">bit</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_root</span>::<span class="cm-variable">get</span><span class="cm-bracket">()</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"uvm_test_top.v_sqr.*"</span>, &nbsp; <span class="cm-comment">//@@ 【写启动路径】seq在virtual seq中被启动</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"first_start"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">0</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@  所以其get_full_name的结果应该是uvm_test_top.v_sqr.*，而不是uvm_test_top.env0.i_agt.sqr.*，所以在设置set 时，第二个参数应该是 uvm_test_top.v_sqr.*。</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 403px;"></div><div class="CodeMirror-gutters" style="display: none; height: 403px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li><li><p><span>6.6.2-2 </span><code>virtual_seq</code><span> 相关的  </span></p><p><span>① </span><code>virtual seq</code><span> 的使用可以</span><font color="blue"><span>减少</span><code>config_db</code><span>语句</span></font><span>的使用   </span></p><p><a href="file:///E:/Disc/%E3%80%901%E3%80%91~~%E5%B8%B8%E7%94%A8~~/%E3%80%90D-%E5%99%A8%E3%80%91%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E3%80%81%E5%B7%A5%E5%85%B7/10%20Verilog+SV+UVM+EDA+Makefile/UVM.html#Ctrl%E8%B7%B3%E8%BD%AC11"><span>参见virtual seq 的好处 </span></a></p><p><span>② </span><code>virtual seq</code><span> 中启动的 </span><code>seq</code><span>，在</span><font color="blue"><span>设置（</span><code>set</code><span>）时，第2参数&nbsp;</span></font><span> 需要 写成&nbsp; </span><code>uvm_test_top.v_sqr.*</code><span>，而不是</span><code>uvm_test_top.env0.i_agt.sqr.*</code><span>，即 写  </span><font color="blue"><span>启动路径</span></font></p><p><font color="cyan"><span>参见上面的设置（set）示例</span></font></p></li></ul><p>&nbsp;</p><ul><li><p><span>6.6.3 </span><code>wait_modified</code></p><p><span>① 与 </span><code>config_db：：get</code><span>的前三个参数完全一样。当它检测到 </span><font color="blue"><span>第三个参数的值</span></font><span> 被更新过后，它就返回，否则一直等待在那里</span></p><p><span>② 可以在 </span><code>seq</code><span>中 调用，也可以在 </span><code>component</code><span> 中 调用</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>uvm_config_db#(数据类型)::wait_modified(&lt;组件名&gt;,&lt;例化名&gt;, &lt;变量名&gt;);</span></td><td><span>变量值是否修改，修改则返回1，否则阻塞</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""示例1：在seq中调用 wai_modified"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">seq</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">drv0_seq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;<span class="cm-variable">x</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">bit</span> <span class="cm-variable">send_en</span> <span class="cm-meta">=</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">fork</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">bit</span><span class="cm-bracket">)</span>::<span class="cm-variable">wait_modified</span><span class="cm-bracket">(</span><span class="cm-keyword">null</span>, <span class="cm-variable">get_full_name</span><span class="cm-bracket">()</span>, <span class="cm-string">"send_en"</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ seq中调用</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">void</span>'<span class="cm-bracket">(</span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">bit</span><span class="cm-bracket">)</span>::<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-keyword">null</span>, <span class="cm-variable">get_full_name</span>, <span class="cm-string">"send_en"</span>, <span class="cm-variable">send_en</span><span class="cm-bracket">))</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"drv0_seq"</span>, <span class="cm-meta">$sformatf</span><span class="cm-bracket">(</span><span class="cm-string">"send_en value modified, the new value is %0d"</span>, <span class="cm-variable">se</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">join_none</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">wait</span> <span class="cm-keyword">fork</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""示例2：在component中调用 wai_modified"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">task</span> <span class="cm-variable">my_scoreboard</span>::<span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">fork</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">bit</span><span class="cm-bracket">)</span>::<span class="cm-variable">wait_modified</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,<span class="cm-string">""</span>, <span class="cm-string">"cmp_en"</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ component中调用</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">void</span>'<span class="cm-bracket">(</span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">bit</span><span class="cm-bracket">)</span>::<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,<span class="cm-string">""</span>, <span class="cm-string">"cmp_en"</span>, <span class="cm-variable">cmp_en</span><span class="cm-bracket">))</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"my_scoreboard"</span>, <span class="cm-meta">$sformatf</span><span class="cm-bracket">(</span><span class="cm-string">"cmp_en value modified, the new value is %0d"</span>, <span class="cm-variable">cmp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">join</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 717px;"></div><div class="CodeMirror-gutters" style="display: none; height: 717px;"></div></div></div></pre><p>&nbsp;</p></li></ul><p>&nbsp;</p><h4><a name="67-response的使用" class="md-header-anchor"></a><span>6.7 response的使用</span></h4><ul><li><p><span>6.7.1~6.7.4  respone 的方法</span></p><p><span>① </span><code>response</code><span> 指的是 </span><code>driver</code><span>  返回给 </span><code>seq</code><span>的</span><code>tr</code><span> 信息</span></p><p><span>② </span><code>driver代码</code><span> </span><code>response</code><span> 的发送，主要有3种方法：</span></p><p><span>			</span><span>a.</span><span>	</span><span>方法1：</span><code>put_response任务</code><span> </span></p><p><span>			</span><span>b.</span><span>	</span><span>方法2：</span><code>seq_item_port . item_done ( rsp );</code><span>   </span><font color="blue"><span>&lt;缺陷：只能发一个rsp&gt;</span></font></p><p><span>			</span><span>c.</span><span>	</span><span>方法3：</span><code>driver</code><span> 对属性变量 直接 赋值   </span><font color="red"><span> &lt;最常用&gt;</span></font></p><p><span>③ </span><code>seq代码</code><span>  </span><code>response</code><span> 的获得，主要有 3 种方法：</span></p><p><span>			</span><span>a.</span><span>	</span><span>方法1：</span><code>get_response任务</code><span>  </span></p><p><span>			</span><span>b.</span><span>	</span><span>方法2：</span><code>response_handler函数</code><span>  </span><font color="blue"><span>&lt;优点：drv的发送rsp 和 seq发送的tr 可以解耦开（不同进程发送，互不影响)&gt;</span></font></p><p><span>			</span><span>c. </span><span>	</span><span>方法3：</span><code>`uvm_do(tr)</code><span>后  直接读取 </span><code>tr.属性</code><font color="red"><span> &lt;最常用&gt;</span></font></p><p><span>④</span><code>driver</code><span> 发送 </span><code>rsp</code><span>  +   </span><code>seq</code><span> 获得 </span><code>rsp</code><span>  组合起来就有 9种方法</span></p><p><span>⑤ 多次发送获得</span><code>rsp</code><span>，就写多个</span><code>get_response</code><span> 和 </span><code>put_response</code><span>，两者一一对应，</span><code>sqr</code><span> 内推队列最大支持 8个</span></p><p>&nbsp;</p><p>&nbsp;</p><ul><li><p><code>driver</code><span> 发送 </span><code>rsp</code><span> </span></p><figure><table><thead><tr><th><span>序号</span></th><th><span>uvm代码</span></th><th><span>注释</span></th><th><span>备注</span></th></tr></thead><tbody><tr><td>&nbsp;</td><td><span>rsp.set_id_info(req);</span></td><td><span>driver将req的id等信息复制到rsp中。</span></td><td><span>由于可能存在多个sequence在同一个sequencer上启动的情况，只有设置了rsp的id等信息，sequencer才知道将response返回给哪个sequence。</span></td></tr><tr><td><span>方法1</span></td><td><span>seq_item_port.put_response(rsp);</span></td><td><span>driver 发送rsp</span></td><td>&nbsp;</td></tr><tr><td><span>方法2</span></td><td><span>seq_item_port.item_done(rsp);</span></td><td><span>driver 发送rsp       </span><font color="blue"><span>缺陷是只能done一次，也就只能发一次rsp</span></font></td><td>&nbsp;</td></tr><tr><td><span>方法3</span></td><td><code>driver</code><span> 对之前</span><code>seq</code><span>发送的</span><code>tr</code><span> 的属性进行一个赋值</span></td><td><font color="red"><span> &lt;最常用&gt;</span></font></td><td><span>当一个</span><code>uvm_do</code><span>语句执行完毕后，其第一个参数并不是一个空指针，而是指向刚刚被送给</span><code>driver</code><span>的</span><code>transaction</code><span>。利用这一点，</span><code>driver</code><span>中向</span><code>req</code><span>中的成员变量赋值，而</span><code>seq</code><span>则检测这个值。</span></td></tr></tbody></table></figure><ul><li><p><span>put_response(rsp)</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""driver - put_response(rsp) - 发送rsp"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">driver</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">task</span> <span class="cm-variable">my_driver</span>::<span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">seq_item_port</span>.<span class="cm-variable">get_next_item</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">drive_one_pkt</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">rsp</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"rsp"</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ 例化rsp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">rsp</span>.<span class="cm-variable">set_id_info</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 将req的id等信息复制到rsp中</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq_item_port</span>.<span class="cm-variable">put_response</span><span class="cm-bracket">(</span><span class="cm-variable">rsp</span><span class="cm-bracket">)</span>; &nbsp;<span class="cm-comment">//@@ put_response(rsp)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">seq_item_port</span>.<span class="cm-variable">item_done</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 291px;"></div><div class="CodeMirror-gutters" style="display: none; height: 291px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>item_done(rsp)</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""driver - item_done(rsp) - 发送rsp"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">driver</span>代码》<span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">seq_item_port</span>.<span class="cm-variable">get_next_item</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">drive_one_pkt</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">rsp</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"rsp"</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 例化 rsp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">rsp</span>.<span class="cm-variable">set_id_info</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ 将req的id等信息复制到rsp中</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">seq_item_port</span>.<span class="cm-variable">item_done</span><span class="cm-bracket">(</span><span class="cm-variable">rsp</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ item_done(rsp)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">end</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 202px;"></div><div class="CodeMirror-gutters" style="display: none; height: 202px;"></div></div></div></pre><p>&nbsp;</p></li></ul><p>&nbsp;</p><p>&nbsp;</p></li><li><p><code>seq</code><span> 获取  </span><code>rsp</code><span> </span></p><figure><table><thead><tr><th><span>序号</span></th><th><span>uvm代码</span></th><th><span>注释</span></th><th><span>备注</span></th></tr></thead><tbody><tr><td><span>方法1</span></td><td><span>get_response(rsp);</span></td><td><span>seq在发送tr之后，获取rsp</span></td><td>&nbsp;</td></tr><tr><td><span>方法2</span></td><td><span>重载</span><code>response_handler函数</code></td><td><span>启动 </span><code>response_handler</code></td><td><font color="blue"><span>具体参见下方介绍</span></font></td></tr><tr><td><span>方法3</span></td><td><code>`uvm_do(tr)</code><span>后  直接读取返回来的 </span><code>tr.被赋值的属性</code></td><td><font color="red"><span> &lt;最常用&gt;</span></font></td><td><span>当一个</span><code>uvm_do</code><span>语句执行完毕后，其第一个参数并不是一个空指针，而是指向刚刚被送给</span><code>driver</code><span>的</span><code>transaction</code><span>。利用这一点，</span><code>driver</code><span>中向</span><code>req</code><span>中的成员变量赋值，而</span><code>seq</code><span>则检测这个值。</span></td></tr></tbody></table></figure><ul><li><p><span>get_response(rsp)</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""seq - get_response(rsp) - 获取rsp"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">seq</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">case0_sequence</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">get_response</span><span class="cm-bracket">(</span><span class="cm-variable">rsp</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ &nbsp; uvm_do 发送tr后，准备接收 rsp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"seq"</span>, <span class="cm-string">"get one response"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">rsp</span>.<span class="cm-variable">print</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_object_utils</span><span class="cm-bracket">(</span><span class="cm-variable">case0_sequence</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 291px;"></div><div class="CodeMirror-gutters" style="display: none; height: 291px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>重载</span><code>response_handler函数</code><span> </span></p><p><span>① [场景]: </span></p><p><span>		</span><span>假如</span><code>driver</code><span>需要延时较长的一段时间才能将</span><code>transaction</code><span>传给 </span><code>seq</code><span>，在此期间，</span><code>driver</code><span>希望能够继续从</span><code>seq</code><span>得到新的</span><code>transaction</code><span>并驱动它，但是由于</span><code>seq</code><span>被阻塞在了那里，根本不可能发出新的</span><code>transaction</code><span>。</span></p><p><span>② [原因]: </span></p><p><span>		</span><span>发生这种情况的主要原因为</span><code>seq</code><span>中发送</span><code>transaction</code><span>与</span><code>get_response</code><span>是在同一个进程中执行的，假如分开就能解决。</span></p><p><span>③ [解决办法]: </span></p><p><span>		</span><span>分开就要启动 </span><code>response_handler</code><span>，默认是关闭的。启动的方法是用  </span><code>use_response_handler函数</code></p><p><span>④ [实现rsp使用]：</span></p><p><span>		</span><span>当打开</span><code>response handler</code><span>功能后，用户需要重载虚函数</span><code>response_handler</code><span>：</span></p><p><span>		</span><span>此函数的参数是一个</span><code>uvm_sequence_item</code><span>类型的指针，需要首先将其通过</span><code>cast</code><span>转换变成</span><code>my_transaction</code><span>类型，之后就可以根据</span><code>rsp</code><span>的值来决定后续</span><code>seq</code><span>的行为</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""seq - 重载response_handler函数 - 获取rsp"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">seq</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">case0_sequence</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">pre_body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">use_response_handler</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ response_handler 函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">response_handler</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_sequence_item</span> <span class="cm-variable">response</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-meta">!$cast</span><span class="cm-bracket">(</span><span class="cm-variable">rsp</span>, <span class="cm-variable">response</span><span class="cm-bracket">))</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@  函数内部cast转换  rsp子类对象， respone父类指针</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_error</span><span class="cm-bracket">(</span><span class="cm-string">"seq"</span>, <span class="cm-string">"can't cast"</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">else</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"seq"</span>, <span class="cm-string">"get one response"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">rsp</span>.<span class="cm-variable">print</span><span class="cm-bracket">()</span>; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">starting_phase</span> <span class="cm-meta">!=</span> <span class="cm-keyword">null</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">starting_phase</span>.<span class="cm-variable">raise_objection</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">#100</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">starting_phase</span> <span class="cm-meta">!=</span> <span class="cm-keyword">null</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">starting_phase</span>.<span class="cm-variable">drop_objection</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_object_utils</span><span class="cm-bracket">(</span><span class="cm-variable">case0_sequence</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 672px;"></div><div class="CodeMirror-gutters" style="display: none; height: 672px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li><li><p><span>方法3 组合 示例    </span><font color="red"><span>&lt;最常用&gt;</span></font></p><p><span>当一个</span><font color="blue"><code>uvm_do</code></font><span>语句执行完毕后，其</span><font color="blue"><span>第一个参数</span></font><span>并不是一个空指针，而是</span><font color="blue"><span>指向刚刚被送给</span><code>driver</code><span>的</span><code>transaction</code></font><span>。利用这一点，</span><code>driver</code><span>中向</span><code>req</code><span>中的成员变量赋值，而</span><code>seq</code><span>则检测这个值。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ [最常用]</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""【seq】`uvm_do(tr)后直接读取返回来的 tr.被赋值的属性 + 【driver】对之前seq发送的tr的属性进行一个赋值"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">driver</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">task</span> <span class="cm-variable">my_driver</span>::<span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">seq_item_port</span>.<span class="cm-variable">get_next_item</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">drive_one_pkt</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>;<span class="cm-tab" role="presentation" cm-text="	"> </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">req</span>.<span class="cm-variable">frm_drv</span> <span class="cm-meta">=</span> <span class="cm-string">"this is information from driver"</span>; <span class="cm-comment">//@@ 对之前seq发送的req的属性frm_drv进行信息赋值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">seq_item_port</span>.<span class="cm-variable">item_done</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">seq</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">case0_sequence</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"seq"</span>, <span class="cm-meta">$sformatf</span><span class="cm-bracket">(</span><span class="cm-string">"get information from driver: %0s"</span>, <span class="cm-variable">m_trans</span>.<span class="cm-variable">frm_drv</span><span class="cm-bracket">)</span>, <span class="cm-variable">UVM_MEDIUM</span>） &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 直接读取返回来的req被赋值的属性frm_drv的值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_object_utils</span><span class="cm-bracket">(</span><span class="cm-variable">case0_sequence</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 582px;"></div><div class="CodeMirror-gutters" style="display: none; height: 582px;"></div></div></div></pre></li></ul></li></ul><p>&nbsp;</p><p>&nbsp;</p><h4><a name="68-seq-libraryseq批量" class="md-header-anchor"></a><span>6.8 seq library、seq批量</span></h4><ul><li><p><span>6.8.1 </span><code>seq</code><span> 加入 </span><code>seq_lib</code></p><p><span>步骤：</span>
<span>① step-1： 构造 </span><code>seq_lib</code>
<span>② step-2：</span><code>seq</code><span> 加入 </span><code>seq_lib</code></p><ul><li><p><span>构造 </span><code>seq_lib</code></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>uvm_sequence_library # ( my_transaction );</span></td><td><span>类继承</span></td></tr><tr><td><span>init_sequence_library( );</span></td><td><span>new函数中初始化</span></td></tr><tr><td><span>`uvm_sequence_library_utils ( simple_seq_library );</span></td><td><span>宏注册</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""stpe-1：构造seq_lib"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">seq_lib</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">simple_seq_library</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence_library</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ 类继承</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-keyword">string</span> <span class="cm-variable">name</span><span class="cm-meta">=</span> <span class="cm-string">"simple_seq_library"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">super</span>.<span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-variable">name</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">init_sequence_library</span><span class="cm-bracket">()</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ library 初始化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_object_utils</span><span class="cm-bracket">(</span><span class="cm-variable">simple_seq_library</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_sequence_library_utils</span><span class="cm-bracket">(</span><span class="cm-variable">simple_seq_library</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ library 注册</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 246px;"></div><div class="CodeMirror-gutters" style="display: none; height: 246px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><code>seq</code><span> 加入 </span><code>seq_lib</code></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>`</span><span>uvm_add_to_seq_lib ( </span><seq><span>,    </span><seq library=""><span> )</span></seq></seq></td><td><code>seq</code><span> 加入 </span><code>seq_library</code></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""stpe-2：seq 加入 seq_lib"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">seq0</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_object_utils</span><span class="cm-bracket">(</span><span class="cm-variable">seq0</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_add_to_seq_lib</span><span class="cm-bracket">(</span><span class="cm-variable">seq0</span>, <span class="cm-variable">simple_seq_library</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@  将seq0 加入 seq_lib</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span><span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"seq0"</span>, <span class="cm-string">"this is seq0"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 291px;"></div><div class="CodeMirror-gutters" style="display: none; height: 291px;"></div></div></div></pre></li></ul></li></ul><p>&nbsp;</p><ul><li><p><span>6.8.2~6.8.3  </span><code>seq_lib</code><span> 选择算法 、执行次数、</span><code>seq_lib</code><span>的 </span><code>config_db</code></p><ul><li><p><code>seq_lib</code><span> 选择 </span><code>seq</code><span> 的算法</span></p><p><span>在 </span><font color="blue"><span>test_case&nbsp;</span></font><span>的 </span><font color="blue"><span>build_phase</span></font><span> 中设置 选择seq算法</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>uvm_sequence_lib_mode</span></td><td><span>config_db 数据类型</span></td></tr><tr><td><span>default_sequence . selection_mode</span></td><td><span>算法属性</span></td></tr><tr><td><font color="blue"><span>参数可选项</span></font></td><td>&nbsp;</td></tr><tr><td><span>UVM_SEQ_LIB_RAND</span></td><td><span>完全随机</span></td></tr><tr><td><span>UVM_SEQ_LIB_RANDC</span></td><td><span>完全随机（轮询）</span></td></tr><tr><td><span>UVM_SEQ_LIB_ITEM</span></td><td><code>seq_lib</code><span>内的</span><code>seq</code><span>都不用，用</span><code>seq_lib</code><span>自己（</span><code>seq_lib</code><span>相当于一个</span><code>seq</code><span>拿来用）</span></td></tr><tr><td><span>UVM_SEQ_LIB_USER</span></td><td><span>用户自定义</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""seq_lib 通过config_db 设置 seq选择算法 示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-keyword">case</span>代码》<span class="cm-variable">build_phase</span> 设置 <span class="cm-variable">sqr</span>.<span class="cm-variable">main_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 将 seq_lib 设置为 default_sequence</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_object_wrapper</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"env.i_agt.sqr.main_phase"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"default_sequence"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">simple_seq_library</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">get</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 设置 选择seq算法</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_sequence_lib_mode</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,<span class="cm-number">93</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"env.i_agt.sqr.main_phase"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"default_sequence.selection_mode"</span>, &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">UVM_SEQ_LIB_RANDC</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 336px;"></div><div class="CodeMirror-gutters" style="display: none; height: 336px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><code>seq_lib</code><span>执行选择的次数</span></p><p><span>在 </span><font color="blue"><span>test_case </span></font><span>的 </span><font color="blue"><span>build_phase</span></font><span> 中设置 </span><code>seq_lib</code><span> 发送</span><code>seq</code><span> 执行次数</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>default_sequence . min_random_count</span></td><td><span>seq_lib发送seq  执行最少次数</span></td></tr><tr><td><span>default_sequence . max_random_count</span></td><td><span>seq_lib发送seq  执行最多次数</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""seq_lib 通过config_db 设置 seq_lib发送seq 执行次数 示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-keyword">case</span>代码》<span class="cm-variable">build_phase</span> 设置 <span class="cm-variable">sqr</span>.<span class="cm-variable">main_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 将 seq_lib 设置为 default_sequence</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_object_wrapper</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"env.i_agt.sqr.main_phase"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"default_sequence"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">simple_seq_library</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">get</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 设置 最少 seq_lib选择 执行次数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span> <span class="cm-keyword">unsigned</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"env.i_agt.sqr.main_phase"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"default_sequence.min_random_count"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">5</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 设置 最多 seq_lib选择 执行次数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span> <span class="cm-keyword">unsigned</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"env.i_agt.sqr.main_phase"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"default_sequence.max_random_count"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">20</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 448px;"></div><div class="CodeMirror-gutters" style="display: none; height: 448px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><code>seq_lib</code><span> 一次性设置完 选择算法和执行次数</span></p><p><span>2种方法：</span>
<span>① 方法1：使用 </span><code>uvm_sequence_library_cfg</code><span> 类</span>
<span>② 方法2：</span><code>seq_lib</code><span> 属性 赋值法</span></p><ul><li><p><code>uvm_sequence_library_cfg</code><span> 类</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>uvm_sequence_library_cfg</span></td><td><span>seq_lib 的 config类型</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""seq_lib一次性设置完选择算法&amp;执行次数: &nbsp; `uvm_sequence_library_cfg` 类 法"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-keyword">case</span>代码》<span class="cm-variable">build_phase</span> 设置 <span class="cm-variable">sqr</span>.<span class="cm-variable">main_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_sequence_library_cfg</span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">cfg</span>; &nbsp; <span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">cfg</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"cfg"</span>, <span class="cm-variable">UVM_SEQ_LIB_RANDC</span>, <span class="cm-number">5</span>, <span class="cm-number">20</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ new创建cfg空间</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 将 seq_lib 设置为 default_sequence</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_object_wrapper</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"env.i_agt.sqr.main_phase"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"default_sequence"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">simple_seq_library</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">get</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_sequence_library_cfg</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"env.i_agt.sqr.main_phase"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"default_sequence.config"</span>, &nbsp;<span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cfg</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 426px;"></div><div class="CodeMirror-gutters" style="display: none; height: 426px;"></div></div></div></pre><p>&nbsp;</p><ul><li><p><code>seq_lib</code><span> 属性 赋值法</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""seq_lib一次性设置完选择算法&amp;执行次数：seq_lib 属性赋值法"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-keyword">case</span>代码》<span class="cm-variable">build_phase</span> 设置 <span class="cm-variable">sqr</span>.<span class="cm-variable">main_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">simple_seq_library</span><span class="cm-tab" role="presentation" cm-text="	">  </span> <span class="cm-variable">seq_lib</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">seq_lib</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"seq_lib"</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@  例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">seq_lib</span>.<span class="cm-variable">selection_mode</span> <span class="cm-meta">=</span> <span class="cm-variable">UVM_SEQ_LIB_RANDC</span>; &nbsp; <span class="cm-comment">//@@  直接赋值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">seq_lib</span>.<span class="cm-variable">min_random_count</span> <span class="cm-meta">=</span> <span class="cm-number">10</span>; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">seq_lib</span>.<span class="cm-variable">max_random_count</span> <span class="cm-meta">=</span> <span class="cm-number">15</span>; &nbsp;<span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 一次性设置</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_sequence_base</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>, <span class="cm-comment">//@@ seq_lib的最上面类型是 uvm_sequence_base &nbsp; &nbsp; </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"env.i_agt.sqr.main_phase"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"default_sequence"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">seq_lib</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 358px;"></div><div class="CodeMirror-gutters" style="display: none; height: 358px;"></div></div></div></pre></li></ul></li></ul></li></ul></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h4><a name="补充-n2028" class="md-header-anchor"></a><span>补充：</span></h4><ul><li><p><span>seq 高阶：</span><a href="file:///E:/Disc/%E3%80%901%E3%80%91~~%E5%B8%B8%E7%94%A8~~/%E3%80%90D-%E5%99%A8%E3%80%91%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E3%80%81%E5%B7%A5%E5%85%B7/10%20Verilog+SV+UVM+EDA+Makefile/UVM.html#Ctrl%E8%B7%B3%E8%BD%AC16"><span>参见 【10.2~10.3  seq 高阶】 </span></a></p></li><li><p><span>其他</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1</span>）需要哪些类：<span class="cm-bracket">[</span><span class="cm-number">5</span>个类<span class="cm-bracket">]</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_sequence_item</span> <span class="cm-meta">=</span>&gt; <span class="cm-variable">uvm_sequece</span> <span class="cm-meta">=</span>&gt; <span class="cm-variable">uvm_sequencer</span> <span class="cm-meta">=</span>&gt; <span class="cm-variable">uvm_driver</span>， &nbsp; &nbsp;<span class="cm-variable">uvm_agent</span> （<span class="cm-variable">sqr</span>和<span class="cm-variable">driver</span> <span class="cm-variable">port</span>的连接）</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2</span>）数据流</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>用<span class="cm-keyword">sequence</span>去生成仿真，将<span class="cm-variable">sequence_item</span> 通过<span class="cm-variable">sequencer</span> 发送到 <span class="cm-variable">driver</span>上。 </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">a</span>.【<span class="cm-keyword">sequence</span>】数据，里面实现一个<span class="cm-variable">body</span><span class="cm-bracket">()</span> 函数</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">b</span>.【<span class="cm-variable">driver</span>】消耗</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; 需要有一个 <span class="cm-variable">seq_item_port</span> 去获取 <span class="cm-variable">req</span>, 具体是在<span class="cm-variable">driver</span>的<span class="cm-variable">run_phase</span>中:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">seq_item_port</span>.<span class="cm-variable">get_next_item</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>; &nbsp;<span class="cm-comment">//消耗</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">seq_item_port</span>.<span class="cm-variable">item_done</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">c</span>.【<span class="cm-variable">sequencer</span>】控制</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ① <span class="cm-variable">set</span> <span class="cm-variable">default_sequence</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ② <span class="cm-variable">construct</span> <span class="cm-variable">default_sequence</span> <span class="cm-variable">object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ③ <span class="cm-variable">set</span> <span class="cm-keyword">sequence</span>'<span class="cm-variable">s</span> <span class="cm-variable">starting_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ④ <span class="cm-variable">randomizes</span> <span class="cm-keyword">sequence</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ⑤ <span class="cm-variable">call</span> <span class="cm-keyword">sequence</span>'<span class="cm-variable">s</span> <span class="cm-variable">start</span><span class="cm-bracket">()</span> <span class="cm-variable">method</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">d</span>.【<span class="cm-variable">agent</span>】<span class="cm-variable">port</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 381px;"></div><div class="CodeMirror-gutters" style="display: none; height: 381px;"></div></div></div></pre><p><img src="./UVM_files/SV&amp;UVM基础_UVMsequence机制.jpg" referrerpolicy="no-referrer"></p></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h3><a name="ch-7寄存器" class="md-header-anchor"></a><span>Ch. 7_寄存器</span></h3><p><font color="red"><strong><span>要点总结</span></strong><span>：</span></font></p><p><img src="./UVM_files/SV&amp;UVM基础_UVM寄存器.jpg" referrerpolicy="no-referrer" alt="image"></p><p><span>	</span><span>◇ 权限</span>
<span>​</span><span>		</span><span>RW：read &amp; write        验证方法：先写后读</span>
<span>​        WO：write only            验证方法：先写一个非0值，再读为0</span>
<span>​</span><span>	</span><span>    RO：read only              验证方法：先写一个非0值，再读为0</span>
<span>​</span><span>	</span><span>    RC：read &amp; clear          验证方法：读2次 ，第2次值为0</span></p><p><span>    ◇ uvm寄存器的3个类：</span>
<span>​</span><span>			</span><span>① uvm_reg_block</span>
<span>​</span><span>			</span><span>② uvm_reg</span>
<span>​</span><span>			</span><span>③ uvm_reg_field</span></p><p><span>	</span><span>◇ RAL具备通用的操作需求：</span></p><p><span>			</span><span>① 读/写 寄存器：</span>
<span>​</span><span>			</span><span>② 前/后门操作： 前门（bus_agent类、adapter连接）</span>
<span>​</span><span>										</span><span>  后门（hdl_path、env.sv加上path）</span></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h4><a name="补充-n2057" class="md-header-anchor"></a><span>补充：</span></h4><ul><li><span>寄存器 代码重用：</span><a href="file:///E:/Disc/%E3%80%901%E3%80%91~~%E5%B8%B8%E7%94%A8~~/%E3%80%90D-%E5%99%A8%E3%80%91%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E3%80%81%E5%B7%A5%E5%85%B7/10%20Verilog+SV+UVM+EDA+Makefile/UVM.html#Ctrl%E8%B7%B3%E8%BD%AC20"><span>参见 【9.4.1 基于env的重用】</span></a></li><li><span>寄存器模型  随机化 DUT 参数：</span><a href="file:///E:/Disc/%E3%80%901%E3%80%91~~%E5%B8%B8%E7%94%A8~~/%E3%80%90D-%E5%99%A8%E3%80%91%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E3%80%81%E5%B7%A5%E5%85%B7/10%20Verilog+SV+UVM+EDA+Makefile/UVM.html#Ctrl%E8%B7%B3%E8%BD%AC19"><span>参见 【10.4  寄存器 </span><code>DUT</code><span> 参数 随机化】</span></a></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h3><a name="ch-8factory机制" class="md-header-anchor"></a><span>Ch. 8_factory机制</span></h3><p><font color="red"><strong><span>要点总结</span></strong><span>：</span></font><font color="red"><span>factory机制的本质是对SV的</span><strong><code>new函数</code></strong><span>的 </span><strong><span>重载</span></strong></font></p><p><font color="red"><span>有了 factory机制后：</span></font></p><p><span>① 除了使用new函数外，还可以</span><font color="red"><span>根据</span><code>类名创建</code></font><span>这个类的一个</span><font color="red"><code>实例</code></font>
<span>② 还可以在创建类的实例时 </span><font color="red"><span>根据是否有</span><code>重载记录</code></font><span>来决定是创建 </span><font color="red"><code>原始的类</code></font><span>，还是创建 </span><font color="red"><code>重载的类</code></font><span>的</span><font color="red"><code>实例</code></font><span>。</span></p><h4><a name="81--重载-override" class="md-header-anchor"></a><span>8.1  重载 override</span></h4><p><span>-- 自带函数 override：OOP多态</span>
<span>-- 函数 override： 【callback机制】</span>
<span>-- 类class override：【factory机制】</span>
<span>            </span><code>factory</code><span>机制 </span><strong><span>最大优势</span></strong><span>是使得一个</span><font color="red"><span>子类的指针</span></font><span>  </span><font color="blue"><span>以父类的类型</span></font><span>传递时，其表现出的行为依然是</span><font color="blue"><span>子类的</span></font></p><ul><li><p><span>8.1.1~8.1.2 task、func.、constraint 重载</span></p><p><span>① 父/子 </span><font color="blue"><span>对象直接调用</span></font><span>，无论有/无</span><code>virtual</code><span>，都执行自己的 任务、函数、属性、约束</span>
<span>② </span><font color="blue"><span>对象传参（子类对象+父类句柄）</span></font><span> ，子类 </span><font color="red"><span>被隐式地转换成了父类型</span></font><span>, 所以没有</span><code>virtual</code><span>，会执行</span><font color="blue"><span>父类的 任务/函数/属性</span></font><span>，</span><font color="red"><span>约束除外</span></font>
<span>③ 其实关于第2点，</span><font color="red"><span>会一直上升到基类</span></font><span>，比如UVM不必理会它们具体是什么类型，统一将它们当作</span><code>uvm_component</code><span>来对待，这极大方便了管理。</span>
<a name="Ctrl跳转15"><span>重载汇总表</span></a></p></li></ul><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-factory机制-类的重载.jpg" referrerpolicy="no-referrer"></p><ul><li><p><span>任务、函数、属性的重载</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""类的重载：任务、函数、属性测试代码""""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《父类<span class="cm-variable">bird</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">bird</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">int</span> <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">kk</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">rand</span> <span class="cm-keyword">int</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-variable">cnt</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">//@@ 属性</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">new</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">kk</span> <span class="cm-meta">=</span> <span class="cm-number">33</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 虚函数 &amp; 函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">vf</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"I am a bird, it's  vf"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">f</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"I am a bird, it's  f"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 虚任务 &amp; 任务</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">vt</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">#1</span><span class="cm-variable">ns</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"I am a bird, it's vt"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">t</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">#1</span><span class="cm-variable">ns</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"I am a bird, it's  t"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@  约束</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">constraint</span> <span class="cm-variable">cnt_cons</span><span class="cm-bracket">{</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">cnt</span> <span class="cm-keyword">dist</span> <span class="cm-bracket">{</span><span class="cm-number">77</span> :<span class="cm-meta">=</span> <span class="cm-number">1</span>, <span class="cm-number">88</span> :<span class="cm-meta">=</span> <span class="cm-number">0</span><span class="cm-bracket">}</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-bracket">}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《子类<span class="cm-variable">parrot</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">parrot</span> <span class="cm-keyword">extends</span> <span class="cm-variable">bird</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"> &nbsp; <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-comment">//int<span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span> kk; &nbsp; &nbsp; &nbsp; &nbsp;  //@@【注意！！！】这里声明 / 不声明，对【对象传参】结果有影响！！！</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">int</span>  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">cnt</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">//@@ 属性</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">new</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">kk</span> <span class="cm-meta">=</span> <span class="cm-number">44</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 虚函数 &amp; 函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">vf</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"I am a parrot, it's vf"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">f</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"I am a parrot, it's f"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">//@@ 虚任务 &amp; 任务</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">vt</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">#1</span><span class="cm-variable">ns</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"I am a parrot, it's vt"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> &nbsp;<span class="cm-variable">t</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">#1</span><span class="cm-variable">ns</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"I am a parrot, it's  t"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@  约束</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">constraint</span> <span class="cm-variable">cnt_cons</span><span class="cm-bracket">{</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">cnt</span> <span class="cm-keyword">dist</span> <span class="cm-bracket">{</span><span class="cm-number">77</span> :<span class="cm-meta">=</span> <span class="cm-number">0</span>, <span class="cm-number">88</span> :<span class="cm-meta">=</span> <span class="cm-number">1</span><span class="cm-bracket">}</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-bracket">}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">test</span> <span class="cm-keyword">case</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">module</span> <span class="cm-variable">test</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 属性</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">print_prop</span><span class="cm-bracket">(</span><span class="cm-variable">bird</span> <span class="cm-variable">b_ptr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-variable">b_ptr</span>.<span class="cm-variable">kk</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">print_vff</span><span class="cm-bracket">(</span><span class="cm-variable">bird</span> <span class="cm-variable">b_ptr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">b_ptr</span>.<span class="cm-variable">vf</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">b_ptr</span>.<span class="cm-variable">f</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 任务</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">print_vtt</span><span class="cm-bracket">(</span><span class="cm-variable">bird</span> <span class="cm-variable">b_ptr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">#1</span><span class="cm-variable">ns</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">b_ptr</span>.<span class="cm-variable">vt</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">b_ptr</span>.<span class="cm-variable">t</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 约束</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">print_cons</span><span class="cm-bracket">(</span><span class="cm-variable">bird</span> <span class="cm-variable">b_ptr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//b_ptr.rand_mode(0); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //@@ 重新开一次 对结果没啥影响 &nbsp; </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//b_ptr.rand_mode(1); &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">assert</span> <span class="cm-bracket">(</span><span class="cm-variable">b_ptr</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">())</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-variable">b_ptr</span>.<span class="cm-variable">cnt</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">initial</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">bird</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">bird_inst</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">parrot</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">parrot_inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">bird_inst</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">parrot_inst</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"============start================"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 虚函数&amp;函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"============vf&amp;f============"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"【直接调用】"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">bird_inst</span>.<span class="cm-variable">vf</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">bird_inst</span>.<span class="cm-variable">f</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">parrot_inst</span>.<span class="cm-variable">vf</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">parrot_inst</span>.<span class="cm-variable">f</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"【对象传参】"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">print_vff</span><span class="cm-bracket">(</span><span class="cm-variable">bird_inst</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">print_vff</span><span class="cm-bracket">(</span><span class="cm-variable">parrot_inst</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ 对象传参-没有virtual，会调用父类的func.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"============vt&amp;t============"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"【直接调用】"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">bird_inst</span>.<span class="cm-variable">vt</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">bird_inst</span>.<span class="cm-variable">t</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">parrot_inst</span>.<span class="cm-variable">vt</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">parrot_inst</span>.<span class="cm-variable">t</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"【对象传参】"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">print_vtt</span><span class="cm-bracket">(</span><span class="cm-variable">bird_inst</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">print_vtt</span><span class="cm-bracket">(</span><span class="cm-variable">parrot_inst</span><span class="cm-bracket">)</span>; &nbsp;<span class="cm-comment">//@@ 同 func. 没有virtual,调用父类的task</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"============属性============"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"【直接调用】"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"it's bird's property:"</span>,<span class="cm-variable">bird_inst</span>.<span class="cm-variable">kk</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"it's<span class="cm-tab" role="presentation" cm-text="	">  </span> parrot's property:"</span>,<span class="cm-variable">parrot_inst</span>.<span class="cm-variable">kk</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"【对象传参】"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">print_prop</span><span class="cm-bracket">(</span><span class="cm-variable">bird_inst</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">print_prop</span><span class="cm-bracket">(</span><span class="cm-variable">parrot_inst</span><span class="cm-bracket">)</span>; <span class="cm-comment">//@@ 【注意！！！】parrot中若声明int kk; 则输出父类的33，否则输出自己的44</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"============约束============"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"【直接调用】"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">assert</span> <span class="cm-bracket">(</span><span class="cm-variable">bird_inst</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">())</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"it's bird's constraint:"</span>,<span class="cm-variable">bird_inst</span>.<span class="cm-variable">cnt</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">assert</span> <span class="cm-bracket">(</span><span class="cm-variable">parrot_inst</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">())</span>; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"it's parrot's constraint:"</span>,<span class="cm-variable">parrot_inst</span>.<span class="cm-variable">cnt</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"【对象传参】"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">print_cons</span><span class="cm-bracket">(</span><span class="cm-variable">bird_inst</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">print_cons</span><span class="cm-bracket">(</span><span class="cm-variable">parrot_inst</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 【注意！！！】会约束失效</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"============finish================"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endmodule</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/*【输出】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">============start================</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">============vf&amp;f============</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">【直接调用】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">I am a bird, it's  vf</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">I am a bird, it's  f</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">I am a parrot, it's vf</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">I am a parrot, it's f</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">【对象传参】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">I am a bird, it's  vf</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">I am a bird, it's  f</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">I am a parrot, it's vf</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">I am a bird, it's  f</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">============vt&amp;t============</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">【直接调用】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">I am a bird, it's vt</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">I am a bird, it's  t</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">I am a parrot, it's vt</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">I am a parrot, it's  t</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">【对象传参】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">I am a bird, it's vt</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">I am a bird, it's  t</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">I am a parrot, it's vt</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">I am a bird, it's  t</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">============属性============</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">【直接调用】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">it's bird's property: &nbsp; &nbsp; &nbsp; &nbsp; 33</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">it's parrot's property: &nbsp; &nbsp; &nbsp; &nbsp; 44</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">【对象传参】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">33</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">44 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //@@ 变量不声明:自己 &nbsp; &nbsp; 声明：父类</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">============约束============</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">【直接调用】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">it's bird's constraint: &nbsp; &nbsp; &nbsp; &nbsp; 77</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">it's parrot's constraint: &nbsp; &nbsp; &nbsp; &nbsp; 88</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">【对象传参】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">77</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">1143679858 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //@@ 失效</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">============finish================</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">*/</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 4435px;"></div><div class="CodeMirror-gutters" style="display: none; height: 4435px;"></div></div></div></pre><p>&nbsp;</p></li></ul><h4><a name="8283-factory-重载" class="md-header-anchor"></a><span>8.2~8.3 factory 重载</span></h4><ul><li><p><span>8.2.1~8.2.4 factory 重载</span></p><ul><li><p><span>实现效果</span></p><p><font color="blue"><span>子类对象</span></font><span>，按照 </span><font color="blue"><span>父类型句柄</span></font><span> 传参，调用 </span><font color="blue"><span>virtual 任务/函数</span></font><span>，实现的是 </span><font color="blue"><span>子类的</span></font><span> 任务/函数。</span><a href="file:///E:/Disc/%E3%80%901%E3%80%91~~%E5%B8%B8%E7%94%A8~~/%E3%80%90D-%E5%99%A8%E3%80%91%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E3%80%81%E5%B7%A5%E5%85%B7/10%20Verilog+SV+UVM+EDA+Makefile/UVM.html#Ctrl%E8%B7%B3%E8%BD%AC15"><span>具体参见上表</span></a></p></li><li><p><span>前提条件</span></p><p><span>①  无论是重载的类（parrot）还是被重载的类（bird），都要在定义时  </span><font color="blue"><span>注册到factory机制</span></font><span> 中</span>
<span>②  被重载的类（bird）在实例化时，要使用factory机制式的实例化方式（</span><code>类名::type_id::create(“对象名”)</code><span>），</span><font color="red"><span>而不能使用传统的new方式</span></font>
<span>③  重载的类（parrot）必须   </span><font color="blue"><span>派生自</span></font><span> 被重载的类（bird） </span>
<span>最合理的描述是：放眼全部代码，</span><font color="red"><span>最初被重载的类</span></font><span>  必须和  </span><font color="red"><span> 最终重载的类</span></font><span> 是 </span><font color="red"><span>父-子</span></font><span>  关系</span>
<span>④  </span><code>component</code><span> 与 </span><code>object</code><span> 之间互相不能重载</span></p></li></ul></li><li><p><span>重载步骤：</span></p><p><span>①  </span><code>factory</code><span> 组件注册</span>
<span>②  重载函数 </span><code>set_xxx_override_xxx</code>
<span>③  组件例化  </span><code>类名::type_id::create(“对象名”)</code></p></li></ul><p><span>  </span></p><ul><li><p><span>重载的方式</span></p><ul><li><p><code>set_type_override</code></p><p><span>——按 类型 （全部）重载</span></p><p><span>——常用： </span><code>set_type_override_by_type</code><span>（</span><font color="blue"><span>被重载的类</span></font><span>，</span><font color="blue"><span>  重载的类</span></font><span>，replace=1）</span></p><p><span>					</span><code>replace</code><span>表示是否可以被后面的重载覆盖，1 允许， 0  不允许。</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><font color="red"><span>set_type_override</span></font><span> ("bird", "parrot");</span></td><td><span>将</span><code>bird类型</code><span>重载为 </span><code>parrot类型</code></td></tr><tr><td><font color="red"><span>set_type_override_by_type</span></font><span> (bird::</span><font color="blue"><span>get_type()</span></font><span>,  parrot::</span><font color="blue"><span>get_type()</span></font><span>,replace=1);</span></td><td><span>将</span><code>bird类型</code><span>重载为 </span><code>parrot类型</code></td></tr><tr><td><font color="red"><span>set_type_override_by_name</span></font><span> ("bird", "parrot",replace=1);</span></td><td><span>将</span><code>bird类型</code><span>重载为 </span><code>parrot类型</code></td></tr><tr><td><font color="blue"><span>xxx::get_type() </span></font><span>为  </span><font color="blue"><span>uvm_object_wrapper型</span></font><span> 的类型参数 ,也可以直接用  字符串</span></td><td>&nbsp;</td></tr></tbody></table></figure><p>&nbsp;</p></li><li><p><code>set_inst_override</code></p><p><span>——按 对象 （部分）重载 </span><br><span>——常用：</span><code>set_inst_override_by_type</code><span>（ </span><font color="blue"><span>被重载的类</span></font><span>，</span><font color="blue"><span>  重载的类</span></font><span>，</span><font color="red"><span>实例的路径</span></font><span>）</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><font color="red"><span>set_inst_override</span></font><span> ("env.o_agt.mon", "my_monitor", "new_monitor");</span></td><td><span>将 </span><code>env.o_agt.mon</code><span>路径的 </span><code>my_monitor类型</code><span> 重载 为 </span><code>new_monitor 类型</code></td></tr><tr><td><font color="red"><span>set_inst_override_by_type</span></font><span> (my_monitor::</span><font color="blue"><span>get_type()</span></font><span>, new_monitor::</span><font color="blue"><span>get_type()</span></font><span>，"env.o_agt.mon");</span></td><td><span>将 </span><code>env.o_agt.mon</code><span>路径的 </span><code>my_monitor类型</code><span> 重载 为 </span><code>new_monitor 类型</code></td></tr><tr><td><font color="red"><span>set_inst_override_by_name</span></font><span> ("my_monitor", "new_monitor"，"env.o_agt.mon");</span></td><td><span>将 </span><code>env.o_agt.mon</code><span>路径的 </span><code>my_monitor类型</code><span> 重载 为 </span><code>new_monitor 类型</code></td></tr><tr><td><font color="blue"><span>xxx::get_type() </span></font><span>为  </span><font color="blue"><span>uvm_object_wrapper型</span></font><span> 的类型参数 ,也可以直接用  字符串</span></td><td>&nbsp;</td></tr></tbody></table></figure></li></ul><p>&nbsp;</p></li><li><p><span>重载的使用</span></p><ul><li><p><span>tb中使用</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"""tb中直接使用"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">initial</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">factory</span>.<span class="cm-variable">set_type_override_by_type</span><span class="cm-bracket">(</span><span class="cm-variable">bird</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">()</span>, <span class="cm-variable">parrot</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">end</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>compoent类中使用</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"""component中使用"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">factory</span>.<span class="cm-variable">set_type_override_by_type</span><span class="cm-bracket">(</span><span class="cm-variable">bird</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">()</span>, <span class="cm-variable">parrot</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">())</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li><li><p><span>复杂的重载</span></p><ul><li><p><span>连续重载</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"""爷爷 &lt;== 父亲 &lt;== 孙子"""</span> </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"""【最终实现】爷爷 &lt;== 孙子"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">set_type_override_by_type</span><span class="cm-bracket">(</span><span class="cm-variable">bird</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">()</span>, <span class="cm-variable">parrot</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">set_type_override_by_type</span><span class="cm-bracket">(</span><span class="cm-variable">parrot</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">()</span>, <span class="cm-variable">sub_parrot</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">())</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>替换重载</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">""" 爷爷 &lt;== 父亲 """</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">""" 爷爷 &lt;== 叔叔 """</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"""【最终实现】爷爷 &lt;== 叔叔"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">set_type_override_by_type</span><span class="cm-bracket">(</span><span class="cm-variable">bird</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">()</span>, <span class="cm-variable">parrot</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">set_type_override_by_type</span><span class="cm-bracket">(</span><span class="cm-variable">bird</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">()</span>, <span class="cm-variable">sparrow</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">())</span>; </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 112px;"></div><div class="CodeMirror-gutters" style="display: none; height: 112px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>”叔侄重载“</span></p><p><font color="blue"><span>最终重载的类</span></font><span>  要与   </span><font color="blue"><span>最初被重载的类 </span></font><span> 有 派生关系（父子关系）</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">""" 爷爷 &lt;== 父亲 """</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">""" 父亲 &lt;== 叔叔 """</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"""【最终实现】爷爷 &lt;== 叔叔"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">set_type_override_by_type</span><span class="cm-bracket">(</span><span class="cm-variable">bird</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">()</span>, <span class="cm-variable">parrot</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">())</span>; <span class="cm-variable">set_type_override_by_type</span><span class="cm-bracket">(</span><span class="cm-variable">parrot</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">()</span>, <span class="cm-variable">sparrow</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">()</span>, <span class="cm-number">0</span><span class="cm-bracket">)</span>; </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 112px;"></div><div class="CodeMirror-gutters" style="display: none; height: 112px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li><li><p><span>factory 重载机制的调试</span></p><p><span>四类方法：</span>
<span>① 方法一：</span><code>build_phase</code><span> 之后，</span><code>uvm_component</code><span>的 </span><font color="blue"><code>print_override_info</code><span>函数</span></font>
<span>② 方法二：</span><code>uvm_factory</code><span>的 </span><font color="blue"><code>debug_create_by_name函数</code></font><span> 或是 </span><font color="blue"><code>debug_create_by_type函数</code></font>
<span>③ 方法三：</span><code>uvm_factory</code><span> 的 </span><font color="blue"><code>print 函数</code></font>
<span>④ 方法四：</span><code>build_phase</code><span> 之后，调用</span><code>uvm_root</code><span> 的 </span><font color="blue"><code>print_topology函数</code><span> </span></font></p><ul><li><p><code>print_override_info</code><span>函数</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>组件. print_</span><font color="red"><span>override_info</span></font><span>（原类型）</span></td><td><span>查询 原类型被override的情况</span></td></tr><tr><td>&nbsp;</td><td><font color="blue"><span>在 test_case 的 connect 中调用（</span><code>build_phase</code><span> 之后）</span></font></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""case 的 connect_phase 中 调用 组件的`print_override_info`函数 """</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env</span>.<span class="cm-variable">o_agt</span>.<span class="cm-variable">mon</span>.<span class="cm-variable">print_override_info</span><span class="cm-bracket">(</span><span class="cm-string">"my_monitor"</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 112px;"></div><div class="CodeMirror-gutters" style="display: none; height: 112px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><code>debug_create_by_name</code><span>函数、  </span><code>debug_create_by_type</code><span>函数</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>factory. debug_</span><font color="red"><span>create</span></font><span>_</span><span>by_type(类型， 路径);</span></td><td><span>按组件类型查询bug，顺带可以override调试</span></td></tr><tr><td><span>factory. debug_create_by_name(类名称，路径);</span></td><td><span>按组件名称查询bug，顺带可以override调试</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""debug_create_by_type示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">factory</span>.<span class="cm-variable">debug_create_by_type</span><span class="cm-bracket">(</span><span class="cm-variable">my_monitor</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">()</span>, <span class="cm-string">"uvm_test_top.env.o_agt. mon"</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><code>uvm_factory</code><span> 的 </span><code>print</code><span> 函数</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>print (int all_types=1)</span></td><td><span>打印工厂信息</span></td></tr><tr><td><font color="blue"><span>参数说明</span></font></td><td><font color="red"><span>print(0)&nbsp; &nbsp; &nbsp;打印被重载的实例和类型</span></font><br><span>print(1)   ... + 所有用户创建的、注册到factory的类的名称</span><br><span>print(2)   ... + 所有用户... + 系统创建的、所有注册到factory的类的名称（如uvm_reg_item）</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""factory.print示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">factory</span>.<span class="cm-variable">print</span><span class="cm-bracket">(</span><span class="cm-number">0</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><code>build_phase</code><span> 之后，调用</span><code>uvm_root</code><span> 的 </span><code>print_topology</code><span> 函数 </span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>uvm_top. print_topology();</span></td><td><span>打印当前uvm的拓扑图</span></td></tr><tr><td>&nbsp;</td><td><font color="blue"><span>top调用，build_phase之后调用</span></font></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""print_topology 示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_top</span>.<span class="cm-variable">print_topology</span><span class="cm-bracket">()</span>; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span> </span><span>	</span></p></li></ul></li></ul><p>&nbsp;</p><p>&nbsp;</p><ul><li><span>8.3.1~8.3.4  factory重载的应用</span></li></ul><h5><a name="◻-重载tr" class="md-header-anchor"></a><span>◻ 重载tr</span></h5><ul><li><p><span>应用场景：生产异常的测试用例（CRC 错误）</span></p></li><li><p><span>步骤：</span>
<span>① 创建 crc 类</span>
<span>②</span><code>case</code><span> 的 </span><code>build_phase</code><span>中将 </span><code>my_transaction</code><span> 重载为 </span><code>crc_tr</code></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""factory重载应用之——tr重载"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">crc</span>错误的<span class="cm-variable">tr</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">crc_err_tr</span> <span class="cm-keyword">extends</span> <span class="cm-variable">my_transaction</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">constraint</span> <span class="cm-variable">crc_err_cons</span><span class="cm-bracket">{</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">crc_err</span> <span class="cm-meta">==</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-bracket">}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-keyword">case</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 重载override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">factory</span>.<span class="cm-variable">set_type_override_by_type</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">()</span>, <span class="cm-variable">crc_err_tr</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">())</span>; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 设置为default seq</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_object_wrapper</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"env.i_agt.sqr.main_phase"</span>, &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//sqr的main_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"default_sequence"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">normal_sequence</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">get</span><span class="cm-bracket">())</span>; &nbsp; <span class="cm-comment">//例化方式</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 448px;"></div><div class="CodeMirror-gutters" style="display: none; height: 448px;"></div></div></div></pre><p>&nbsp;</p></li></ul><h5><a name="◻-重载seq" class="md-header-anchor"></a><span>◻ 重载seq</span></h5><ul><li><p><span>应用场景：生产异常的测试用例（已有</span><code>normal seq</code><span>，新添 </span><code>abnormal seq</code><span>）</span></p></li><li><p><span>步骤：</span>
<span>① 创建 abnormal seq</span>
<span>② </span><code>case</code><span> 的 </span><code>build_phase</code><span>中将</span><code>normal seq</code><span>重载为  </span><code>abnormal seq</code></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""factory重载应用之——seq重载"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ case_sequence 为default_sequence ，嵌套了 normal seq</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">normal_sequence</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">normal_sequence</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">m_trans</span>.<span class="cm-variable">print</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_object_utils</span><span class="cm-bracket">(</span><span class="cm-variable">normal_sequence</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">case_sequence</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">case_sequence</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">normal_sequence</span> <span class="cm-variable">nseq</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">repeat</span><span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do</span><span class="cm-bracket">(</span><span class="cm-variable">nseq</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ setp1：引入abnormal seq</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">abnormal</span> <span class="cm-variable">seq</span> 代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">abnormal_sequence</span> <span class="cm-keyword">extends</span> <span class="cm-variable">normal_sequence</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">m_trans</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"m_trans"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">m_trans</span>.<span class="cm-variable">crc_err_cons</span>.<span class="cm-variable">constraint_mode</span><span class="cm-bracket">(</span><span class="cm-number">0</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">// 先关闭约束</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_rand_send_with</span><span class="cm-bracket">(</span><span class="cm-variable">m_trans</span>, <span class="cm-bracket">{</span><span class="cm-variable">crc_err</span> <span class="cm-meta">==</span> <span class="cm-number">1</span>;<span class="cm-bracket">})</span> &nbsp; &nbsp; <span class="cm-comment">// 重新给约束</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">m_trans</span>.<span class="cm-variable">print</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@  step2：修改case build_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-keyword">case</span>的<span class="cm-variable">build_phase</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">factory</span>.<span class="cm-variable">set_type_override_by_type</span><span class="cm-bracket">(</span><span class="cm-variable">normal_sequence</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">()</span>, <span class="cm-variable">abnorma</span> <span class="cm-variable">l_sequence</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">())</span>; <span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_object_wrapper</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"env.i_agt.sqr.main_phase"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"default_sequence"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">case_sequence</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">get</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1053px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1053px;"></div></div></div></pre><p>&nbsp;</p></li></ul><h5><a name="◻-重载component不推荐" class="md-header-anchor"></a><span>◻ 重载component【不推荐】</span></h5><ul><li><p><span>应用场景：生产异常的测试用例（重载 </span><code>driver</code><span>、</span><code>scoreboard</code><span>、</span><code>ReferenceModle</code><span>）</span></p><ul><li><p><span>关于重载driver</span></p><p><span>只使用factory机制实现测试用例可能吗？答案确实是可能的。当 </span><font color="blue"><span>不用sequence&nbsp;</span></font><span>时，那么要在driver中控制发送包的种类、数量，对于objection的控制又要从sequence中回到driver中。</span><font color="red"><span>&lt;不推荐：将所有的测试用例都使用driver重载实现&gt;</span></font></p></li><li><p><span>重载ReferenceModle</span></p><p><span>如果将所有的异常情况都用一个参考模型实现，那么这个参考模型代码量将会非常大。 将其分散为数十个参考模型，每一个处理一种异常情况，当建立相应异常的测试用例时，将正常的参考模型由它替换掉。这样，可使代码清晰，并增加了可读性。</span></p></li></ul><p>&nbsp;</p></li><li><p><span>步骤：</span>
<span>① 创建 异常 driver</span>
<span>② </span><code>case</code><span> 的 </span><code>build_phase</code><span>中 将</span><code>my_driver</code><span>  重载为  </span><code>crc_driver</code></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""factory重载应用之——compoent重载 driver示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">crc_driver</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">crc_driver</span> <span class="cm-keyword">extends</span> <span class="cm-variable">my_driver</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">inject_crc_err</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">tr</span>.<span class="cm-variable">crc</span> <span class="cm-meta">=</span> <span class="cm-meta">$urandom_range</span><span class="cm-bracket">(</span><span class="cm-number">10000000</span>, <span class="cm-number">0</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">vif</span>.<span class="cm-variable">data</span> &lt;<span class="cm-meta">=</span> <span class="cm-number">8'b0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">vif</span>.<span class="cm-variable">valid</span> &lt;<span class="cm-meta">=</span> <span class="cm-number">1'b0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-meta">!</span><span class="cm-variable">vif</span>.<span class="cm-variable">rst_n</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>@<span class="cm-bracket">(</span><span class="cm-keyword">posedge</span> <span class="cm-variable">vif</span>.<span class="cm-variable">clk</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq_item_port</span>.<span class="cm-variable">get_next_item</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">// 获得tr</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">inject_crc_err</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">// 随机化tr</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">drive_one_pkt</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 驱动tr</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq_item_port</span>.<span class="cm-variable">item_done</span><span class="cm-bracket">()</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">// 结束</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-keyword">case</span>的<span class="cm-variable">build_phase</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 重载</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">factory</span>.<span class="cm-variable">set_type_override_by_type</span><span class="cm-bracket">(</span><span class="cm-variable">my_driver</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">()</span>, <span class="cm-variable">crc_driver</span>::<span class="cm-variable">g</span> <span class="cm-variable">et_type</span><span class="cm-bracket">())</span>; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_object_wrapper</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"env.i_agt.sqr.main_phase"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"default_sequence"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">normal_sequence</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">get</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 739px;"></div><div class="CodeMirror-gutters" style="display: none; height: 739px;"></div></div></div></pre><p>&nbsp;</p></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h4><a name="84--factory原理" class="md-header-anchor"></a><span>8.4  factory原理</span></h4><p><span>——创建实例、重载class</span></p><ul><li><p><span>8.4.1~8.4.2  创建一个类的实例的方法</span></p><p><span>3种：</span>
<span>① 简单类直接例化</span>
<span>② 参数化的类（类参数化传递）间接例化</span>
<span>③ factory机制 </span><font color="blue"><span>根据字符串&nbsp;</span></font><span>创建类的实例</span></p><ul><li><p><span>简单类直接例化</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""简单类直接例化-示例：在B中直接例化A"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">A</span>类代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">A</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">… </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">B</span>类代码》在<span class="cm-variable">B</span>中直接例化<span class="cm-variable">A</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">B</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">A</span> <span class="cm-variable">a</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">function</span> <span class="cm-keyword">new</span><span class="cm-bracket">()</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">a</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span> &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 291px;"></div><div class="CodeMirror-gutters" style="display: none; height: 291px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>参数化的类（类参数化传递）间接例化</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""参数化的类（类参数化传递）间接例化-示例：在B中通过参数化方法类去例化A"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《参数化方法》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">parameterized_class</span> <span class="cm-def">#</span> <span class="cm-bracket">(</span><span class="cm-keyword">type</span> <span class="cm-variable">T</span><span class="cm-bracket">)</span> &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">T</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">t</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">new</span><span class="cm-bracket">()</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">t</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">A</span>类代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">A</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  … </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">B</span>类代码》在<span class="cm-variable">B</span>中通过参数化方法类去例化<span class="cm-variable">A</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">B</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">parameterized_classs</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">A</span><span class="cm-bracket">)</span><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp;<span class="cm-variable">pa</span>; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">new</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">pa</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">()</span>; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 470px;"></div><div class="CodeMirror-gutters" style="display: none; height: 470px;"></div></div></div></pre><p>&nbsp;</p><p>&nbsp;</p></li><li><p><span>factory机制</span><font color="blue"><span>根据字符串&nbsp;</span></font><span>创建类的实例       </span><font color="red"><span>&lt;内部 原理&gt;</span></font></p><ul><li><p><span>过程：  当要根据类名</span><code>“my_driver”</code><span>创建一个</span><code>my_driver</code><span>的实例时</span></p><p><span>① 先从</span><font color="red"><code>global_tab</code></font><span>中找到</span><code>“my_driver”</code><font color="blue"><span>索引对应的</span></font><span> </span><code>registry#（my_driver，“my_driver”）</code><font color="blue"><span>实例的指针</span></font><code>me_ptr</code><span>，</span></p><p><span>② 然后调用</span><code>me_ptr.inst=new（）函数</code><span>，最终返回 </span><code>me_ptr.inst</code><span>。</span></p></li><li><p><span>应用：</span></p><p><code>类名::type_id::create(“对象名”)</code></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""factory机制 根据字符串&nbsp;创建类的实例-示例："""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 内置一个《<span class="cm-variable">registry</span>类》登记类</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">registry</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">type</span> <span class="cm-variable">T</span><span class="cm-meta">=</span><span class="cm-variable">uvm_object</span>, <span class="cm-keyword">string</span> <span class="cm-variable">Tname</span><span class="cm-meta">=</span><span class="cm-string">""</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">T</span> <span class="cm-variable">inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">string</span> <span class="cm-variable">name</span> <span class="cm-meta">=</span> <span class="cm-variable">Tname</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 基本过程</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 【感觉像uvm源码】【可忽略，懂上面步骤原理即可】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-variable">uvm_component</span> <span class="cm-variable">create_component_by_name</span><span class="cm-bracket">(</span><span class="cm-keyword">string</span> <span class="cm-variable">name</span><span class="cm-bracket">)</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">registry</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_object</span>, <span class="cm-string">""</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">me_ptr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">me_ptr</span> <span class="cm-meta">=</span> <span class="cm-variable">global_tab</span><span class="cm-bracket">[</span><span class="cm-variable">name</span><span class="cm-bracket">]</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 先从global_tab 中找到“my_driver”索引对应的登记的实例的指针</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">me_ptr</span>.<span class="cm-variable">inst</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"uvm_test_top"</span>, <span class="cm-keyword">null</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">me_ptr</span>.<span class="cm-variable">inst</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 实际操作应用</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">A_inst</span> <span class="cm-meta">=</span> <span class="cm-variable">A</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span>“<span class="cm-variable">A_inst</span>”<span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 类名::type_id::create(“对象名”)</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 448px;"></div><div class="CodeMirror-gutters" style="display: none; height: 448px;"></div></div></div></pre><p>&nbsp;</p></li></ul><p>&nbsp;</p></li><li><p><span>factory创建实例接口         </span><font color="red"><span>&lt;外部 接口 &gt;</span></font></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>create_object_by_name</span></td><td><span>根据类名字创建一个object</span></td></tr><tr><td><span>create_object_by_type</span></td><td><span>根据类型创建一个object</span></td></tr><tr><td><span>create_component_by_name</span></td><td><span>根据类名创建一个component</span></td></tr><tr><td><span>create_component_by_type</span></td><td><span>根据类型创建一个component</span></td></tr><tr><td><font color="blue"><span>component底层</span></font></td><td><span>create_component 函数</span><br><span>uvm_component::create_component (string requested_type_name, </span><br><span>                                                                     string name)</span></td></tr></tbody></table></figure><p>&nbsp;</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""factory创建实例接口"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 方式一：根据类名字创建一个object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 【<span class="cm-variable">create_object_by_name</span>】 &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">factory</span>.<span class="cm-variable">create_object_by_name</span><span class="cm-bracket">(</span><span class="cm-string">"my_transaction"</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 方式二：根据类型创建一个object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 【<span class="cm-variable">create_object_by_type</span>】</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">factory</span>.<span class="cm-variable">create_object_by_type</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">()))</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 方式三：根据类名创建一个component</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 【<span class="cm-variable">create_component_by_name</span>】</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">factory</span>.<span class="cm-variable">create_component_by_name</span><span class="cm-bracket">(</span><span class="cm-string">"my_transaction"</span>, <span class="cm-variable">get_full_name</span><span class="cm-bracket">()</span>, <span class="cm-string">"scb"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">))</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 参数1：字符串类型的类名</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 参数2：父结点的全名</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 参数3：这个新的component起的名字</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 参数4：父结点的指针</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 在 一个component的 new或者build_phase中使用， 本质是 uvm_component的 create_component</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 方式四：根据类型创建一个component</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>【<span class="cm-variable">create_component_by_type</span>】</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">factory</span>.<span class="cm-variable">create_component_by_type</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span>::<span class="cm-variable">get_type</span><span class="cm-bracket">()</span>,<span class="cm-variable">get_full_name</span><span class="cm-bracket">()</span>, <span class="cm-string">"scb"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">))</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 参数1：类型</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 其他：同 create_component_by_name</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 560px;"></div><div class="CodeMirror-gutters" style="display: none; height: 560px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li></ul><p>&nbsp;</p><p>&nbsp;</p><h3><a name="ch-9代码重用性" class="md-header-anchor"></a><span>Ch. 9_代码重用性</span></h3><p><font color="red"><strong><span>要点总结</span></strong><span>：</span></font><font color="red"><span>callback机制</span></font></p><h4><a name="91--callback机制" class="md-header-anchor"></a><span>9.1  callback机制</span></h4><p><span>作用：</span>
<span>① 代码 的可重用性</span>
<span>② 构建异常的测试用例</span></p><ul><li><p><span>9.1.1~9.1.2  广义的callback</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""callback函数"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">post_randomize</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pre_body</span>、<span class="cm-variable">post_body</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pre_do</span>、<span class="cm-variable">mid_do</span>、<span class="cm-variable">post_do</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pre_tran</span> &nbsp; &nbsp;<span class="cm-comment">// 发送transaction之前，用户可能会针对transaction做某些动作</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// VIP（Verification Intellectual Property）中的接口</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 134px;"></div><div class="CodeMirror-gutters" style="display: none; height: 134px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>9.1.3~9.1.4  callback机制原理</span></p><ul><li><p><span>callback 开发者</span></p><p><span>① 定义一个</span><font color="blue"><code>新类 A</code><span> </span></font><span> </span>
<span>② 声明一个</span><font color="blue"><code>A_pool类池子</code></font><span> 专门存放 </span><font color="red"><code>A类</code></font><span> 及 </span><font color="red"><code>其派生类</code></font>
<span>③ 在 要预留</span><code>callback函数/任务</code><span>接口的</span><strong><span>类</span></strong><span>中（例如</span><font color="blue"><span>driver</span></font><span>）调用 </span><font color="red"><span> </span><code>`uvm_register_cb宏</code><span> </span></font><span>注册</span><code>cb</code>
<span>④ 在 要调用</span><code>callback函数/任务</code><span>接口的类的</span><strong><span>函数/任务</span></strong><span>中（例如 </span><font color="blue"><span>driver</span></font><span> 的 </span><font color="blue"><span>main_phase</span></font><span> 的 </span><font color="blue"><span>pre_tran</span></font><span>），使用</span><font color="red"><code>``uvm_do_callbacks</code></font><span> 宏</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>uvm_callback</span></td><td><span>uvm的callback基类</span></td></tr><tr><td><span>typedef uvm_callbacks#(my_driver, A)    A_pool;</span></td><td><span>A_pool的声明方法</span><br><span>参数1：池子被哪个类用（driver）</span><br><span>参数2：谁的pool</span></td></tr><tr><td><span>typedef class A;</span></td><td><span>my_driver中需要声明下</span></td></tr><tr><td><span>`uvm_register_cb(my_driver, A)</span></td><td><span>my_driver中需要注册登记下callback</span><br><span>参数1：池子被哪个类用（driver）</span><br><span>参数2：谁的pool</span><br><font color="red"><span>&lt;预留 cb函数/任务 的地方的类register&gt;</span></font></td></tr><tr><td><span>`</span><span>uvm_do_callbacks(my_driver, A, pre_tran(this,req))</span></td><td><code>my_driver</code><span>调用 </span><code>A类</code><span>的</span><code>A_pool</code><span>池子中所有实例去执行</span><code>pre_tran</code><br><span>参数1：调用</span><code>pre_tran</code><span>的类的名字</span><br><span>参数2：哪个类具有</span><code>pre_tran</code><br><span>参数3：调用的是函数/任务 </span><code>pre_tran</code><br><span>参数4：要顺便给出</span><code>pre_tran</code><span>的参数</span><br><font color="red"><span>&lt;用cb函数/任务 的地方的类do&gt;</span></font></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""cb开发者的工作【callback原理】：A类、A_pool、自动执行pre_tran"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">callback</span>.<span class="cm-variable">sv</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@  【uvm_callback】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">A</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_callback</span>; &nbsp; &nbsp; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">pre_tran</span><span class="cm-bracket">(</span><span class="cm-variable">my_driver</span> <span class="cm-variable">drv</span>, <span class="cm-keyword">ref</span> <span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ virtual为了后续重载</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">typedef</span> <span class="cm-variable">uvm_callbacks</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_driver</span>, <span class="cm-variable">A</span><span class="cm-bracket">)</span> <span class="cm-variable">A_pool</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ A_pool</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">my_driver</span>.<span class="cm-variable">sv</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">typedef</span> <span class="cm-keyword">class</span> <span class="cm-variable">A</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 声明A类是自定义的</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_driver</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_driver</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">my_driver</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_register_cb</span><span class="cm-bracket">(</span><span class="cm-variable">my_driver</span>, <span class="cm-variable">A</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 【核心】登记到callback机制中</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq_item_port</span>.<span class="cm-variable">get_next_item</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do_callbacks</span><span class="cm-bracket">(</span><span class="cm-variable">my_driver</span>, <span class="cm-variable">A</span>, <span class="cm-variable">pre_tran</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>, <span class="cm-variable">req</span><span class="cm-bracket">))</span> &nbsp;<span class="cm-comment">//@@ 【核心】遍历A_pool执行pre_tran任务</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">drive_one_pkt</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq_item_port</span>.<span class="cm-variable">item_done</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 694px;"></div><div class="CodeMirror-gutters" style="display: none; height: 694px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>callback 使用者</span></p><p><span>① 从</span><code>A类</code><span>派生一个</span><code>my_callback</code><span>类，在此类中定义好 </span><code>callback函数/任务</code><span>具体内容</span>
<span>② 在 </span><font color="blue"><span>测试用例</span></font><span> 的 </span><font color="blue"><code>connect_phase</code></font><span>中 将</span><code>my_callback</code><span>实例化，并将其加入</span><code>A_pool</code><span>中</span>
<font color="red"><span>PS：也可以是其他</span><code>phase</code><span>,  但是一定是在使用此</span><code>callback函数/任务的</code><span> phase之前</span></font></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>A_pool::add(env.i_agt.drv,    my_cb);</span></td><td><span>将实例化cb对象加入到池子</span><br><span>参数1：组件的绝对路径</span><br><span>参数2：cb对象</span></td></tr><tr><td><font color="blue"><span>补充说明</span></font></td><td><span>+组件driver的绝对路径 的原因是可能有多个</span><code>env</code><span>和</span><code>driver</code></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""cb使用者的工作：A类派生，加入A_pool"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">A</span>类的派生类的代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ my_callback 派生自 A类</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_callback</span> <span class="cm-keyword">extends</span> <span class="cm-variable">A</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 定义好 `callback函数/任务`具体内容</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">pre_tran</span><span class="cm-bracket">(</span><span class="cm-variable">my_driver</span> <span class="cm-variable">drv</span>, <span class="cm-keyword">ref</span> <span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"my_callback"</span>, <span class="cm-string">"this is pre_tran task"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_object_utils</span><span class="cm-bracket">(</span><span class="cm-variable">my_callback</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-keyword">case</span>的<span class="cm-variable">connect_phase</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">my_callback</span><span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">my_cb</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 声明cb句柄</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">my_cb</span> <span class="cm-meta">=</span> <span class="cm-variable">my_callback</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"my_cb"</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ 例化cb对象</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">A_pool</span>::<span class="cm-variable">add</span><span class="cm-bracket">(</span><span class="cm-variable">env</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">drv</span>, <span class="cm-variable">my_cb</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 将cb添加至A_pool</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 参数1：drv的绝对路径</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 参数2：cb对象</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 515px;"></div><div class="CodeMirror-gutters" style="display: none; height: 515px;"></div></div></div></pre></li></ul></li></ul><p>&nbsp;</p><h5><a name="◻-应用子类继承" class="md-header-anchor"></a><span>◻ 应用：子类继承</span></h5><ul><li><p><span>9.1.5  子类继承</span><code>callback</code><span>机制</span></p><ul><li><p><span>应用场景：产品迭代，测试用例复用</span></p></li><li><p><span>方法</span></p><p><span>① 将子类设置成超类，类型为父类类型；</span><font color="blue"><code>`uvm_set_super_type</code></font>
<span>② 在</span><font color="blue"><span>子类的</span><code>main_phase</code><span>中 </span></font><span>, 调用</span><font color="blue"><code>``uvm_do_callbacks</code></font>
<span>③ 在</span><font color="blue"><span> </span><code>agt</code><span> </span></font><span>的</span><font color="blue"><code>build_phase</code></font><span>中，例化 new_driver , </span><font color="red"><span>这样 case 代码就不用任何修改</span></font></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>`</span><span>uvm_set_super_type（&lt;type_name&gt;，&lt;sup_type_name&gt;）</span></td><td><span>将 “子类” 设置成超类，类型为“父类”</span><br><code>`uvm_set_super_type(子类, 父类)</code><span> </span><br><span>例如：`uvm_set_super_type(new_driver, my_driver)</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""子类继承`callback `机制"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@  使用方</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《新的<span class="cm-variable">driver</span>类 代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">new_driver</span> <span class="cm-keyword">extends</span> <span class="cm-variable">my_driver</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">new_driver</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_set_super_type</span><span class="cm-bracket">(</span><span class="cm-variable">new_driver</span>, <span class="cm-variable">my_driver</span><span class="cm-bracket">)</span> &nbsp; &nbsp; <span class="cm-comment">//@@ 将 new_driver设置为超类，类型为my_driver</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 子类的main_phase 中使用 `uvm_do_callbacks(父类)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">new_driver</span>::<span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">seq_item_port</span>.<span class="cm-variable">get_next_item</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"new_driver"</span>, <span class="cm-string">"this is new driver"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do_callbacks</span><span class="cm-bracket">(</span><span class="cm-variable">my_driver</span>, <span class="cm-variable">A</span>, <span class="cm-variable">pre_tran</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>, <span class="cm-variable">req</span><span class="cm-bracket">))</span> &nbsp; <span class="cm-comment">//@@ 注意此处是  父类my_driver，</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; <span class="cm-comment">//@@ 即，pre_tran是在父类中被预留接口的</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">drive_one_pkt</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">seq_item_port</span>.<span class="cm-variable">item_done</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">aget</span><span class="cm-meta">-</span><span class="cm-variable">build_phase</span>代码》例化<span class="cm-variable">new_driver</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_agent</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-bracket">(</span><span class="cm-variable">is_active</span> <span class="cm-meta">==</span> <span class="cm-variable">UVM_ACTIVE</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sqr</span> <span class="cm-meta">=</span> <span class="cm-variable">my_sequencer</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"sqr"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">drv</span> <span class="cm-meta">=</span> <span class="cm-variable">new_driver</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"drv"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化new_driver</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">mon</span> <span class="cm-meta">=</span> <span class="cm-variable">my_monitor</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"mon"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 650px;"></div><div class="CodeMirror-gutters" style="display: none; height: 650px;"></div></div></div></pre></li></ul></li></ul><p><span>    </span></p><h5><a name="◻-实现所有case不推荐" class="md-header-anchor"></a><span>◻ 实现所有case【不推荐】</span></h5><ul><li><p><span>9.1.6  使用</span><code>callback</code><span>函数/任务来实现所有的测试用例</span></p><ul><li><p><span>关系：</span></p><p><code>callback机制</code><span>、</span><code>sequence机制</code><span>和</span><code>factory机制</code><span>并不是互斥的，三者都能分别实现同一目的。当这三者互相结合时，又会产生许多新的解决问题的方式，提供了高扩展性</span></p></li><li><p><span>缺点：</span></p><p><code>virtual seq</code><span> 的协调功能在</span><code>callback机制</code><span>中就很难实现</span></p></li><li><p><span>方法：</span>
<span>① 示例中完全</span><font color="blue"><span>丢弃了</span><code>sequence机制</code></font><span>，在A类的</span><code>run</code><span>任务中进行控制</span><code>objection</code><span>，激励产生在</span><code>gen_tran</code><span>中。</span>
<span>② 在建立新的测试用例时，只需要从A派生一个类，并重载其</span><code>gen_tran</code><span>函数</span>
<span>③ 在这种情况下，</span><font color="red"><span>新建测试用例</span></font><span>  相当于</span><font color="blue"><span>重载gen_tran</span></font><span>。如果不满足要求，还可以将</span><font color="blue"><span>A类的</span><code>run</code><span>任务重载</span></font><span>。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""使用`callback`函数/任务来实现所有的测试用例-示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@  开发方</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">A</span>代码》用于构造 重载函数<span class="cm-variable">A_pool</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">A</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_callback</span>; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">my_transaction</span> <span class="cm-variable">tr</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">bit</span> <span class="cm-variable">gen_tran</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">run</span><span class="cm-bracket">(</span><span class="cm-variable">my_driver</span> <span class="cm-variable">drv</span>, <span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">phase</span>.<span class="cm-variable">raise_objection</span><span class="cm-bracket">(</span><span class="cm-variable">drv</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">drv</span>.<span class="cm-variable">vif</span>.<span class="cm-variable">data</span> &lt;<span class="cm-meta">=</span> <span class="cm-number">8'b0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">drv</span>.<span class="cm-variable">vif</span>.<span class="cm-variable">valid</span> &lt;<span class="cm-meta">=</span> <span class="cm-number">1'b0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-meta">!</span><span class="cm-variable">drv</span>.<span class="cm-variable">vif</span>.<span class="cm-variable">rst_n</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  @<span class="cm-bracket">(</span><span class="cm-keyword">posedge</span> <span class="cm-variable">drv</span>.<span class="cm-variable">vif</span>.<span class="cm-variable">clk</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-variable">gen_tran</span><span class="cm-bracket">())</span> <span class="cm-keyword">begin</span> &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">drv</span>.<span class="cm-variable">drive_one_pkt</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">phase</span>.<span class="cm-variable">drop_objection</span><span class="cm-bracket">(</span><span class="cm-variable">drv</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//typedef uvm_callbacks#(my_driver, A) &nbsp;  A_pool; &nbsp; &nbsp; &nbsp; //@@ A_pool</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">driver</span>代码》 在<span class="cm-variable">my_driver</span>的<span class="cm-variable">main_phase</span>中，去掉所有其他代码，只调用<span class="cm-variable">A</span>的<span class="cm-variable">run</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">typedef</span> <span class="cm-keyword">class</span> <span class="cm-variable">A</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 声明A类是自定义的</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_driver</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_driver</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">my_driver</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_register_cb</span><span class="cm-bracket">(</span><span class="cm-variable">my_driver</span>, <span class="cm-variable">A</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 【核心】登记到callback机制中</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do_callbacks</span><span class="cm-bracket">(</span><span class="cm-variable">my_driver</span>, <span class="cm-variable">A</span>, <span class="cm-variable">run</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>, <span class="cm-variable">phase</span><span class="cm-bracket">))</span> &nbsp;<span class="cm-comment">//@@ 【核心】遍历A_pool执行run任务</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 在my_driver的main_phase中，去掉所有其他代码，只调用A的run</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@  使用方 &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">A</span>子类代码》在建立新的测试用例时，只需要从<span class="cm-variable">A</span>派生一个类，并重载其<span class="cm-variable">gen_tran</span>函数：</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_callback</span> <span class="cm-keyword">extends</span> <span class="cm-variable">A</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">int</span> <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">pkt_num</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">bit</span> <span class="cm-variable">gen_tran</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"my_callback"</span>, <span class="cm-string">"gen_tran"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">pkt_num</span> &lt; <span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">tr</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"tr"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">tr</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">pkt_num</span><span class="cm-meta">++</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_object_utils</span><span class="cm-bracket">(</span><span class="cm-variable">my_callback</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 本质是factory机制的重载</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1344px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1344px;"></div></div></div></pre></li></ul></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h5><a name="◻-补充" class="md-header-anchor"></a><span>◻ 补充：</span></h5><p><span>——后门机制：</span>
<span>提前做好接口，在要用的时候，不用修改整个验证平台，也不用去修改其他代码，通过test case 实现某些功能的仿真</span>
<span>可以应用于：注入error，覆盖率收集、统计...</span></p><p><font color="red"><span>和</span><code>factory机制</code><span>类似，区别在于</span><code>callback机制</code><span>修改了函数，而</span><code>factory机制</code><span>把整个</span><code>class</code><span>替换掉了</span></font></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="apl"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="apl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""开发者"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">step1：在其他功能类（driver或是组件），嵌入宏方法，预先留好接口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">step2：空壳callback类，作为callback基类</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""使用者"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">step3：在写一个具体的test</span> <span class="cm-keyword">case前，做一个含有真正功能的callbacak子类</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">step4：在test</span> <span class="cm-keyword">case中</span> <span class="cm-keyword">运用真正的功能，用于仿真</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 134px;"></div><div class="CodeMirror-gutters" style="display: none; height: 134px;"></div></div></div></pre><p><img src="./UVM_files/SV&amp;UVM基础_UVMcallback机制1.jpg" referrerpolicy="no-referrer"></p><p><img src="./UVM_files/SV&amp;UVM基础_UVMcallback机制2.jpg" referrerpolicy="no-referrer"></p><p><img src="./UVM_files/SV&amp;UVM基础_UVMcallback机制3.jpg" referrerpolicy="no-referrer"></p><p><img src="./UVM_files/SV&amp;UVM基础_UVMcallback机制4.jpg" referrerpolicy="no-referrer"></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h4><a name="92--seq重用" class="md-header-anchor"></a><span>9.2  seq重用</span></h4><p><span>——小而美的</span><code>seq</code></p><p><span>① factory重载，封装成可重载的函数/任务或者类，尽量 </span><font color="blue"><span>避免代码的复制</span></font></p><p><span>② </span><font color="blue"><span>放弃 建造强大的通用的</span><code>seq</code><span> </span></font><span>的想法，维护是个灾难。强烈建议不要使用强大的</span><code>seq</code><span>。</span>
<span>      可以将一个强大的</span><code>seq</code><span>拆分成小的</span><code>seq</code><span>。</span><font color="blue"><span>尽量做到一看名字就知道这个</span><code>seq</code><span> 的用处</span></font></p><p><span>关于</span><font color="red"><strong><span>数据包</span></strong></font><span>的代码重用，</span><a href="file:///E:/Disc/%E3%80%901%E3%80%91~~%E5%B8%B8%E7%94%A8~~/%E3%80%90D-%E5%99%A8%E3%80%91%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E3%80%81%E5%B7%A5%E5%85%B7/10%20Verilog+SV+UVM+EDA+Makefile/UVM.html#Ctrl%E8%B7%B3%E8%BD%AC16"><span>参见 【10.2  seq 高阶】 </span></a></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h4><a name="93--参数化的类" class="md-header-anchor"></a><span>9.3  参数化的类</span></h4><p><span>为了</span><font color="blue"><span>增加代码的</span><strong><span>可重用性</span></strong></font><span>，参数化的类是一个很好的选择。</span></p><ul><li><p><span>9.3.1  参数化的类的必要性</span></p><p><span>有意义的、可行的 就设置,  例如：</span>
<span>①  </span><code>my_transaction</code><span>是没有任何必要定义成一个参数化的类的。</span>
<span>②  相反，一个总线</span><code>bus_transaction</code><span>可能需要定义成参数化的类，因为总线位宽可能是16位的、32位的或64位的。</span></p><p>&nbsp;</p></li><li><p><span>9.3.2 UVM对 </span><font color="red"><strong><span>参数化类</span></strong></font><span> 的支持</span></p><ul><li><p><span>factory机制</span></p><p><span>——支持参数化 注册 </span><code>object</code><span> / </span><code>component</code></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>`</span><span>uvm_object_param_utils</span></td><td><span>参数化的 </span><code>object</code><span> 注册</span></td></tr><tr><td><span>`</span><span>uvm_component_param_utils</span></td><td><span>参数化的 </span><code>component</code><span>注册</span></td></tr></tbody></table></figure><p>&nbsp;</p><p><span>factory机制在 </span><font color="red"><span>例化时</span></font><span>，不支持省略 默认参数</span><span>（</span><font color="blue"><span>声明</span></font><span>的时候，可以省略）</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""factory例化时，省略默认参数-示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">bus_agent</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span> <span class="cm-variable">ADDR_WIDTH</span><span class="cm-meta">=</span><span class="cm-number">16</span>, <span class="cm-keyword">int</span> <span class="cm-variable">DATA_WIDTH</span><span class="cm-meta">=</span><span class="cm-number">16</span><span class="cm-bracket">)</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_agent</span> ;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">bus_agent</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">bus_agt</span>; <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-comment">//@@ 声明的时候，可以省略  【参数化类】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">bus_agt</span> <span class="cm-meta">=</span> <span class="cm-variable">bus_agent</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-number">16</span>, <span class="cm-number">16</span><span class="cm-bracket">)</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"bus_agt"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;  <span class="cm-tab" role="presentation" cm-text="	">   </span> <span class="cm-comment">//@@ 例化的时候，不可以省略#(16, 16)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 157px;"></div><div class="CodeMirror-gutters" style="display: none; height: 157px;"></div></div></div></pre><p>&nbsp;</p></li></ul><p>&nbsp;</p><ul><li><p><span>SV:</span></p><p><span>——支持 参数化的 </span><code>interface</code></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""SV 支持参数化的 interface"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">interface</span> <span class="cm-variable">bus_if</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span> <span class="cm-variable">ADDR_WIDTH</span><span class="cm-meta">=</span><span class="cm-number">16</span>, <span class="cm-keyword">int</span> <span class="cm-variable">DATA_WIDTH</span><span class="cm-meta">=</span><span class="cm-number">16</span><span class="cm-bracket">)(</span><span class="cm-keyword">input</span> <span class="cm-variable">clk</span>, <span class="cm-keyword">input</span> <span class="cm-variable">rst_n</span><span class="cm-bracket">)</span>; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">logic</span> <span class="cm-variable">bus_cmd_valid</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">logic</span> <span class="cm-variable">bus_op</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">logic</span> <span class="cm-bracket">[</span><span class="cm-variable">ADDR_WIDTH</span> <span class="cm-number">1</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">bus_addr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">logic</span> <span class="cm-bracket">[</span><span class="cm-variable">DATA_WIDTH</span> <span class="cm-number">1</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">bus_wr_data</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">logic</span> <span class="cm-bracket">[</span><span class="cm-variable">DATA_WIDTH</span> <span class="cm-number">1</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">bus_rd_data</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endinterface</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 202px;"></div><div class="CodeMirror-gutters" style="display: none; height: 202px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>config_db机制：</span></p><p><span>—— 支持传递参数化的 </span><code>interface</code></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""config_db机制支持传递参数化的interface"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">virtual</span> <span class="cm-variable">bus_if</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-number">16</span>, <span class="cm-number">16</span><span class="cm-bracket">))</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">null</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"uvm_test_top.env.bus_agt.mon"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"vif"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">bif</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">virtual</span> <span class="cm-variable">bus_if</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">ADDR_WIDTH</span>, <span class="cm-variable">DATA_WIDTH</span><span class="cm-bracket">))</span>::<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">""</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"vif"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">vif</span><span class="cm-bracket">)</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 224px;"></div><div class="CodeMirror-gutters" style="display: none; height: 224px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>sequence机制：</span></p><p><span>——支持参数化的 </span><code>transaction</code><span>：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">bus_sequencer</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span> <span class="cm-variable">ADDR_WIDTH</span><span class="cm-meta">=</span><span class="cm-number">16</span>, <span class="cm-keyword">int</span> <span class="cm-variable">DATA_WIDTH</span><span class="cm-meta">=</span><span class="cm-number">16</span><span class="cm-bracket">)</span> <span class="cm-keyword">extends</span> </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_sequencer</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">bus_transaction</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">ADDR_WIDTH</span>, <span class="cm-variable">DATA_WIDTH</span><span class="cm-bracket">))</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h4><a name="94--模块级--芯片级-重用" class="md-header-anchor"></a><span>9.4  模块级 &amp; 芯片级 重用</span></h4><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-代码重用机制-模块级 &amp; 芯片级 重用.jpg" referrerpolicy="no-referrer"></p><h5><a name="◻-env重用" class="md-header-anchor"></a><span>◻ env重用</span></h5><ul><li><p><span>9.4.1 基于env的重用</span></p><p><span>① 模块级（block level，IP级别、unit级别）    【env的重用】</span>
<span>② 芯片级（SOC级别）</span></p><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-代码重用-env组件重用.jpg" referrerpolicy="no-referrer"></p><p>&nbsp;</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""上图agent重用的-代码"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">my_env</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_env</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_env</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">bit</span><span class="cm-tab" role="presentation" cm-text="	"> </span> <span class="cm-variable">in_chip</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_analysis_port</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">ap</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_analysis_export</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-variable">i_export</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// build_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-meta">!</span><span class="cm-variable">in_chip</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span> &nbsp; &nbsp; &nbsp; <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp;<span class="cm-comment">//@@ in_chip  用于标记  数据来源</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">i_agt</span> <span class="cm-meta">=</span> <span class="cm-variable">my_agent</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"i_agt"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">// 组件例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">i_agt</span>.<span class="cm-variable">is_active</span> <span class="cm-meta">=</span> <span class="cm-variable">UVM_ACTIVE</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 【核心】  is_active </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">in_chip</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">i_export</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"i_export"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">// 端口例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// connect_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ap</span> <span class="cm-meta">=</span> <span class="cm-variable">o_agt</span>.<span class="cm-variable">ap</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">in_chip</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">i_export</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">agt_mdl_fifo</span>.<span class="cm-variable">analysis_export</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">// 主动连接被动</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">i_agt</span>.<span class="cm-variable">ap</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">agt_mdl_fifo</span>.<span class="cm-variable">analysis_export</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ agent代码重用</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">chip_env</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">chip_env</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_env</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">chip_env</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_env</span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">env_A</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_env</span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">env_B</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_env</span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">env_C</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// build_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">env_A</span> <span class="cm-meta">=</span> <span class="cm-variable">my_env</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"env_A"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">env_B</span> <span class="cm-meta">=</span> <span class="cm-variable">my_env</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"env_B"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">env_B</span>.<span class="cm-variable">in_chip</span> <span class="cm-meta">=</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">env_C</span> <span class="cm-meta">=</span> <span class="cm-variable">my_env</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"env_C"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">env_C</span>.<span class="cm-variable">in_chip</span> <span class="cm-meta">=</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// connect_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">env_A</span>.<span class="cm-variable">ap</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">env_B</span>.<span class="cm-variable">i_export</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">env_B</span>.<span class="cm-variable">ap</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">env_C</span>.<span class="cm-variable">i_export</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1389px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1389px;"></div></div></div></pre><p>&nbsp;</p></li></ul><p><a name="Ctrl跳转20"><span>◻ 寄存器重用</span></a></p><ul><li><p><span>9.4.2 寄存器模型的重用</span></p><p><span>——寄存器配置总线 </span><code>bus_agt</code></p><p><font color="red"><span>寄存器（模块级）  == 演变 ==&gt;   寄存器（芯片级）</span></font><span>  </span></p><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-代码重用机制-寄存器模型的重用.jpg" referrerpolicy="no-referrer"></p><ul><li><p><font color="red"><strong><span>模块级</span></strong></font><span>别的  寄存器模型</span></p><p><span>——定义在模块的env中</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""模块级别的  寄存器模型：定义在模块的env中"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">reg_model</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//略</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">env</span>代码》中含有<span class="cm-variable">reg_model</span>的例化</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_env</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_env</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">reg_model</span><span class="cm-tab" role="presentation" cm-text="	">   </span> <span class="cm-variable">rm</span>; &nbsp; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_env</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">rm</span> <span class="cm-meta">=</span> <span class="cm-variable">reg_model</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"rm"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  … </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 314px;"></div><div class="CodeMirror-gutters" style="display: none; height: 314px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><font color="red"><strong><span>芯片级</span></strong></font><span>别的  寄存器模型</span></p><p><span>—— 为了在芯片级别使用寄存器模型，需要建立一个</span><font color="blue"><span>新的寄存器模型（reg_model）</span></font><span>：</span></p><p><span>① 加入各个不同模块的寄存器模型</span>
<span>② 并设置 </span><font color="blue"><strong><span>偏移地址</span></strong></font><span> 和 </span><font color="blue"><strong><span>后门访问路径</span></strong></font></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>uvm_reg_block</span></td><td><span>uvm寄存器模型 </span><strong><span>类</span></strong></td></tr><tr><td><span>create_map (&lt;参数1&gt;, &lt;参数2&gt;  , &lt;参数3&gt;,  &lt;参数4&gt; , &lt;参数5&gt; )</span></td><td><span>设置后门访问路径</span></td></tr><tr><td><font color="green"><span>xxx</span></font><span>. add_submap (&lt;参数1：参照地址&gt;, &lt;参数2：偏移量&gt;)</span></td><td><span>设置偏移地址</span></td></tr></tbody></table></figure><p>&nbsp;</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-string">"""芯片级别的  寄存器模型：新建reg_model，定义在模块的base_test /chip_env 中<span class="cm-tab" role="presentation" cm-text="	"> </span>"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《新的<span class="cm-variable">reg_model</span>》统筹调度作用</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">chip_reg_model</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_reg_block</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ uvm_reg_block</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">rand</span> <span class="cm-variable">reg_model</span> <span class="cm-tab" role="presentation" cm-text="	"> </span> <span class="cm-variable">A_rm</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-variable">reg_model</span><span class="cm-tab" role="presentation" cm-text="	">  </span> <span class="cm-variable">B_rm</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-variable">reg_model</span><span class="cm-tab" role="presentation" cm-text="	">  </span> <span class="cm-variable">C_rm</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">default_map</span> <span class="cm-meta">=</span> <span class="cm-variable">create_map</span><span class="cm-bracket">(</span><span class="cm-string">"default_map"</span>, <span class="cm-number">0</span>, <span class="cm-number">2</span>, <span class="cm-variable">UVM_BIG_ENDIAN</span>, <span class="cm-number">0</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 设置后门访问路径</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">default_map</span>.<span class="cm-variable">add_submap</span><span class="cm-bracket">(</span><span class="cm-variable">A_rm</span>.<span class="cm-variable">default_map</span>, <span class="cm-number">16'h0</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ 设置偏移地址</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">default_map</span>.<span class="cm-variable">add_submap</span><span class="cm-bracket">(</span><span class="cm-variable">B_rm</span>.<span class="cm-variable">default_map</span>, <span class="cm-number">16'h4000</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">default_map</span>.<span class="cm-variable">add_submap</span><span class="cm-bracket">(</span><span class="cm-variable">C_rm</span>.<span class="cm-variable">default_map</span>, <span class="cm-number">16'h8000</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">chip_env</span>代码》最大的环境，例化此寄存器模型，并将各个模块的寄存器模型的指针赋值给各个<span class="cm-variable">env</span>的<span class="cm-variable">p_rm</span>：</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">chip_env</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// A组件的 env</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env_A</span> <span class="cm-meta">=</span> <span class="cm-variable">my_env</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"env_A"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// B组件的 env</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env_B</span> <span class="cm-meta">=</span> <span class="cm-variable">my_env</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"env_B"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env_B</span>.<span class="cm-variable">in_chip</span> <span class="cm-meta">=</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// C组件的 env</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env_C</span> <span class="cm-meta">=</span> <span class="cm-variable">my_env</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"env_C"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env_C</span>.<span class="cm-variable">in_chip</span> <span class="cm-meta">=</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 总线bus_agt</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">bus_agt</span> <span class="cm-meta">=</span> <span class="cm-variable">bus_agent</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"bus_agt"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">bus_agt</span>.<span class="cm-variable">is_active</span> <span class="cm-meta">=</span> <span class="cm-variable">UVM_ACTIVE</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 新的统筹寄存器</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">chip_rm</span> <span class="cm-meta">=</span> <span class="cm-variable">chip_reg_model</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"chip_rm"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; <span class="cm-comment">//@@ 例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">chip_rm</span>.<span class="cm-variable">configure</span><span class="cm-bracket">(</span><span class="cm-keyword">null</span>, <span class="cm-string">""</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ configure</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">chip_rm</span>.<span class="cm-variable">build</span><span class="cm-bracket">()</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ build</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">chip_rm</span>.<span class="cm-variable">lock_model</span><span class="cm-bracket">()</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ lock_model</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">chip_rm</span>.<span class="cm-variable">reset</span><span class="cm-bracket">()</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ reset</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ reg_model的适配器</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">reg_sqr_adapter</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"reg_sqr_adapter"</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ adapter 例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 指针赋值【参考 monitor和scoreboard的三种连接方式——方式三：step2指针赋值】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env_A</span>.<span class="cm-variable">p_rm</span> <span class="cm-meta">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">chip_rm</span>.<span class="cm-variable">A_rm</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env_B</span>.<span class="cm-variable">p_rm</span> <span class="cm-meta">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">chip_rm</span>.<span class="cm-variable">B_rm</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env_C</span>.<span class="cm-variable">p_rm</span> <span class="cm-meta">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">chip_rm</span>.<span class="cm-variable">C_rm</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1165px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1165px;"></div></div></div></pre></li></ul></li></ul><p>&nbsp;</p><p>&nbsp;</p><h5><a name="◻-vseqvsqr-重用" class="md-header-anchor"></a><span>◻ v_seq、v_sqr 重用</span></h5><ul><li><p><span>9.4.3 </span><code>virtual sequence</code><span>与 </span><code>virtual sequencer</code></p><ul><li><p><code>v_sqr</code><span> </span>
<span>	</span><span>① </span><font color="red"><strong><span>模块级</span></strong></font><span>：只跟自己，不能出现在 </span><strong><span>芯片级的验证环境 </span></strong><span>中，</span>
<span> </span><span>						</span><span>所以，</span><font color="blue"><code>v_sqr</code></font><span> 不应该在 </span><code>chip_env</code><span>中实例化， 而应该 </span><font color="blue"><span>在</span><code>base_test</code><span>中实例化</span></font></p><p><span>	</span><span>② </span><font color="red"><strong><span>芯片级</span></strong></font><span>：有他自己的</span><font color="blue"><span> </span><code>v_sqr</code></font><span>，</span><font color="blue"><span>在 </span><code>chip_env</code><span>中实例化</span></font><span> ，</span>
<span>​                        非边界模块（内部模块）+ 边界模块 的 </span><code>sqr</code><span> 例化，</span><font color="blue"><span>均在 </span><code>base_test</code><span> 中进行</span></font></p><p><span>		</span><span>例如 下图中：</span>
<img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-代码重用机制-vsqr的重用.jpg" referrerpolicy="no-referrer"></p></li></ul><ul><li><p><code>v_seq</code><span> </span></p><p><span>① 一般的</span><code>v_seq</code><span>是用来调度</span><code>seq</code><span>的，而</span><code>seq</code><span>都只在模块级别，所以这些</span><code>v_seq</code><span>无法用于芯片级别验证。</span></p><p><span>② </span><font color="red"><span>例外</span></font><span>：有</span><font color="blue"><strong><span>两种</span></strong><span>&nbsp;</span></font><font color="red"><strong><span>模块级别的 </span><code>seq</code></strong><span> </span></font><span>可以直接用于 </span><font color="red"><strong><span>芯片级别的验证</span></strong></font>
<span>                =&gt;  边界输入端的普通的</span><code>seq</code><span>（不是</span><code>v_seq</code><span>）</span>
<span>                =&gt;  寄存器配置的  </span><code>seq</code></p><ul><li><p><span>边界输入端的普通的</span><code>seq</code><span>（不是</span><code>v_seq</code><span>）</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""（模块级）边界输入端的普通的`seq`（不是`v_seq`）可以直接应用于芯片级别的验证"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《上图中的边界模块<span class="cm-variable">A_seq</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 略</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>  模块级别的使用《<span class="cm-variable">A_vseq</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">A_vseq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_seq</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">aseq</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do_on</span><span class="cm-bracket">(</span><span class="cm-variable">aseq</span>, <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_sqr</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 269px;"></div><div class="CodeMirror-gutters" style="display: none; height: 269px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""芯片级别的使用"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">chip_vseq</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">chip_vseq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_seq</span><span class="cm-tab" role="presentation" cm-text="	">   </span> <span class="cm-variable">aseq</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">D_seq</span> <span class="cm-tab" role="presentation" cm-text="	">  </span> <span class="cm-variable">dseq</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">F_seq</span> <span class="cm-variable">fseq</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">fork</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do_on</span><span class="cm-bracket">(</span><span class="cm-variable">aseq</span>, <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_a_sqr</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do_on</span><span class="cm-bracket">(</span><span class="cm-variable">aseq</span>, <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_d_sqr</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do_on</span><span class="cm-bracket">(</span><span class="cm-variable">aseq</span>, <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_f_sqr</span><span class="cm-bracket">)</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">join</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 336px;"></div><div class="CodeMirror-gutters" style="display: none; height: 336px;"></div></div></div></pre><p><span>    </span></p></li><li><p><span>寄存器配置的  </span><code>seq</code></p><ul><li><p><span>定义： </span><font color="red"><span>第2种定义方式也是不能重用的</span></font></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""【定义方式】寄存器配置的  `seq` """</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 定义方式一：✔，可以重用</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">A_cfg_seq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">A_reg_model</span><span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">p_rm</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">p_rm</span>.<span class="cm-variable">xxx</span>.<span class="cm-variable">write</span><span class="cm-bracket">()</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@  ✔✔✔</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 定义方式二：<span class="cm-variable">X</span>，不能重用</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">A_cfg_seq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">A_reg_model</span><span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">p_rm</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_rm</span>.<span class="cm-variable">xxx</span>.<span class="cm-variable">write</span><span class="cm-bracket">()</span>; &nbsp; &nbsp; <span class="cm-comment">//@@  XXX  不能通过 p_sqr 启动，因为那样就固定了</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 470px;"></div><div class="CodeMirror-gutters" style="display: none; height: 470px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>模块级启动</span></p><ul><li><span>方式1：指针传递 的形式</span></li><li><span>方式2：</span><font color="blue"><code>get_root_blocks</code></font></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""【启动应用-模块级】寄存器配置的  `seq` """</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 模块级启动应用《模块<span class="cm-variable">v_seq</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">A_vseq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_cfg_seq</span><span class="cm-tab" role="presentation" cm-text="	">   </span> <span class="cm-variable">c_seq</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">c_seq</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"c_seq"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">c_seq</span>.<span class="cm-variable">p_rm</span> <span class="cm-meta">=</span> <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_rm</span>; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 指针传递 的形式</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">c_seq</span>.<span class="cm-variable">start</span><span class="cm-bracket">(</span><span class="cm-keyword">null</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 224px;"></div><div class="CodeMirror-gutters" style="display: none; height: 224px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>芯片级启动</span></p><ul><li><span>方式1：指针传递 的形式</span></li><li><span>方式2：在芯片级时，</span><code>root block</code><span>已经和模块级别不同，单纯靠</span><code>get_root_blocks</code><span>已经无法满足要求。此时需要</span><font color="blue"><code>find_blocks</code><span>、</span><code>find_block</code><span>、</span><code>get_blocks</code><span>和</span><code>get_block_by_name</code></font><span>等函数</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""【启动应用-芯片级】寄存器配置的  `seq` """</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 芯片级启动应用《芯片<span class="cm-variable">v_seq</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">chip_vseq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">A_cfg_seq</span><span class="cm-tab" role="presentation" cm-text="	">   </span> <span class="cm-variable">A_c_seq</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">A_c_seq</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"A_c_seq"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A_c_seq</span>.<span class="cm-variable">p_rm</span> <span class="cm-meta">=</span> <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_rm</span>.<span class="cm-variable">A_rm</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 指针传递 的形式</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">A_c_seq</span>.<span class="cm-variable">start</span><span class="cm-bracket">(</span><span class="cm-keyword">null</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 246px;"></div><div class="CodeMirror-gutters" style="display: none; height: 246px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li></ul></li></ul></li></ul><p>&nbsp;</p><h3><a name="ch-10高级应用" class="md-header-anchor"></a><span>Ch. 10_高级应用</span></h3><p><font color="red"><strong><span>要点总结</span></strong><span>：</span></font></p><h4><a name="1011-interface" class="md-header-anchor"></a><span>10.1.1 interface</span></h4><p><a name="Ctrl跳转3"><span>——</span><code>interface</code><span>实现</span><code>driver</code><span>的部分功能</span></a></p><p><span>	</span><code>interface</code><span> 中可以做的事情 汇总：</span>
<span>​</span><span>			</span><span>① </span><font color="blue"><span>声明/定义 变量</span></font>
<span>​</span><span>			</span><span>② 定义</span><font color="blue"><span>任务</span></font><span>、</span><font color="blue"><span>函数</span></font>
<span>​</span><span>			</span><span>③ </span><font color="blue"><code>always</code></font><span>、</span><font color="blue"><code>assign</code></font><span>、</span><font color="blue"><code>initial</code></font><span> 语句</span>
<span>​</span><span>			</span><span>④ 实例化其他 </span><font color="blue"><code>interface</code></font><span>（封装特定功能）</span>
<span>​</span><span>			</span><span>⑤ </span><font color="blue"><span>编码转换</span></font><span>，例如：8b10b转换、曼彻斯特编码 ;   </span><font color="red"><span>与transaction完全无关</span></font></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h4><a name="1012-可变时钟" class="md-header-anchor"></a><span>10.1.2 可变时钟</span></h4><ul><li><p><span>3类：</span></p><p><span>①  不同测试用例之间：时钟频率不同</span>
<span>              相同测试用例：保持不变</span></p><p><span>②  同一个测试用例：时钟频率 </span><strong><span>变换</span></strong><span>， 且 </span><font color="blue"><span>不关心&nbsp;</span></font><span>过渡期</span></p><p><span>③  同一个测试用例：时钟频率 </span><strong><span>变换</span></strong><span>， 且 关心 </span><font color="blue"><strong><span>过渡期</span></strong></font><span>  和 </span><font color="blue"><strong><span>稳定期的波动</span></strong></font><span>（稳定是理论上的稳定）</span></p><p><span>			</span><span>a. 过渡期，验证时，需要单独一个  可变时钟模型</span>
<span>​            b. 稳定期波动，......................................................</span></p><p>&nbsp;</p></li><li><p><span>时钟实现：</span></p><ul><li><p><span>一般做法：在 </span><code>top_tb</code><span> 中实现</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""《top_tb代码》时钟部分"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">initial</span> <span class="cm-keyword">begin</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">clk</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">forever</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">#100</span> <span class="cm-variable">clk</span> <span class="cm-meta">=</span> <span class="cm-meta">~</span><span class="cm-variable">clk</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">end</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 157px;"></div><div class="CodeMirror-gutters" style="display: none; height: 157px;"></div></div></div></pre></li></ul><p>&nbsp;</p><ul><li><p><span>实现第一种可变时钟：</span></p><p><span>① step1：将时钟模块独立成一个文件</span>
<span>② step2：通过 </span><code>inlude</code><span> 包含在 </span><code>top_tb</code><span>中</span>
<span>③ step3：构造一个可变时钟，有2种办法：</span>
<span>						</span><span>a.   重新编写一个《test_clk.sv》文件</span>
<span>						</span><span>b.   【非直线的获取法】在</span><font color="blue"><code>case</code></font><span>中 设置  </span><code>config_db</code><span> ， 在 </span><font color="blue"><code>top_tb</code></font><span>中 使用 </span><code>config_db</code></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""实现第一种可变时钟"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ step1:将时钟模块独立成一个文件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《时钟模块文件》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">`ifndef</span> <span class="cm-variable">TEST_CLK</span> &nbsp; &nbsp; <span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">`define</span> <span class="cm-variable">TEST_CLK</span> &nbsp; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">initial</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">clk</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">forever</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">#100</span> <span class="cm-variable">clk</span> <span class="cm-meta">=</span> <span class="cm-meta">~</span><span class="cm-variable">clk</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">`endif</span> &nbsp;<span class="cm-comment">//@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ step2：通过 `inlude` 包含在 `top_tb`中  +//@@ ③ step3：构造一个可变时钟，第2种办法 config_db使用</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">top_tb</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">module</span> <span class="cm-variable">top_tb</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`include</span> <span class="cm-string">"test_clk.sv"</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@  inlude + 文件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 使用可变时钟</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">initial</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">static</span> <span class="cm-keyword">real</span> <span class="cm-variable">clk_half_period</span> <span class="cm-meta">=</span> <span class="cm-number">100.0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">clk</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">#1</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 延迟1s，等set完</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">real</span><span class="cm-bracket">)</span>::<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_root</span>::<span class="cm-variable">get</span><span class="cm-bracket">()</span>, &nbsp; <span class="cm-comment">// 组件名</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"uvm_test_top"</span>, &nbsp; &nbsp;<span class="cm-comment">// 组件路径</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"clk_half_period"</span>, <span class="cm-comment">// 变量名</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">clk_half_period</span><span class="cm-bracket">))</span> &nbsp;<span class="cm-comment">// 变量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"top_tb"</span>, <span class="cm-meta">$sformatf</span><span class="cm-bracket">(</span><span class="cm-string">"clk_half_period is %0f"</span>, <span class="cm-variable">clk_half_per</span> <span class="cm-variable">iod</span><span class="cm-bracket">)</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">forever</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">clk_half_period</span><span class="cm-meta">*</span><span class="cm-number">1.0</span><span class="cm-variable">ns</span><span class="cm-bracket">)</span> <span class="cm-variable">clk</span> <span class="cm-meta">=</span> <span class="cm-meta">~</span><span class="cm-variable">clk</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endmodule</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ ③ step3：构造一个可变时钟，第2种办法 config_db设置</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-keyword">case</span>代码》设置可变时钟</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">real</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">""</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 组件路径</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"clk_half_period"</span>, &nbsp; &nbsp; <span class="cm-comment">// 变量名</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">200.0</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 变量值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1030px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1030px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>实现第二种可变时钟：</span></p><p><span>同第一种实现方法：</span><code>config_db</code><span> 方法</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""实现第二种可变时钟：`config_db` 方法"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-keyword">case</span>代码》设置<span class="cm-variable">set</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">task</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">#100000</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">real</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">""</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 组件路径</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"clk_half_period"</span>, &nbsp; &nbsp; <span class="cm-comment">// 变量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">200.0</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 设置的值<span class="cm-tab" role="presentation" cm-text="	">    </span></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">#100000</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">real</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">// 组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">""</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">// 组件路径</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"clk_half_period"</span>, &nbsp; &nbsp;<span class="cm-comment">// 变量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">150.0</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">// 设置的值<span class="cm-tab" role="presentation" cm-text="	"> </span></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">top_tb</span>代码》获得<span class="cm-variable">get</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">initial</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">static</span> <span class="cm-keyword">real</span> <span class="cm-variable">clk_half_period</span> <span class="cm-meta">=</span> <span class="cm-number">100.0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">clk</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">fork</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">forever</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">real</span><span class="cm-bracket">)</span>::<span class="cm-variable">wait_modified</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_root</span>::<span class="cm-variable">get</span><span class="cm-bracket">()</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"uvm_test_to p"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"clk_half_perio"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">void</span>'<span class="cm-bracket">(</span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">real</span><span class="cm-bracket">)</span>::<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_root</span>::<span class="cm-variable">get</span><span class="cm-bracket">()</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"uvm_test_top"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"clk_half_period"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">clk_half_period</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"top_tb"</span>, <span class="cm-meta">$sformatf</span><span class="cm-bracket">(</span><span class="cm-string">"clk_half_period is %0f"</span>, <span class="cm-variable">clk_half_p</span> <span class="cm-variable">eriod</span><span class="cm-bracket">)</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">forever</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">clk_half_period</span><span class="cm-meta">*</span><span class="cm-number">1.0</span><span class="cm-variable">ns</span><span class="cm-bracket">)</span> <span class="cm-variable">clk</span> <span class="cm-meta">=</span> <span class="cm-meta">~</span><span class="cm-variable">clk</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp;<span class="cm-keyword">join</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">end</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 829px;"></div><div class="CodeMirror-gutters" style="display: none; height: 829px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>实现第三种可变时钟：</span></p><p><font color="red"><span>不能用</span><code>config_db</code><span> 方法</span></font><span>，需要 </span><font color="blue"><strong><span>专门编写一个时钟接口</span></strong></font></p><p><span>		</span><span>a. 过渡期，验证时，需要单独一个  </span><font color="blue"><strong><span>可变时钟模型</span></strong></font>
<span>​        b. 稳定期波动，......................................................</span></p><p><span>在这种使用方式中，</span><font color="blue"><span>时钟接口</span></font><span>被封装在了一个</span><font color="blue"><code>component</code></font><span>中。</span>
<span>在需要新的时钟模型时，只需要</span><font color="blue"><span>从</span><code>clk_model</code><span>派生一个新的类</span></font><span>，然后在新的类中实现时钟模型。</span>
<span>使用</span><font color="blue"><code>factory机制</code><span>的重载</span></font><span>功能将</span><code>clk_model</code><span>用新的类重载掉。通过这种方式，可以将时钟设置为任意想要的行为。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""实现第三种可变时钟：编写一个时钟接口 法"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《时钟接口<span class="cm-keyword">interface</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">interface</span> <span class="cm-variable">clk_if</span><span class="cm-bracket">()</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 做成interface接口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">logic</span> <span class="cm-variable">clk</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endinterface</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">top_tb</span>代码》例化 和 引用</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">clk_if</span> &nbsp; <span class="cm-variable">cif</span><span class="cm-bracket">()</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@  例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">dut</span> <span class="cm-variable">my_dut</span><span class="cm-bracket">(</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">clk</span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-bracket">(</span><span class="cm-variable">cif</span>.<span class="cm-variable">clk</span><span class="cm-bracket">)</span>, &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@  引用</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>.<span class="cm-variable">rst_n</span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp;<span class="cm-bracket">(</span><span class="cm-variable">rst_n</span><span class="cm-bracket">)</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  …<span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">clk_model</span>可变时钟模型》从<span class="cm-variable">uvm_component</span>派生</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">clk_model</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_component</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 继承自uvm_component</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">clk_model</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ factory注册</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-variable">clk_if</span><span class="cm-tab" role="presentation" cm-text="	">  </span> <span class="cm-variable">vif</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">real</span> <span class="cm-variable">half_period</span> <span class="cm-meta">=</span> <span class="cm-number">100.0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// build_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-meta">!</span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">virtual</span> <span class="cm-variable">clk_if</span><span class="cm-bracket">)</span>::<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">""</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"vif"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">vif</span><span class="cm-bracket">))</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ interface正常</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_fatal</span><span class="cm-bracket">(</span><span class="cm-string">"clk_model"</span>, <span class="cm-string">"must set interface for vif"</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">void</span>'<span class="cm-bracket">(</span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">real</span><span class="cm-bracket">)</span>::<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">""</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"half_period"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">half_perio</span> <span class="cm-variable">d</span><span class="cm-bracket">))</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"clk_model"</span>, <span class="cm-meta">$sformatf</span><span class="cm-bracket">(</span><span class="cm-string">"clk_half_period is %0f"</span>, <span class="cm-variable">half_peri</span> <span class="cm-variable">od</span><span class="cm-bracket">)</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// run_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">run_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">vif</span>.<span class="cm-variable">clk</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">forever</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">half_period</span><span class="cm-meta">*</span><span class="cm-number">1.0</span><span class="cm-variable">ns</span><span class="cm-bracket">)</span> <span class="cm-variable">vif</span>.<span class="cm-variable">clk</span> <span class="cm-meta">=</span> <span class="cm-meta">~</span><span class="cm-variable">vif</span>.<span class="cm-variable">clk</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">env</span>代码》<span class="cm-variable">clk_model</span>例化可变时钟模型</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_env</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_env</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">clk_model</span> <span class="cm-variable">clk_sys</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// env build_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">clk_sys</span> <span class="cm-meta">=</span> <span class="cm-variable">clk_model</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"clk_sys"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">//例化 可变时钟模型 组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1232px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1232px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li></ul><p>&nbsp;</p><h4><a name="a-namectrl跳转16102103 -seq-高阶a" class="md-header-anchor"></a><a name="Ctrl跳转16"><span>10.2~10.3&nbsp; seq 高阶</span></a></h4><h5><a name="◻-layer-sequence" class="md-header-anchor"></a><span>◻ layer sequence</span></h5><ul><li><p><span>10.2.1~10.2.2  </span><code>seq</code><span>代码重用、 </span><code>tr</code><span> 重用</span></p><ul><li><p><strong><span>常见数据包</span></strong><span>：IP包、UDP包、TCP包、</span><font color="blue"><span>mac包</span></font><span>（my_transaction）、太网包（底层包）</span>
<span>PS ：</span><code>IP</code><span>包整体被作为</span><code>mac</code><span>包的负荷</span></p></li><li><p><strong><span>场景</span></strong><span>：在发送的</span><code>mac</code><span>包中指定</span><code>IP</code><span>地址等数据，这需要约束</span><code>mac</code><span>包</span><code>pload</code><span>的值。在</span><code>ip_transaction</code><span>如此多的域中，如果要对其中某一项进行约束，那么需要仔细计算每一项在</span><code>my_transaction</code><span>的</span><code>pload</code><span>中的位置，稍微一不小心就很容易搞错。如果需要约束多项，那么更加麻烦。</span></p></li><li><p><strong><span>解决办法</span></strong><span>：</span>
<span>①   </span><font color="blue"><code>base_sequence</code><span>中独立封装 函数/任务</span></font><span>：</span></p><p><span>		</span><span>与</span><code>ip</code><span>相关的代码写成一个函数，而与</span><code>mac</code><span>相关的代码写成另外一个函数，将这些基本的函数放在</span><code>base_seq</code><span>中。在新建测试用例时，从</span><code>base_seq</code><span>派生新的</span><code>seq</code><span>，并调用之前写好的函数。</span>
<span>②  </span><font color="blue"><span>使用</span><code>layer sequence</code></font><span>：  </span></p><p><span>		</span><span>  一个</span><code>seq</code><span>负责产生</span><code>ip_transaction</code><span>，另外</span><code>seq</code><span>负责产生</span><code>my_transaction</code><span>，前者将产生的</span><code>ip_transaction</code><span>交给后者</span></p></li><li><p><strong><span>场景代码</span></strong><span>：</span></p><ul><li><p><span>《ip_transaction》</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""ip_transaction"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">ip_transaction</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence_item</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//ip header</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span> <span class="cm-bracket">[</span><span class="cm-number">3</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">version</span>;<span class="cm-comment">//protocol version</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span> <span class="cm-bracket">[</span><span class="cm-number">3</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">ihl</span>;<span class="cm-comment">// ip header length</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span> <span class="cm-bracket">[</span><span class="cm-number">7</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">diff_service</span>; <span class="cm-comment">// service type, tos(type of service)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span> <span class="cm-bracket">[</span><span class="cm-number">15</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">total_len</span>;<span class="cm-comment">// ip telecom length, include payload, byte</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span> <span class="cm-bracket">[</span><span class="cm-number">15</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">iden</span>;<span class="cm-comment">//identification</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span> <span class="cm-bracket">[</span><span class="cm-number">2</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">flags</span>;<span class="cm-comment">//flags</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span> <span class="cm-bracket">[</span><span class="cm-number">12</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">frag_offset</span>;<span class="cm-comment">//fragment offset</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span> <span class="cm-bracket">[</span><span class="cm-number">7</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">ttl</span>;<span class="cm-comment">// time to live</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span> <span class="cm-bracket">[</span><span class="cm-number">7</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">protocol</span>;<span class="cm-comment">//protocol of data in payload</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span> <span class="cm-bracket">[</span><span class="cm-number">15</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">header_cks</span>;<span class="cm-comment">//header checksum</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span> <span class="cm-bracket">[</span><span class="cm-number">31</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">src_ip</span>; <span class="cm-comment">//source ip address</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span> <span class="cm-bracket">[</span><span class="cm-number">31</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">dest_ip</span>;<span class="cm-comment">//destination ip address</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span> <span class="cm-bracket">[</span><span class="cm-number">31</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">other_opt</span><span class="cm-bracket">[]</span>;<span class="cm-comment">//other options and padding</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span> <span class="cm-bracket">[</span><span class="cm-number">7</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-variable">payload</span><span class="cm-bracket">[]</span>;<span class="cm-comment">//data</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-tab" role="presentation" cm-text="	">   </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 426px;"></div><div class="CodeMirror-gutters" style="display: none; height: 426px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>操作A：《case代码》pload施加约束</span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>tr. pack_bytes(data_q)</span></td><td><span>将所有数据打包成一个</span><code>tr</code><span>的</span><font color="blue"><span>动态数组</span></font></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""操作A：对my_transaction的pload施加约束"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">my_case</span>::<span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_transaction</span><span class="cm-tab" role="presentation" cm-text="	">  </span> <span class="cm-variable">m_tr</span>; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">ip_transaction</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-variable">ip_tr</span>; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">byte</span> <span class="cm-keyword">unsigned</span> <span class="cm-variable">data_q</span><span class="cm-bracket">[]</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">int</span> <span class="cm-variable">data_size</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">ip_tr</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"ip_tr"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">ip_tr</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">()</span> <span class="cm-keyword">with</span> <span class="cm-bracket">{</span><span class="cm-variable">ip_tr</span>.<span class="cm-variable">src_ip</span> <span class="cm-meta">==</span> <span class="cm-number">'h9999</span>; <span class="cm-variable">ip_tr</span>.<span class="cm-variable">dest_</span> <span class="cm-variable">ip</span> <span class="cm-meta">==</span> <span class="cm-number">'h10000</span>;<span class="cm-bracket">})</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">ip_tr</span>.<span class="cm-variable">print</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">data_size</span> <span class="cm-meta">=</span> <span class="cm-variable">ip_tr</span>.<span class="cm-variable">pack_bytes</span><span class="cm-bracket">(</span><span class="cm-variable">data_q</span><span class="cm-bracket">)</span> <span class="cm-meta">/</span> <span class="cm-number">8</span>; &nbsp; <span class="cm-comment">//@@使用pack_bytes函数将所有数据打包成一个动态数组作为my_transaction的pload。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">m_tr</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"m_tr"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">m_tr</span>.<span class="cm-variable">randomize</span> <span class="cm-keyword">with</span><span class="cm-bracket">{</span><span class="cm-variable">m_tr</span>.<span class="cm-variable">pload</span>.<span class="cm-variable">size</span><span class="cm-bracket">()</span> <span class="cm-meta">==</span> <span class="cm-variable">data_size</span>;<span class="cm-bracket">})</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">for</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span> <span class="cm-variable">i</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> &lt; <span class="cm-variable">data_size</span>; <span class="cm-variable">i</span><span class="cm-meta">++</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">m_tr</span>.<span class="cm-variable">pload</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">]</span> <span class="cm-meta">=</span> <span class="cm-variable">data_q</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">]</span>; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_send</span><span class="cm-bracket">(</span><span class="cm-variable">m_tr</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">#100</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 493px;"></div><div class="CodeMirror-gutters" style="display: none; height: 493px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>操作B：《case代码》测 CRC错误</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""操作B：测 CRC错误"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@  相比操作A 只改变了一行</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">my_case</span>::<span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_transaction</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-variable">m_tr</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">ip_transaction</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-variable">ip_tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">byte</span> <span class="cm-keyword">unsigned</span> <span class="cm-variable">data_q</span><span class="cm-bracket">[]</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">int</span> <span class="cm-variable">data_size</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ip_tr</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"ip_tr"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">ip_tr</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">()</span> <span class="cm-keyword">with</span> <span class="cm-bracket">{</span><span class="cm-variable">ip_tr</span>.<span class="cm-variable">src_ip</span> <span class="cm-meta">==</span> <span class="cm-number">'h9999</span>; <span class="cm-variable">ip_tr</span>.<span class="cm-variable">dest_ip</span> <span class="cm-meta">=</span> <span class="cm-meta">=</span> <span class="cm-number">'h10000</span>;<span class="cm-bracket">})</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ip_tr</span>.<span class="cm-variable">print</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">data_size</span> <span class="cm-meta">=</span> <span class="cm-variable">ip_tr</span>.<span class="cm-variable">pack_bytes</span><span class="cm-bracket">(</span><span class="cm-variable">data_q</span><span class="cm-bracket">)</span> <span class="cm-meta">/</span> <span class="cm-number">8</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">m_tr</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"m_tr"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">m_tr</span>.<span class="cm-variable">randomize</span> <span class="cm-keyword">with</span><span class="cm-bracket">{</span><span class="cm-variable">m_tr</span>.<span class="cm-variable">pload</span>.<span class="cm-variable">size</span><span class="cm-bracket">()</span> <span class="cm-meta">==</span> <span class="cm-variable">data_size</span>; <span class="cm-variable">m_tr</span>.<span class="cm-variable">crc_er</span> <span class="cm-variable">r</span> <span class="cm-meta">==</span> <span class="cm-number">1</span><span class="cm-bracket">})</span>; <span class="cm-comment">//@@ 唯一差异点</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span> <span class="cm-variable">i</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> &lt; <span class="cm-variable">data_size</span>; <span class="cm-variable">i</span><span class="cm-meta">++</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">m_tr</span>.<span class="cm-variable">pload</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">]</span> <span class="cm-meta">=</span> <span class="cm-variable">data_q</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">]</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_send</span><span class="cm-bracket">(</span><span class="cm-variable">m_tr</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">#100</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 493px;"></div><div class="CodeMirror-gutters" style="display: none; height: 493px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>操作C：《case代码》施加给DUT </span><code>IP checksum</code><span>错误的包</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""操作C：施加给DUT `IP checksum`错误的包"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 相比操作A 只是插入一句对header_cks赋随机值的语句。与mac相关的代码不需要做任何变更</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">my_case</span>::<span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_transaction</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-variable">m_tr</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ip_transaction</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-variable">ip_tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">byte</span> <span class="cm-keyword">unsigned</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">data_q</span><span class="cm-bracket">[]</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">int</span> <span class="cm-variable">data_size</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">ip_tr</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"ip_tr"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">ip_tr</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">()</span> <span class="cm-keyword">with</span> <span class="cm-bracket">{</span><span class="cm-variable">ip_tr</span>.<span class="cm-variable">src_ip</span> <span class="cm-meta">==</span> <span class="cm-number">'h9999</span>; <span class="cm-variable">ip_tr</span>.<span class="cm-variable">dest_ip</span> <span class="cm-meta">=</span> <span class="cm-meta">=</span> <span class="cm-number">'h10000</span>;<span class="cm-bracket">})</span> <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">ip_tr</span>.<span class="cm-variable">header_cks</span> <span class="cm-meta">=</span> <span class="cm-meta">$urandom_range</span><span class="cm-bracket">(</span><span class="cm-number">10000</span>, <span class="cm-number">0</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 唯一差异点</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ip_tr</span>.<span class="cm-variable">print</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">data_size</span> <span class="cm-meta">=</span> <span class="cm-variable">ip_tr</span>.<span class="cm-variable">pack_bytes</span><span class="cm-bracket">(</span><span class="cm-variable">data_q</span><span class="cm-bracket">)</span> <span class="cm-meta">/</span> <span class="cm-number">8</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">m_tr</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"m_tr"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">m_tr</span>.<span class="cm-variable">randomize</span> <span class="cm-keyword">with</span><span class="cm-bracket">{</span><span class="cm-variable">m_tr</span>.<span class="cm-variable">pload</span>.<span class="cm-variable">size</span><span class="cm-bracket">()</span> <span class="cm-meta">==</span> <span class="cm-variable">data_size</span>;<span class="cm-bracket">})</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span> <span class="cm-variable">i</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> &lt; <span class="cm-variable">data_size</span>; <span class="cm-variable">i</span><span class="cm-meta">++</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">m_tr</span>.<span class="cm-variable">pload</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">]</span> <span class="cm-meta">=</span> <span class="cm-variable">data_q</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">]</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_send</span><span class="cm-bracket">(</span><span class="cm-variable">m_tr</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">#100</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 515px;"></div><div class="CodeMirror-gutters" style="display: none; height: 515px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li><li><p><strong><span>方法一</span></strong><span>：   </span><font color="blue"><code>base_sequence</code><span>中独立封装 函数/任务</span></font></p><p><span>			</span><span>略</span></p></li><li><p><strong><span>方法二</span></strong><span>： </span><font color="blue"><span>使用</span><code>layer sequence</code></font><span>：  </span></p><ul><li><p><span>操作A 示例：</span></p><ul><li><p><span>产生</span><code>ip_transaction</code><span>的</span><code>seq</code><span> + </span><code>sqr</code></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""产生`ip_transaction`的`seq` 和 `sqr`"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 【!!!】 objection要在ip_sequence中控制</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">ip_seq</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">ip_sequence</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">ip_transaction</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ ip_tr传入</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">ip_transaction</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-variable">ip_tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span> <span class="cm-bracket">(</span><span class="cm-number">10</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do_with</span><span class="cm-bracket">(</span><span class="cm-variable">ip_tr</span>, <span class="cm-bracket">{</span><span class="cm-variable">ip_tr</span>.<span class="cm-variable">src_ip</span> <span class="cm-meta">==</span> <span class="cm-number">'h9999</span>; <span class="cm-variable">ip_tr</span>.<span class="cm-variable">dest_ip</span> <span class="cm-meta">==</span> <span class="cm-number">'h10000</span>;<span class="cm-bracket">})</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">#100</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_object_utils</span><span class="cm-bracket">(</span><span class="cm-variable">ip_sequence</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">ip_sqr</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">ip_sequencer</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequencer</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">ip_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">function</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-keyword">string</span> <span class="cm-variable">name</span>, <span class="cm-variable">uvm_component</span> <span class="cm-variable">parent</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">super</span>.<span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-variable">name</span>, <span class="cm-variable">parent</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_component_utils</span><span class="cm-bracket">(</span><span class="cm-variable">ip_sequencer</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 493px;"></div><div class="CodeMirror-gutters" style="display: none; height: 493px;"></div></div></div></pre></li></ul><p>&nbsp;</p><ul><li><p><code>my_transaction</code><span> 的 </span><code>sqr</code><span> +  </span><code>seq</code></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>uvm_seq_item_pull_port #（tr）</span></td><td><a name="Ctrl跳转17"><span>sqr 端口声明</span></a></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""my_sqr创建端口、例化，用于接收ip_tr"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 将`ip_transaction`能够交给产生`my_transaction`的 `seq` ，需要 在`my_sqr` 例化一个端口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">my_sqr</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_sequencer</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequencer</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ my_tr传入</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_seq_item_pull_port</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">ip_transaction</span><span class="cm-bracket">)</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-variable">ip_tr_port</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ 声明 sqr 端口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ip_tr_port</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"ip_tr_port"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化端口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">my_seq</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_sequence</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_transaction</span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">m_tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">ip_transaction</span> <span class="cm-tab" role="presentation" cm-text="	"> </span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-variable">ip_tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">byte</span> <span class="cm-keyword">unsigned</span> <span class="cm-tab" role="presentation" cm-text="	">  </span> <span class="cm-variable">data_q</span><span class="cm-bracket">[]</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">int</span> <span class="cm-variable">data_size</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span> &nbsp; &nbsp; <span class="cm-comment">//@@ 故意做成无限循环，类似driver的无限循环，objection要在ip_sequence中控制</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">p_sequencer</span>.<span class="cm-variable">ip_tr_port</span>.<span class="cm-variable">get_next_item</span><span class="cm-bracket">(</span><span class="cm-variable">ip_tr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">data_size</span> <span class="cm-meta">=</span> <span class="cm-variable">ip_tr</span>.<span class="cm-variable">pack_bytes</span><span class="cm-bracket">(</span><span class="cm-variable">data_q</span><span class="cm-bracket">)</span> <span class="cm-meta">/</span> <span class="cm-number">8</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">m_tr</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"m_tr"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">m_tr</span>.<span class="cm-variable">randomize</span> <span class="cm-keyword">with</span><span class="cm-bracket">{</span><span class="cm-variable">m_tr</span>.<span class="cm-variable">pload</span>.<span class="cm-variable">size</span><span class="cm-bracket">()</span> <span class="cm-meta">==</span> <span class="cm-variable">data_size</span>;<span class="cm-bracket">})</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">for</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span> <span class="cm-variable">i</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> &lt; <span class="cm-variable">data_size</span>; <span class="cm-variable">i</span><span class="cm-meta">++</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">m_tr</span>.<span class="cm-variable">pload</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">]</span> <span class="cm-meta">=</span> <span class="cm-variable">data_q</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">]</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_send</span><span class="cm-bracket">(</span><span class="cm-variable">m_tr</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">p_sequencer</span>.<span class="cm-variable">ip_tr_port</span>.<span class="cm-variable">item_done</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_object_utils</span><span class="cm-bracket">(</span><span class="cm-variable">my_sequence</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_declare_p_sequencer</span><span class="cm-bracket">(</span><span class="cm-variable">my_sequencer</span><span class="cm-bracket">)</span> &nbsp; &nbsp;<span class="cm-comment">//@@ 由于需要用到sequencer中的ip_tr_port，所以要使用declare_p_sequencer宏声明sequencer</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 874px;"></div><div class="CodeMirror-gutters" style="display: none; height: 874px;"></div></div></div></pre><p>&nbsp;</p></li></ul><ul><li><p><code>agt</code><span> ：</span>
<span>① 例化两个</span><code>sqr</code>
<span>② 将</span><code>my_sqr</code><span>和</span><code>ip_sqr</code><span>的相关端口连接在一起</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""agt例化两个sqr"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">agt</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_agent</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-bracket">(</span><span class="cm-variable">is_active</span> <span class="cm-meta">==</span> <span class="cm-variable">UVM_ACTIVE</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ip_sqr</span> <span class="cm-meta">=</span> <span class="cm-variable">ip_sequencer</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"ip_sqr"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sqr</span> <span class="cm-meta">=</span> <span class="cm-variable">my_sequencer</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"sqr"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">drv</span> <span class="cm-meta">=</span> <span class="cm-variable">my_driver</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"drv"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">mon</span> <span class="cm-meta">=</span> <span class="cm-variable">my_monitor</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"mon"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 连接</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_agent</span>::<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">super</span>.<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span> <span class="cm-bracket">(</span><span class="cm-variable">is_active</span> <span class="cm-meta">==</span> <span class="cm-variable">UVM_ACTIVE</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">drv</span>.<span class="cm-variable">seq_item_port</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">sqr</span>.<span class="cm-variable">seq_item_export</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">// drv 连接 sqr</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sqr</span>.<span class="cm-variable">ip_tr_port</span>.<span class="cm-variable">connect</span><span class="cm-bracket">(</span><span class="cm-variable">ip_sqr</span>.<span class="cm-variable">seq_item_export</span><span class="cm-bracket">)</span>; &nbsp;<span class="cm-comment">//@@  sqr的 ip_tr_port 连接 ip_sqr的export</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp; <span class="cm-comment">//@@ 【!!!】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">ap</span> <span class="cm-meta">=</span> <span class="cm-variable">mon</span>.<span class="cm-variable">ap</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 指针赋值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 560px;"></div><div class="CodeMirror-gutters" style="display: none; height: 560px;"></div></div></div></pre><p>&nbsp;</p></li></ul><ul><li><p><code>case</code><span> ：启动这两个</span><code>seq</code></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""【方式1：default_sequence】启动这2个`seq`"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ build_phase config_db set  default_sequence 的方式启动</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-keyword">case</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_object_wrapper</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"env.i_agt.ip_sqr.main_phase"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"default_sequence"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ip_sequence</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">get</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_object_wrapper</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"env.i_agt.sqr.main_phase"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"default_sequence"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">my_sequence</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">get</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 314px;"></div><div class="CodeMirror-gutters" style="display: none; height: 314px;"></div></div></div></pre><p>&nbsp;</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""【方式2：v_seq】启动这2个`seq`"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 前提是：vsqr中已经有成员变量指向相应的sqr</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-keyword">case</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">case0_vseq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ip_sequence</span> <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">ip_seq</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_sequence</span><span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">my_seq</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">fork</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do_on</span><span class="cm-bracket">(</span><span class="cm-variable">my_seq</span>, <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_my_sqr</span><span class="cm-bracket">)</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">join_none</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do_on</span><span class="cm-bracket">(</span><span class="cm-variable">ip_seq</span>, <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_ip_sqr</span><span class="cm-bracket">)</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 291px;"></div><div class="CodeMirror-gutters" style="display: none; height: 291px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li><li><p><span>接下来：操作B 和 操作C </span></p><p><span>操作B：</span>
<span>构建CRC错误包的激励时，只需要建立</span><code>crc_seq</code><span>，并在</span><code>my_sqr</code><span>上启动。而此时</span><code>ip_sqr</code><span>上依然是</span><code>ip_seq</code><span>，不受影响。</span></p><p><span>操作C：</span>
<span>构建checksum错误的激励时，也只需要建立</span><code>cks_err_seq</code><span>，并在</span><code>ip_sqr</code><span>上启动，此时</span><code>my_sqr</code><span>上启动的是</span><code>my_seq</code><span>，不受影响。</span></p></li></ul></li></ul></li></ul><p>&nbsp;</p><p>&nbsp;</p><h5><a name="◻-trynextitem-时间槽" class="md-header-anchor"></a><span>◻ </span><code>try_next_item</code><span> 、时间槽</span></h5><ul><li><p><span>10.2.3~10.2.4    </span><code>try_next_item</code><span>  vs </span><code>get_next_item</code><span>、时间槽</span></p><ul><li><p><font color="blue"><code>try_next_item</code><span> </span></font><span> vs </span><font color="blue"><code>get_next_item</code></font></p><p><code>get_next_item</code><span> 的劣势，也是 </span><code>try_next_item</code><span> 的优势：</span></p><p><span>① 某些协议并不是上电复位后马上开始发送</span><font color="blue"><span>正常数据</span></font><span>，而是开始发送一些 </span><font color="blue"><span>空闲数据</span><code>seq</code></font><span>。而这些空闲数据，是有特定要求的，且不是一成不变的。</span><code>get_next_item</code><span> 在上电复位后  很难处理  发送的空闲数据</span><code>seq</code><span>。</span></p><p><span>② </span><code>drop_objection</code><span>后的</span><code>drain_time</code><span> 也需要发送 空闲数据，但是此时</span><code>seq</code><span> 已经停止工作，</span><code>driver</code><span>无法驱动这些空闲数据</span><code>seq</code></p><p>&nbsp;</p></li><li><p><span>时间槽</span></p><p><span>SV通过 </span><font color="blue"><span>事件驱动</span></font><span> 进行仿真，通过 </span><font color="blue"><span>时间槽</span></font><span> 来管理它们。    </span><font color="red"><strong><span>&lt;暂时没有深入看，没搞懂&gt;</span></strong></font></p><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-layer sequence-时间槽.jpg" referrerpolicy="no-referrer"></p></li><li><p><code>try_item_item</code><span>弊端：</span><span>	</span></p><p><span>可能会导致过早的被 </span><code>driver</code><span> 调用</span></p><p><span>解决办法：</span>
<span>	</span><span>①   </span><code>uvm_wait_for_nba_region();</code></p><p><span>	</span><span>②  错峰技术的使用</span></p><ul><li><p><span>方法一：</span><font color="blue"><code>uvm_wait_for_nba_region();</code></font></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>uvm_wait_for_nba_region();</span></td><td><span>延迟一个时间槽（主动等待非激活/空闲状态）</span><br><span>避免driver的try_next_item调用过早</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""try_next_item 优化掉get_...，且避免driver的try_next_item调用过早"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">driver</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ drive_idle 不驱动task</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">task</span> <span class="cm-variable">my_driver</span>::<span class="cm-variable">drive_idle</span><span class="cm-bracket">()</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"my_driver"</span>, <span class="cm-string">"item is null"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>@<span class="cm-bracket">(</span><span class="cm-keyword">posedge</span> <span class="cm-variable">vif</span>.<span class="cm-variable">clk</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ main_phase：驱动激励</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">task</span> <span class="cm-variable">my_driver</span>::<span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_wait_for_nba_region</span><span class="cm-bracket">()</span>; &nbsp; <span class="cm-comment">//@@ 延迟一个时间槽</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq_item_port</span>.<span class="cm-variable">try_next_item</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//try_next_item</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">req</span> <span class="cm-meta">==</span> <span class="cm-keyword">null</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">dirve_idle</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">else</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">drive_one_pkt</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">seq_item_port</span>.<span class="cm-variable">item_done</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 515px;"></div><div class="CodeMirror-gutters" style="display: none; height: 515px;"></div></div></div></pre><p><span>存在弊端：多一个</span><code>layer seq</code><span>，就要多用一次</span><code>uvm_wait_for_nba_region();</code></p><p><span>解决办法：错峰技术的使用</span></p><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-layer sequence-延迟一个时间槽方法的缺陷.jpg" referrerpolicy="no-referrer"></p></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><ul><li><p><span>方法二：</span><font color="blue"><span>错峰技术的使用</span></font></p><p><span>将</span><code>item_done</code><span>和</span><code>try_next_item</code><span> 在不同时刻被调用 （之前默认是同一时刻，这回导致时间槽的竞争）</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""主动错峰后的时间槽-代码"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">driver</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ driver idle</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">task</span> <span class="cm-variable">my_driver</span>::<span class="cm-variable">drive_idle</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"my_driver"</span>, <span class="cm-string">"item is null"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ main_phase 发送激励</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">task</span> <span class="cm-variable">my_driver</span>::<span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  @<span class="cm-bracket">(</span><span class="cm-keyword">posedge</span> <span class="cm-variable">vif</span>.<span class="cm-variable">clk</span><span class="cm-bracket">)</span>; <span class="cm-comment">//@@ 【核心精髓】在item_done被调用后，并不是立即调用try_next_item，而是等待下一个时钟的上升沿到来后再调用</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq_item_port</span>.<span class="cm-variable">try_next_item</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>; &nbsp;<span class="cm-comment">//try_next_item</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">req</span> <span class="cm-meta">==</span> <span class="cm-keyword">null</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">drive_idle</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">else</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">drive_one_pkt</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">seq_item_port</span>.<span class="cm-variable">item_done</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 515px;"></div><div class="CodeMirror-gutters" style="display: none; height: 515px;"></div></div></div></pre><p><img src="./UVM_files/SV&amp;UVM基础_《UVM实战速查》-layer sequence-错峰技术下的时间槽.jpg" referrerpolicy="no-referrer"></p></li></ul><p>&nbsp;</p></li></ul></li></ul><h5><a name="◻-seq-心跳功能实现" class="md-header-anchor"></a><span>◻ seq 心跳功能实现</span></h5><ul><li><p><span>10.3.1 心跳功能的实现</span></p><p><span>两种方式：</span></p><p><span>① 方式一：</span><code>driver</code><span> 中实现，</span><code>driver</code><span>负责包 的产生、发送    </span><font color="red"><span>&lt;不推荐，需要写手动仲裁&gt;</span></font></p><p><span>② 方式二：在</span><code>seq</code><span>中实现，无限循环的</span><code>seq</code><span>，当需要时发送一个心跳包    </span><font color="red"><span>&lt;推荐，UVM自带seq仲裁，后期还能便于修改心跳频率&gt;</span></font></p><p><span>                    方式二用到的知识点：</span>
<span>​</span><span>													</span><span>   a.  </span><code>seq</code><span>的启动方式： </span><font color="blue"><code>default_sequence</code></font><span>、 </span><font color="blue"><span> </span><code>virtual_sequence</code></font>
<span>​</span><span>													</span><span>   b.  uvm</span><code>seq</code><span>仲裁： </span><font color="blue"><span> </span><code>grab</code></font>
<span>​                                                       c.  </span><font color="blue"><span>  </span><code>fork...join_none</code></font>
<span>​                                                       d.  心跳 </span><code>seq</code><span>中 </span><font color="blue"><span>  </span><code>raise_objection</code></font><span>、 </span><font color="blue"><span> </span><code>drop objection</code></font></p><ul><li><p><span>方式一：在</span><code>driver</code><span>实现</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""在`driver`实现 心跳功能"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">driver</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">task</span> <span class="cm-variable">my_driver</span>::<span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">fork</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">#</span><span class="cm-variable">delay</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">drive_heartbeat_pkt</span><span class="cm-bracket">()</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq_item_port</span>.<span class="cm-variable">get_next_item</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">drive_one_pkt</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">seq_item_port</span>.<span class="cm-variable">item_done</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">join</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 336px;"></div><div class="CodeMirror-gutters" style="display: none; height: 336px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>方式二：在 </span><code>seq</code><span>实现</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""在`seq`实现 心跳功能"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《心跳<span class="cm-variable">_seq</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">heartbeat_sequence</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_transaction</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">heartbeat_tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">repeat</span><span class="cm-bracket">(</span><span class="cm-number">100</span><span class="cm-bracket">)</span> @<span class="cm-bracket">(</span><span class="cm-keyword">posedge</span> <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">vif</span>.<span class="cm-variable">clk</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">grab</span><span class="cm-bracket">()</span>; &nbsp; <span class="cm-comment">//@@ 排队到第一个位置</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">starting_phase</span>.<span class="cm-variable">raise_objection</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do_with</span><span class="cm-bracket">(</span><span class="cm-variable">heartbeat_tr</span>, <span class="cm-bracket">{</span><span class="cm-variable">heartbeat_tr</span>.<span class="cm-variable">pload</span>.<span class="cm-variable">size</span> <span class="cm-meta">==</span> <span class="cm-number">50</span>;<span class="cm-bracket">})</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_info</span><span class="cm-bracket">(</span><span class="cm-string">"hb_seq"</span>, <span class="cm-string">"this is a heartbeat transaction"</span>, <span class="cm-variable">UVM_MEDIUM</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">starting_phase</span>.<span class="cm-variable">drop_objection</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">ungrab</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span><span class="cm-tab" role="presentation" cm-text="	"> </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">normal_seq</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">case0_vseq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span> <span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">case0_sequence</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">normal_seq</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">heartbeat_sequence</span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">heartbeat_seq</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">heartbeat_seq</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"heartbeat_seq"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">heartbeat_seq</span>.<span class="cm-variable">starting_phase</span> <span class="cm-meta">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">starting_phase</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ start_phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">fork</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">heartbeat_seq</span>.<span class="cm-variable">start</span><span class="cm-bracket">(</span><span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_sqr</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ 手动启动 &nbsp; ,  也可以用 default_seq启动</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">join_none</span><span class="cm-tab" role="presentation" cm-text="	">   </span> &nbsp;<span class="cm-comment">//@@  此处不能是 none，否则会一直卡在这里（因为是无限循环）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_do_on</span><span class="cm-bracket">(</span><span class="cm-variable">normal_seq</span>, <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_sqr</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ normal_seq 启动方式v_seq的uvm_do_on</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 874px;"></div><div class="CodeMirror-gutters" style="display: none; height: 874px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li></ul><p>&nbsp;</p><ul><li><p><span>10.3.2 只将</span><code>v_seq</code><span>设置为</span><code>default_sequence</code></p><p><span>因为 </span><code>config_db：：set</code><span> 第2个参数是字符串，很难检查</span><code>bug</code><span>，所以应该尽量少用  </span><code>config_db：：set</code><span>,  只将</span><code>v_seq</code><span>设置为</span><code>default_sequence</code><span>              </span><font color="red"><span>&lt;只给</span><code>v_seq</code><span>设置一次&gt;</span></font></p><p>&nbsp;</p><p><span>如果只将</span><code>virtual seq</code><span>设置为</span><code>default_sequence</code><span>，那么所有其他的</span><code>seq</code><span>都在其中</span><font color="blue"><span> 启动&nbsp;</span></font><span>，这样就可以通过使用</span><code>v_seq</code><span>启动一个</span><code>seq</code><span>，然后直接赋值</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""通过 v_seq 调用 seq，直接赋值（相当于config_db的set了）"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">case_vseq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">normal_seq</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">nseq</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nseq</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">()</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nseq</span>.<span class="cm-variable">xxx</span> <span class="cm-meta">=</span> <span class="cm-variable">yyy</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nseq</span>.<span class="cm-variable">start</span><span class="cm-bracket">(</span><span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_sqr</span><span class="cm-bracket">)</span> &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 202px;"></div><div class="CodeMirror-gutters" style="display: none; height: 202px;"></div></div></div></pre><p>&nbsp;</p><p>&nbsp;</p></li></ul><h5><a name="a-namectrl跳转18◻vseq的-进程-中断操作a" class="md-header-anchor"></a><a name="Ctrl跳转18"><span>◻</span><code>v_seq</code><span>的 进程 中断操作</span></a></h5><ul><li><p><span>10.3.3 disable fork语句对原子操作的影响</span></p><p><strong><span>错误方法</span></strong><span>：直接使用</span><code>disable fork</code><span>  原子操作</span></p><p><strong><span>问题点</span></strong><span>：无法清除 原子操作（如 write）的标记位</span></p><p><strong><span>正确方法</span></strong><span>：针对原子操作：手动标记 + </span><code>break</code></p><ul><li><p><span>错误示范</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""错误做法: disable fork 原子操作"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">v_seq</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">caw_vseq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">caw_seq</span> <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">demo_s</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">logic</span><span class="cm-bracket">[</span><span class="cm-number">31</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">rdata</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_status_e</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-variable">status</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">starting_phase</span> <span class="cm-meta">!=</span> <span class="cm-keyword">null</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">starting_phase</span>.<span class="cm-variable">raise_objection</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">demo_s</span> <span class="cm-meta">=</span> <span class="cm-variable">caw_seq</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"demo_s"</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">fork</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">demo_s</span>.<span class="cm-variable">start</span><span class="cm-bracket">(</span><span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_cp_sqr</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_rm</span>.<span class="cm-variable">counter</span>.<span class="cm-variable">write</span><span class="cm-bracket">(</span><span class="cm-variable">status</span>, <span class="cm-number">1</span>, <span class="cm-variable">UVM_FRONTDOOR</span><span class="cm-bracket">)</span>; <span class="cm-comment">//@@ write是原子操作</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">join_any</span> &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">disable</span> <span class="cm-keyword">fork</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ write标记位未清除，会出现错误</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_rm</span>.<span class="cm-variable">counter</span>.<span class="cm-variable">read</span><span class="cm-bracket">(</span><span class="cm-variable">status</span>, <span class="cm-variable">rdata</span>, <span class="cm-variable">UVM_FRONTDOOR</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">demo_s</span>.<span class="cm-variable">start</span><span class="cm-bracket">(</span><span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_cp_sqr</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_rm</span>.<span class="cm-variable">counter</span>.<span class="cm-variable">read</span><span class="cm-bracket">(</span><span class="cm-variable">status</span>, <span class="cm-variable">rdata</span>, <span class="cm-variable">UVM_FRONTDOOR</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">starting_phase</span> <span class="cm-meta">!=</span> <span class="cm-keyword">null</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">starting_phase</span>.<span class="cm-variable">drop_objection</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 605px;"></div><div class="CodeMirror-gutters" style="display: none; height: 605px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>正确做法</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""正确做法: 针对原子操作，标记+break"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">caw_vseq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">caw_seq</span><span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-tab" role="presentation" cm-text="	">   </span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">demo_s</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">semaphore</span> <span class="cm-tab" role="presentation" cm-text="	">  </span> <span class="cm-variable">m_atomic</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">logic</span><span class="cm-bracket">[</span><span class="cm-number">31</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span><span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">rdata</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_status_e</span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">status</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">starting_phase</span> <span class="cm-meta">!=</span> <span class="cm-keyword">null</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">starting_phase</span>.<span class="cm-variable">raise_objection</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">demo_s</span> <span class="cm-meta">=</span> <span class="cm-variable">caw_seq</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"demo_s"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">fork</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">demo_s</span>.<span class="cm-variable">start</span><span class="cm-bracket">(</span><span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_cp_sqr</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">m_atomic</span>.<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 标记下结束了 </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">m_atomic</span>.<span class="cm-variable">try_get</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">))</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_rm</span>.<span class="cm-variable">counter</span>.<span class="cm-variable">write</span><span class="cm-bracket">(</span><span class="cm-variable">status</span>, <span class="cm-number">1</span>, <span class="cm-variable">UVM_FRONTDOOR</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">m_atomic</span>.<span class="cm-variable">put</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">break</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">join</span> &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_rm</span>.<span class="cm-variable">counter</span>.<span class="cm-variable">read</span><span class="cm-bracket">(</span><span class="cm-variable">status</span>, <span class="cm-variable">rdata</span>, <span class="cm-variable">UVM_FRONTDOOR</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">demo_s</span>.<span class="cm-variable">start</span><span class="cm-bracket">(</span><span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_cp_sqr</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_rm</span>.<span class="cm-variable">counter</span>.<span class="cm-variable">read</span><span class="cm-bracket">(</span><span class="cm-variable">status</span>, <span class="cm-variable">rdata</span>, <span class="cm-variable">UVM_FRONTDOOR</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">starting_phase</span> <span class="cm-meta">!=</span> <span class="cm-keyword">null</span><span class="cm-bracket">)</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">starting_phase</span>.<span class="cm-variable">drop_objection</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 739px;"></div><div class="CodeMirror-gutters" style="display: none; height: 739px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li></ul><h4><a name="104106-参数" class="md-header-anchor"></a><span>10.4~10.6 参数</span></h4><p><span>向 </span><code>DUT</code><span> 灌输不同的激励</span>
<span>为 </span><code>DUT</code><span> 配置不同的参数 -----    </span><font color="red"><span>寄存器</span></font>
<span>验证环境中独有的参数 -------    </span><font color="red"><span>聚合参数</span></font><span> +  </span><font color="red"><code>config_db</code></font></p><p>&nbsp;</p><h5><a name="a-namectrl跳转19◻-寄存器--dut-参数a" class="md-header-anchor"></a><a name="Ctrl跳转19"><span>◻ 寄存器 &amp; DUT 参数</span></a></h5><ul><li><p><span>10.4.1 </span><font color="red"><span>寄存器模型</span></font><span>  </span><font color="blue"><span>随机化 DUT参数 </span></font></p><p><span>如何缩小随机化的范围的方法，有3种：</span></p><p><span>	</span><span>① 指定寄存器 调用 </span><code>randomize函数</code><span>，其他不调用  </span></p><p><span>	</span><span>② 在调用整体的</span><code>randomize函数</code><span>时，为需要指定参数的寄存器指定约束     </span><font color="red"><span>&lt;推荐&gt;</span></font></p><p><span>	</span><span>③ 派生新</span><code>reg</code><span>类 +</span><font color="blue"><span> </span><code>factory</code><span>重载</span></font></p><ul><li><p><span>方法一：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""方法一：reg调用randomize()+变量约束"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 指定reg1 &amp; reg2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">p_rm</span>.<span class="cm-variable">reg1</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">()</span> <span class="cm-keyword">with</span> <span class="cm-bracket">{</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">reg_data</span>.<span class="cm-variable">value</span> <span class="cm-meta">==</span> <span class="cm-number">5'h3</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-bracket">})</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">p_rm</span>.<span class="cm-variable">reg2</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">()</span> <span class="cm-keyword">with</span> <span class="cm-bracket">{</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">reg_data</span>.<span class="cm-variable">value</span> &gt;<span class="cm-meta">=</span> <span class="cm-number">7'h9</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; <span class="cm-bracket">})</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 179px;"></div><div class="CodeMirror-gutters" style="display: none; height: 179px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>方法二：</span><font color="red"><span>&lt;推荐&gt;</span></font></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""方法二：整体调用randomize()+指定reg.变量约束"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 指定reg1 &amp; reg2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">p_rm</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">()</span> <span class="cm-keyword">with</span> <span class="cm-bracket">{</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">reg1</span>.<span class="cm-variable">reg_data</span>.<span class="cm-variable">value</span> <span class="cm-meta">==</span> <span class="cm-number">5'h3</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">reg2</span>.<span class="cm-variable">reg_data</span>.<span class="cm-variable">value</span> &gt;<span class="cm-meta">=</span> <span class="cm-number">7'h9</span><span class="cm-bracket">}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-bracket">)</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 134px;"></div><div class="CodeMirror-gutters" style="display: none; height: 134px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>方法三：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""派生新`reg`类 + `factory`重载"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 指定reg1 &amp; reg2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">dreg1</span> <span class="cm-keyword">extends</span> <span class="cm-variable">my_reg1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">constraint</span> <span class="cm-bracket">{</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">reg_data</span>.<span class="cm-variable">value</span> <span class="cm-meta">==</span> <span class="cm-number">5'h3</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-bracket">}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">dreg2</span> <span class="cm-keyword">extends</span> <span class="cm-variable">my_reg2</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">constraint</span><span class="cm-bracket">{</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">reg_data</span>.<span class="cm-variable">value</span> &gt;<span class="cm-meta">=</span> <span class="cm-number">7'h9</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-bracket">}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 291px;"></div><div class="CodeMirror-gutters" style="display: none; height: 291px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li><li><p><span>10.4.2 单独的 </span><font color="blue"><span>参数类</span></font></p><p><strong><span>需求场景</span></strong><span>：公司脚本创建寄存器模型 + </span><font color="red"><span>跨寄存器 的约束 </span></font><span>较多时（在寄存器模型中加入</span><code>constraint</code><span>就比较困难）</span></p><p><strong><span>解决办法</span></strong><span>：把 DUT中 需要随机化的参数，单独汇集出来 建立一个</span><code>dut_parm</code><span>类，并在其中指定默认约束，在</span><code>v_seq</code><span>中例化这个类、随机化变量、调用任务</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""DUT参数的类-代码示例""""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">dut_parm</span>.<span class="cm-variable">sv</span>》<span class="cm-variable">DUT</span>参数类</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">dut_parm</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_object</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">reg_model</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">p_rm</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span><span class="cm-bracket">[</span><span class="cm-number">15</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">a_field0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">bit</span><span class="cm-bracket">[</span><span class="cm-number">15</span>:<span class="cm-number">0</span><span class="cm-bracket">]</span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">b_field0</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 特定的约束</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">constraint</span> <span class="cm-variable">ab_field_cons</span><span class="cm-bracket">{</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">a_field0</span> <span class="cm-meta">+</span> <span class="cm-variable">b_field0</span> &gt;<span class="cm-meta">=</span> <span class="cm-number">100</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-bracket">}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ 操作方法</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">task</span> <span class="cm-variable">update_reg</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">p_rm</span>.<span class="cm-variable">rega</span>.<span class="cm-variable">write</span><span class="cm-bracket">(</span><span class="cm-variable">status</span>, <span class="cm-variable">a_field0</span>, <span class="cm-variable">UVM_FROTDOOR</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">p_rm</span>.<span class="cm-variable">regb</span>.<span class="cm-variable">write</span><span class="cm-bracket">(</span><span class="cm-variable">status</span>, <span class="cm-variable">b_field0</span>, <span class="cm-variable">UVM_FROTDOOR</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">v_seq</span>》在<span class="cm-variable">v_seq</span> 例化、随机化变量、调用任务</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">case0_cfg_vseq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">dut_parm</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-variable">pm</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">pm</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"pm"</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 例化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">assert</span><span class="cm-bracket">(</span><span class="cm-variable">pm</span>.<span class="cm-variable">randomize</span><span class="cm-bracket">())</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ 随机化 变量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">pm</span>.<span class="cm-variable">p_rm</span> <span class="cm-meta">=</span> <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_rm</span>; &nbsp; <span class="cm-comment">//【寄存器本身的东西】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">pm</span>.<span class="cm-variable">update_reg</span><span class="cm-bracket">()</span>; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 调用变量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 717px;"></div><div class="CodeMirror-gutters" style="display: none; height: 717px;"></div></div></div></pre><p>&nbsp;</p></li></ul><p>&nbsp;</p><h5><a name="◻-聚合参数" class="md-header-anchor"></a><span>◻ 聚合参数</span></h5><ul><li><p><span>10.5 聚合参数的定义、优势、缺点</span></p><ul><li><p><span>定义：</span></p><p><span>对于一个大的项目来说，要配置的  </span><font color="blue"><span>tb参数&nbsp;</span></font><span>可能有千百个。如果全部使用</span><code>config_db:set</code><span>的写法，肯定不合适。</span></p><p><span>一种比较好的方法就是将这1000个变量放在一个  </span><font color="blue"><span>专门的类 （聚合参数）</span></font><span>里面来实现</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""聚合参数-代码示例"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《聚合类》定义</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_config</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_object</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">rand</span> <span class="cm-keyword">int</span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">var1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">rand</span> <span class="cm-keyword">int</span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">var1000</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">constraint</span> <span class="cm-variable">default_cons</span><span class="cm-bracket">{</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">var1</span> <span class="cm-meta">=</span> <span class="cm-number">7</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 聚合类的约束中定义变量值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">var1000</span> <span class="cm-meta">=</span> <span class="cm-number">999</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-bracket">}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_object_utils_begin</span><span class="cm-bracket">(</span><span class="cm-variable">my_config</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_field_int</span><span class="cm-bracket">(</span><span class="cm-variable">var1</span>, <span class="cm-variable">UVM_ALL_ON</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_field_int</span><span class="cm-bracket">(</span><span class="cm-variable">var1000</span>, <span class="cm-variable">UVM_ALL_ON</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_object_utils_end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">base_test</span>代码》使用</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">classs</span> <span class="cm-variable">base_test</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_test</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_config</span><span class="cm-tab" role="presentation" cm-text="	">   </span> <span class="cm-variable">cfg</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//@@ 按照组件 一个一个config_db::set</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">cfg</span> <span class="cm-meta">=</span> <span class="cm-variable">my_config</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"cfg"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_config</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"env.i_agt.drv"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"cfg"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cfg</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_config</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"env.i_agt.mon"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"cfg"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cfg</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">driver</span>代码》使用</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_driver</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_driver</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">my_transaction</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">my_config</span><span class="cm-tab" role="presentation" cm-text="	">   </span> <span class="cm-variable">cfg</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_component_utils_begin</span><span class="cm-bracket">(</span><span class="cm-variable">my_driver</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_field_object</span><span class="cm-bracket">(</span><span class="cm-variable">cfg</span>, <span class="cm-variable">UVM_ALL_ON</span> <span class="cm-variable">UVM_REFERENCE</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_component_utils_end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">task</span> <span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-number">1</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">seq_item_port</span>.<span class="cm-variable">get_next_item</span><span class="cm-bracket">(</span><span class="cm-variable">req</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">pre_num</span> <span class="cm-meta">=</span> <span class="cm-meta">$urand_range</span><span class="cm-bracket">(</span><span class="cm-variable">cfg</span>.<span class="cm-variable">pre_num_min</span>, <span class="cm-variable">cfg</span>.<span class="cm-variable">pre_num_max</span><span class="cm-bracket">)</span>; &nbsp; &nbsp;<span class="cm-comment">//@@ 调用</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//drive this pkt, and the number of preamble is pre_num </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">seq_item_port</span>.<span class="cm-variable">item_done</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">end</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endtask</span> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-keyword">case</span>代码》使用：修改参数</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">case100</span> <span class="cm-keyword">extends</span> <span class="cm-variable">base_test</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cfg</span>.<span class="cm-variable">pre_num_max</span> <span class="cm-meta">=</span> <span class="cm-number">100</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@  直接赋值，而不是config_db::set</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cfg</span>.<span class="cm-variable">pre_num_min</span> <span class="cm-meta">=</span> <span class="cm-number">8</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1523px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1523px;"></div></div></div></pre></li></ul><p>&nbsp;</p><ul><li><p><span>进一步优化聚合类使用：</span><font color="blue"><span>加入 </span><code>interface</code></font></p><p><span>在</span><code>top_tb</code><span>中将</span><code>interface</code><span>通过</span><code>config_db：：set</code><span>的方式传递给</span><code>base_test</code><span>，在</span><code>base_test</code><span>中实例化</span><code>cfg</code><span>后就可以直接赋值</span></p><p><span>【注意】</span><code>base_test</code><span>中实例化</span><code>cfg</code><span>的名字要与</span><code>top_tb</code><span>中</span><code>config_db：：set</code><span>的路径参数一致</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""interface聚合类"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">my_config</span>.<span class="cm-variable">sv</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">my_config</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_object</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">`uvm_object_utils</span><span class="cm-bracket">(</span><span class="cm-variable">my_config</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-variable">my_if</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">vif</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">function</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-keyword">string</span> <span class="cm-variable">name</span> <span class="cm-meta">=</span> <span class="cm-string">"my_config"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">super</span>.<span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-variable">name</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-meta">$display</span><span class="cm-bracket">(</span><span class="cm-string">"%s"</span>, <span class="cm-variable">get_full_name</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-meta">!</span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">virtual</span> <span class="cm-variable">my_if</span><span class="cm-bracket">)</span>::<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-keyword">null</span>, <span class="cm-variable">get_full_name</span><span class="cm-bracket">()</span>, <span class="cm-string">"vif"</span>, <span class="cm-variable">vif</span><span class="cm-bracket">))</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_fatal</span><span class="cm-bracket">(</span><span class="cm-string">"my_config"</span>, <span class="cm-string">"please set interface"</span><span class="cm-bracket">)</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">driver</span>代码》使用</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">task</span> <span class="cm-variable">my_driver</span>::<span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cfg</span>.<span class="cm-variable">vif</span>.<span class="cm-variable">data</span> &lt;<span class="cm-meta">=</span> <span class="cm-number">8'b0</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cfg</span>.<span class="cm-variable">vif</span>.<span class="cm-variable">valid</span> &lt;<span class="cm-meta">=</span> <span class="cm-number">1'b0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-meta">!</span><span class="cm-variable">cfg</span>.<span class="cm-variable">vif</span>.<span class="cm-variable">rst_n</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>@<span class="cm-bracket">(</span><span class="cm-keyword">posedge</span> <span class="cm-variable">cfg</span>.<span class="cm-variable">vif</span>.<span class="cm-variable">clk</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@  `base_test`中实例化`cfg`的名字要与`top_tb`中`config_db：：set`的路径参数一致</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">base_test</span>代码》使用</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">base_test</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">cfg</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"cfg"</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 命名一致，也可使用【方式二】 cfg = new({get_full_name(), ".cfg"}); &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 方式二，new里面是一个字符串拼接</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">top_tb</span>代码》使用 &nbsp; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">module</span> <span class="cm-variable">top_tb</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">initial</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">virtual</span> <span class="cm-variable">my_if</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">null</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"cfg"</span>, &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 命名一致，【方式二】 "uvm_test_top.cfg", &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"vif"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">input_if</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">end</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endmodule</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 963px;"></div><div class="CodeMirror-gutters" style="display: none; height: 963px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>优势与问题</span></p><ul><li><p><span>优点：</span>
<span>①  大大方便了验证平台的搭建；</span>
<span>②  使用聚合类减少了</span><code>config_db：：set</code><span>的使用，也会大大降低出错的概率</span></p></li><li><p><span>缺点：</span></p><p><span>① 将一些属于某个</span><code>uvm_component</code><span>的变量变成对所有的</span><code>uvm_component</code><span>可见，容易出错</span>
<span>② 降低了验证平台的 </span><font color="blue"><span>可重用性</span></font><span>。</span>
<span>     为了优化 可重用性的问题：可以 缩小聚合参数的粒度，将一个聚合参数类分成多个小的聚合参数类，但是这样做，与直接使用</span><code>config_db</code><span>相比，优势就没了，所以这是一种平衡</span></p><p>&nbsp;</p></li></ul></li></ul><p><span> </span></p></li></ul><h5><a name="a-namectrl跳转21◻-configdba" class="md-header-anchor"></a><a name="Ctrl跳转21"><span>◻ config_db</span></a></h5><ul><li><p><font color="red"><strong><span>最大问题</span></strong></font><span>： </span><code>config_db机制</code><span>的 最大的问题 在于：  不对</span><code>set函数</code><span>的 </span><font color="blue"><span>第二个参数</span></font><span> 进行检查</span></p></li><li><p><strong><span>措施</span></strong><span>：</span></p><ul><li><p><strong><span>component 类型</span></strong><span>：</span></p><ul><li><p><font color="red"><strong><span>&lt;避免出错&gt;</span></strong></font><code>component</code><span> 的路径的第2个参数，可以通过 </span><strong><font color="red"><span>  </span><code>get_full_name（）</code></font><span> </span></strong><span>来获得。</span></p><p><span>【注意】 </span><strong><span>前提</span></strong><span>是 </span><font color="red"><span>UVM树已经形成</span></font><span>，不然使用</span><code>env.i_agt.drv</code><span>的形式进行引用会引起</span><font color="red"><span>空指针</span></font><span>的错误</span></p><p><span>				</span><span>确保树形成的办法有2个 </span><font color="blue"><span>（但是2个办法都对</span><code>top_tb</code><span> 的 </span><code>config_db：：set</code><span>无效）</span></font><span>：</span></p><p><span>						</span><span>①  一种是所有的 </span><font color="blue"><span>实例化工作</span></font><span>  都在各自的</span><font color="blue"><span> new函数 </span></font><span>中完成           </span><font color="red"><strong><span>&lt;常用&gt;</span></strong></font>
<span>​</span><span>						</span><span>②  另一种是 将</span><code>uvm_config_db：：set</code><span> 移到 </span><code>connect_phase</code><span>，</span>
<span>​</span><span>							</span><span>  在</span><code>end_of_elaboration_phase</code><span>或</span><code>start_of_simulation_phase</code><span>调用 </span><code>uvm_config_db：：get</code></p></li><li><p><font color="red"><strong><span>&lt;检查出错&gt;</span></strong></font><span> 还可以用在</span><code>uvm_config_db：：set</code><span>之后，利用  </span><code>check_all函数</code><span> （自定义函数）对向</span><code>component</code><span>传递的参数进行 有效性检查 </span></p></li></ul><p>&nbsp;</p></li><li><p><strong><span>object 类型</span></strong><span>：</span></p></li></ul><p><span>		</span><span>暂无很好的办法</span></p></li></ul><p>&nbsp;</p><ul><li><p><strong><span>极端做法</span></strong><span>：</span><font color="blue"><span>完全不用  </span><code>config_db机制</code></font><span>        </span><font color="red"><strong><span>&lt;不建议&gt;</span></strong></font></p><ul><li><p><span>结构性的参数_取代办法：</span></p><p><span>例化组件的时候，直接赋值参数的值</span></p></li><li><p><span>非结构性的参数_取代办法：</span></p><p><span>①  方法一：可以完全在</span><code>build_phase</code><span>之后的 </span><font color="blue"><span>任意</span><code>phase</code></font><span> 中使用 </span><font color="blue"><span>绝对路径引用&nbsp;</span></font><span>进行设置</span></p><p><span>②  方法二：..................................................................................... </span><font color="blue"><span>静态变量</span></font><span>........................</span></p><p>&nbsp;</p></li></ul></li><li><p><strong><span>相关代码</span></strong></p><ul><li><p><span>避免出错：</span><code>component</code><span> 用</span><font color="red"><span>  </span><code>get_full_name（）</code></font><span> </span></p><figure><table><thead><tr><th><span>uvm代码</span></th><th><span>注释</span></th></tr></thead><tbody><tr><td><span>组件. get_full_name()</span></td><td><span>获得组件的绝对路径</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""避免出错：component 用  get_full_name（）"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">driver</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">null</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">env</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">drv</span>.<span class="cm-variable">get_full_name</span><span class="cm-bracket">()</span>, &nbsp; <span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"pre_num"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">100</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">seq</span>》可有 <span class="cm-variable">sqr</span> <span class="cm-meta">+</span> 通配符 而来</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">null</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-bracket">{</span><span class="cm-variable">env</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">sqr</span>.<span class="cm-variable">get_full_name</span><span class="cm-bracket">()</span>,“.<span class="cm-meta">*</span>”<span class="cm-bracket">}</span>, &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 字符串拼接</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"pre_num"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">100</span><span class="cm-bracket">)</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 269px;"></div><div class="CodeMirror-gutters" style="display: none; height: 269px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>使用 </span><code>get_full_name（）</code><span> 的前提：确保UVM树已形成</span></p><ul><li><p><span>方法1：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""【方法1】使用 `get_full_name（）` 的前提：确保UVM树已形成"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 一种是所有的 实例化工作 都在各自的new函数中完成， 当整个验证平台运行到build_phase时，UVM树已经实例化完毕</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">base_test</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-variable">base_test</span>::<span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-keyword">string</span> <span class="cm-variable">name</span>, <span class="cm-variable">uvm_component</span> <span class="cm-variable">parent</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-variable">name</span>, <span class="cm-variable">parent</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env</span> <span class="cm-meta">=</span> <span class="cm-variable">my_env</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"env"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-variable">env</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-variable">my_env</span>::<span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-keyword">string</span> <span class="cm-variable">name</span>, <span class="cm-variable">uvm_component</span> <span class="cm-variable">parent</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-variable">name</span>, <span class="cm-variable">parent</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">i_agt</span> <span class="cm-meta">=</span> <span class="cm-variable">my_agent</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"i_agt"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">o_agt</span> <span class="cm-meta">=</span> <span class="cm-variable">my_agent</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"o_agt"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  … </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 336px;"></div><div class="CodeMirror-gutters" style="display: none; height: 336px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>方法2：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""【方法2】使用 `get_full_name（）` 的前提：确保UVM树已形成"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 将`uvm_config_db：：set ` 移到 `connect_phase`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 在`end_of_elaboration_phase`或`start_of_simulation_phase`调用 `uvm_config_db：：get`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-keyword">case</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ connect_phase中set</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">null</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">env</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">drv</span>.<span class="cm-variable">get_full_name</span><span class="cm-bracket">()</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"pre_num"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">100</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">driver</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_driver</span>::<span class="cm-variable">end_of_elaboration_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>; &nbsp; <span class="cm-comment">//@@ end_of_elaboration_phase  或是  start_of_simulation_phase 中 get</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">void</span>'<span class="cm-bracket">(</span><span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span><span class="cm-bracket">)</span>::<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">""</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"pre_num"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">pre_num</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-bracket">))</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 470px;"></div><div class="CodeMirror-gutters" style="display: none; height: 470px;"></div></div></div></pre><p>&nbsp;</p></li></ul><p>&nbsp;</p></li><li><p><font color="red"><span> </span><code>check_all_config函数</code></font><span> ，检查</span><code>config_db::set</code><span>参数二有效性</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""自定义函数，检查config_db::set参数二的有效性"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">check_config</span>.<span class="cm-variable">sv</span>》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">check_config</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_object</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">static</span> <span class="cm-variable">uvm_component</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-variable">uvm_nodes</span><span class="cm-bracket">[</span><span class="cm-keyword">string</span><span class="cm-bracket">]</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">static</span> <span class="cm-keyword">bit</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">is_inited</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ check_all_config函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">check_all_config</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">check_config</span>::<span class="cm-variable">check_all</span><span class="cm-bracket">()</span>; &nbsp;<span class="cm-comment">//@@ &nbsp; 这个全局函数会调用check_config的静态函数check_all：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ check_all函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">static</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">check_all</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_component</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">c</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_resource_pool</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">rp</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_resource_types</span>::<span class="cm-variable">rsrc_q_t</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-variable">rq</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_resource_types</span>::<span class="cm-variable">rsrc_q_t</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-variable">q</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_resource_base</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">r</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_resource_types</span>::<span class="cm-variable">access_t</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-variable">a</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uvm_line_printer</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">printer</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">c</span> <span class="cm-meta">=</span> <span class="cm-variable">uvm_root</span>::<span class="cm-variable">get</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-meta">!</span><span class="cm-variable">is_inited</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">init_uvm_nodes</span><span class="cm-bracket">(</span><span class="cm-variable">c</span><span class="cm-bracket">)</span>; &nbsp;<span class="cm-comment">//@@  这个函数先根据is_inited的值来调用init_nodes函数，将uvm_nodes联合数组初始化。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">rp</span> <span class="cm-meta">=</span> <span class="cm-variable">uvm_resource_pool</span>::<span class="cm-variable">get</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">q</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">printer</span><span class="cm-meta">=</span><span class="cm-keyword">new</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">foreach</span><span class="cm-bracket">(</span><span class="cm-variable">rp</span>.<span class="cm-variable">rtab</span><span class="cm-bracket">[</span><span class="cm-variable">name</span><span class="cm-bracket">])</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">rq</span> <span class="cm-meta">=</span> <span class="cm-variable">rp</span>.<span class="cm-variable">rtab</span><span class="cm-bracket">[</span><span class="cm-variable">name</span><span class="cm-bracket">]</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span><span class="cm-bracket">(</span><span class="cm-keyword">int</span> <span class="cm-variable">i</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> &lt; <span class="cm-variable">rq</span>.<span class="cm-variable">size</span><span class="cm-bracket">()</span>; <span class="cm-meta">++</span><span class="cm-variable">i</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">r</span> <span class="cm-meta">=</span> <span class="cm-variable">rq</span>.<span class="cm-variable">get</span><span class="cm-bracket">(</span><span class="cm-variable">i</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//$display("r.scope = %s", r.get_scope());</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-meta">!</span><span class="cm-variable">path_reachable</span><span class="cm-bracket">(</span><span class="cm-variable">r</span>.<span class="cm-variable">get_scope</span><span class="cm-bracket">))</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-def">`uvm_error</span><span class="cm-bracket">(</span><span class="cm-string">"check_config"</span>, <span class="cm-string">"the following config_db::set's path is not reachabl</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">r</span>.<span class="cm-variable">print</span><span class="cm-bracket">(</span><span class="cm-variable">printer</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">r</span>.<span class="cm-variable">print_accessors</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ init_uvm_nodes函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">static</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">init_uvm_nodes</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_component</span> <span class="cm-variable">c</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_component</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">children</span><span class="cm-bracket">[</span>$<span class="cm-bracket">]</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">string</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">cname</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_component</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">cn</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_sequencer_base</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">sqr</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">is_inited</span> <span class="cm-meta">=</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">c</span> <span class="cm-meta">!=</span> <span class="cm-variable">uvm_root</span>::<span class="cm-variable">get</span><span class="cm-bracket">())</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">cname</span> <span class="cm-meta">=</span> <span class="cm-variable">c</span>.<span class="cm-variable">get_full_name</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_nodes</span><span class="cm-bracket">[</span><span class="cm-variable">cname</span><span class="cm-bracket">]</span> <span class="cm-meta">=</span> <span class="cm-variable">c</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-meta">$cast</span><span class="cm-bracket">(</span><span class="cm-variable">sqr</span>, <span class="cm-variable">c</span><span class="cm-bracket">))</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">string</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-variable">tmp</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$sformat</span><span class="cm-bracket">(</span><span class="cm-variable">tmp</span>, <span class="cm-string">"%s.pre_reset_phase"</span>, <span class="cm-variable">cname</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 对各个phase的支持</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_nodes</span><span class="cm-bracket">[</span><span class="cm-variable">tmp</span><span class="cm-bracket">]</span> <span class="cm-meta">=</span> <span class="cm-variable">c</span>; &nbsp; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">$sformat</span><span class="cm-bracket">(</span><span class="cm-variable">tmp</span>, <span class="cm-string">"%s.main_phase"</span>, <span class="cm-variable">cname</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; <span class="cm-comment">//@@ tmp = cname &amp; “.main_phase”</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_nodes</span><span class="cm-bracket">[</span><span class="cm-variable">tmp</span><span class="cm-bracket">]</span> <span class="cm-meta">=</span> <span class="cm-variable">c</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-meta">$sformat</span><span class="cm-bracket">(</span><span class="cm-variable">tmp</span>, <span class="cm-string">"%s.post_shutdown_phase"</span>, <span class="cm-variable">cname</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_nodes</span><span class="cm-bracket">[</span><span class="cm-variable">tmp</span><span class="cm-bracket">]</span> <span class="cm-meta">=</span> <span class="cm-variable">c</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">c</span>.<span class="cm-variable">get_children</span><span class="cm-bracket">(</span><span class="cm-variable">children</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">while</span><span class="cm-bracket">(</span><span class="cm-variable">children</span>.<span class="cm-variable">size</span><span class="cm-bracket">()</span> &gt; <span class="cm-number">0</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">cn</span> <span class="cm-meta">=</span> <span class="cm-variable">children</span>.<span class="cm-variable">pop_front</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">init_uvm_nodes</span><span class="cm-bracket">(</span><span class="cm-variable">cn</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//@@ path_reachable 函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">static</span> <span class="cm-keyword">function</span> <span class="cm-keyword">bit</span> <span class="cm-variable">path_reachable</span><span class="cm-bracket">(</span><span class="cm-keyword">string</span> <span class="cm-variable">scope</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">bit</span> <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">err</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">int</span> <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">match_num</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">match_num</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">foreach</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_nodes</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">])</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">err</span> <span class="cm-meta">=</span> <span class="cm-variable">uvm_re_match</span><span class="cm-bracket">(</span><span class="cm-variable">scope</span>, <span class="cm-variable">i</span><span class="cm-bracket">)</span>; &nbsp;<span class="cm-comment">//@@ config_db：：set的第二个参数支持通配符，所以path_reachable通过调用uvm_re_match函数来检查路径是否匹配。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">err</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//$display("not_match: name is %s, scope is %s", i, scope);</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">else</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//$display("match: name is %s, scope is %s", i, scope);</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">match_num</span><span class="cm-meta">++</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span> <span class="cm-bracket">(</span><span class="cm-variable">match_num</span> &gt; <span class="cm-number">0</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 2061px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2061px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>完全不用  </span><code>config_db机制</code></p><ul><li><p><span>结构性的参数-取代</span></p><p><span>——例化的时候，赋值其值</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""结构性参数的取代：例化的时候，赋值其值"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">env</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">virtual</span> <span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-meta">!</span><span class="cm-variable">in_chip</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">i_agt</span> <span class="cm-meta">=</span> <span class="cm-variable">my_agent</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">create</span><span class="cm-bracket">(</span><span class="cm-string">"i_agt"</span>, <span class="cm-keyword">this</span><span class="cm-bracket">)</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//@@ 例化组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">i_agt</span>.<span class="cm-variable">is_active</span> <span class="cm-meta">=</span> <span class="cm-variable">UVM_ACTIVE</span>; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  …</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 224px;"></div><div class="CodeMirror-gutters" style="display: none; height: 224px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>非结构性参数-取代</span></p><ul><li><p><span>方法1：绝对路径引用</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""【示例1】方法1：非结构性参数取代：绝对路径引用"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-keyword">case</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//uvm_config_db#(int)::set(this, "env.i_agt.drv", "pre_num", 100); &nbsp; </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">drv</span>.<span class="cm-variable">pre_num</span> <span class="cm-meta">=</span> <span class="cm-number">100</span>; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ 替换上面的句子</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 134px;"></div><div class="CodeMirror-gutters" style="display: none; height: 134px;"></div></div></div></pre><p>&nbsp;</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""【示例2】方法1：非结构性参数取代：绝对路径引用"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@  v_seq 应用场景，前提是v_seq已经启动（启动方式2种default_sequence 和手动start）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span> 《<span class="cm-keyword">case</span>代码》启动<span class="cm-variable">v_seq</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 方式一：default_sequence</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">build_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_config_db</span><span class="cm-def">#</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_object_wrapper</span><span class="cm-bracket">)</span>::<span class="cm-variable">set</span><span class="cm-bracket">(</span><span class="cm-keyword">this</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"v_sqr.main_phase"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"default_sequence"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">case0_vseq</span>::<span class="cm-variable">type_id</span>::<span class="cm-variable">get</span><span class="cm-bracket">())</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 方式二：手动start</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">task</span> <span class="cm-variable">my_case0</span>::<span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">case0_vseq</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">vseq</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">super</span>.<span class="cm-variable">main_phase</span><span class="cm-bracket">(</span><span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">vseq</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"vseq"</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">vseq</span>.<span class="cm-variable">starting_phase</span> <span class="cm-meta">=</span> <span class="cm-variable">phase</span>; &nbsp; &nbsp; <span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">vseq</span>.<span class="cm-variable">start</span><span class="cm-bracket">(</span><span class="cm-variable">vsqr</span><span class="cm-bracket">)</span>; &nbsp;<span class="cm-comment">//@@</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">v_seq</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">case0_vseq</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_sequence</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-keyword">task</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">body</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">my_transaction</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">tr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">drv0_seq</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">seq0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">drv1_seq</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">seq1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">base_test</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">test_top</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uvm_component</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">children</span><span class="cm-bracket">[</span>$<span class="cm-bracket">]</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uvm_top</span>.<span class="cm-variable">get_children</span><span class="cm-bracket">(</span><span class="cm-variable">children</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">foreach</span><span class="cm-bracket">(</span><span class="cm-variable">children</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">])</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-meta">$cast</span><span class="cm-bracket">(</span><span class="cm-variable">test_top</span>, <span class="cm-variable">children</span><span class="cm-bracket">[</span><span class="cm-variable">i</span><span class="cm-bracket">]))</span> ;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">test_top</span> <span class="cm-meta">==</span> <span class="cm-keyword">null</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_fatal</span><span class="cm-bracket">(</span><span class="cm-string">"case0_vseq"</span>, <span class="cm-string">"can't find base_test 's instance"</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">fork</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do_on</span><span class="cm-bracket">(</span><span class="cm-variable">seq0</span>, <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_sqr0</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">`uvm_do_on</span><span class="cm-bracket">(</span><span class="cm-variable">seq1</span>, <span class="cm-variable">p_sequencer</span>.<span class="cm-variable">p_sqr1</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">#10000</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//uvm_config_db#(bit)::set(uvm_root::get(), "uvm_test_top.env0.scb", "cmp_en", 0);</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">test_top</span>.<span class="cm-variable">env0</span>.<span class="cm-variable">scb</span>.<span class="cm-variable">cmp_en</span> <span class="cm-meta">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-def">#10000</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//uvm_config_db#(bit)::set(uvm_root::get(), "uvm_test_top.env0.scb", "cmp_en", 1);</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">test_top</span>.<span class="cm-variable">env0</span>.<span class="cm-variable">scb</span>.<span class="cm-variable">cmp_en</span> <span class="cm-meta">=</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">join</span> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-def">#100</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endtask</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1277px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1277px;"></div></div></div></pre><p>&nbsp;</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""【示例3】方法1：非结构性参数取代：绝对路径引用"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 在top_tb中使用config_db对interface进行的传递，可以使用绝对路径的方式</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">base_test</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">base_test</span>::<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">env0</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">drv</span>.<span class="cm-variable">vif</span> <span class="cm-meta">=</span> <span class="cm-variable">testbench</span>.<span class="cm-variable">input_if0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>… </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 157px;"></div><div class="CodeMirror-gutters" style="display: none; height: 157px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><span>方法2：静态变量   </span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="verilog" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="verilog"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"""方法2：非结构性参数取代：静态变量"""</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-keyword">interface</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">if_object</span> <span class="cm-keyword">extends</span> <span class="cm-variable">uvm_object</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>…</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">static</span> <span class="cm-variable">if_object</span> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-variable">me</span>; &nbsp; <span class="cm-comment">//@@ 【？？？】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">static</span> <span class="cm-keyword">function</span> <span class="cm-variable">if_object</span> <span class="cm-variable">get</span><span class="cm-bracket">()</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//@@ get函数是if_object的一个静态函数，通过它可以得到if_object的一个实例，并对此实例中的interface进行赋值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span><span class="cm-bracket">(</span><span class="cm-variable">me</span> <span class="cm-meta">==</span> <span class="cm-keyword">null</span><span class="cm-bracket">)</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">me</span> <span class="cm-meta">=</span> <span class="cm-keyword">new</span><span class="cm-bracket">(</span><span class="cm-string">"me"</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span> <span class="cm-variable">me</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">endfunction</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-variable">my_if</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">input_vif0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-variable">my_if</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">output_vif0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-variable">my_if</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">input_vif1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-variable">my_if</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">output_vif1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@ 在top_tb中为这个类的interface赋值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">top_tb</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">module</span> <span class="cm-variable">top_tb</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">initial</span> <span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">if_object</span> <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">if_obj</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">if_obj</span> <span class="cm-meta">=</span> <span class="cm-variable">if_object</span>::<span class="cm-variable">get</span><span class="cm-bracket">()</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">if_obj</span>.<span class="cm-variable">input_vif0</span> <span class="cm-meta">=</span> <span class="cm-variable">input_if0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">if_obj</span>.<span class="cm-variable">input_vif1</span> <span class="cm-meta">=</span> <span class="cm-variable">input_if1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">if_obj</span>.<span class="cm-variable">output_vif0</span> <span class="cm-meta">=</span> <span class="cm-variable">output_if0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">if_obj</span>.<span class="cm-variable">output_vif1</span> <span class="cm-meta">=</span> <span class="cm-variable">output_if1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">end</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endmodule</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@@  在base_test的connect_phase（或build_phase之后的其他任一phase）对所有的interface进行赋值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">##</span>《<span class="cm-variable">base_test</span>代码》</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-keyword">void</span> <span class="cm-variable">base_test</span>::<span class="cm-variable">connect_phase</span><span class="cm-bracket">(</span><span class="cm-variable">uvm_phase</span> <span class="cm-variable">phase</span><span class="cm-bracket">)</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">if_object</span><span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-variable">if_obj</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">if_obj</span> <span class="cm-meta">=</span> <span class="cm-variable">if_object</span>::<span class="cm-variable">get</span><span class="cm-bracket">()</span>; &nbsp;<span class="cm-comment">//@@ get函数是if_object的一个静态函数，通过它可以得到if_object的一个实例，并对此实例中的interface进行赋值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">v_sqr</span>.<span class="cm-variable">p_sqr0</span> <span class="cm-meta">=</span> <span class="cm-variable">env0</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">sqr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">v_sqr</span>.<span class="cm-variable">p_sqr1</span> <span class="cm-meta">=</span> <span class="cm-variable">env1</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">sqr</span>;<span class="cm-variable">x</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env0</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">drv</span>.<span class="cm-variable">vif</span> <span class="cm-meta">=</span> <span class="cm-variable">if_obj</span>.<span class="cm-variable">input_vif0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env0</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">mon</span>.<span class="cm-variable">vif</span> <span class="cm-meta">=</span> <span class="cm-variable">if_obj</span>.<span class="cm-variable">input_vif0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env0</span>.<span class="cm-variable">o_agt</span>.<span class="cm-variable">mon</span>.<span class="cm-variable">vif</span> <span class="cm-meta">=</span> <span class="cm-variable">if_obj</span>.<span class="cm-variable">output_vif0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env1</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">drv</span>.<span class="cm-variable">vif</span> <span class="cm-meta">=</span> <span class="cm-variable">if_obj</span>.<span class="cm-variable">input_vif1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env1</span>.<span class="cm-variable">i_agt</span>.<span class="cm-variable">mon</span>.<span class="cm-variable">vif</span> <span class="cm-meta">=</span> <span class="cm-variable">if_obj</span>.<span class="cm-variable">input_vif1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">env1</span>.<span class="cm-variable">o_agt</span>.<span class="cm-variable">mon</span>.<span class="cm-variable">vif</span> <span class="cm-meta">=</span> <span class="cm-variable">if_obj</span>.<span class="cm-variable">output_vif1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">endfunction</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1075px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1075px;"></div></div></div></pre><p>&nbsp;</p></li></ul></li></ul><p>&nbsp;</p><p>&nbsp;</p></li></ul></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p></div>

</body></html>